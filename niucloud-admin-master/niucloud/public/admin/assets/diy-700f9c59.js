import{b7 as u,O as s,Y as l,k as o,an as a,a4 as d}from"./index-9f163f98.js";const h=u("diy",{state:()=>({id:0,load:!1,currentIndex:-99,currentComponent:"edit-page",pageMode:"diy",editTab:"content",pageTitle:"",name:"",type:"",typeName:"",templateName:"",isDefault:0,predefineColors:["#F4391c","#ff4500","#ff8c00","#FFD009","#ffd700","#19C650","#90ee90","#00ced1","#1e90ff","#c71585","#FF407E","#CFAF70","#A253FF","rgba(255, 69, 0, 0.68)","rgb(255, 120, 0)","hsl(181, 100%, 37%)","hsla(209, 100%, 56%, 0.73)","#c7158577"],components:[],position:["top_fixed","right_fixed","bottom_fixed","left_fixed","fixed"],global:{title:"页面",completeLayout:"style-1",completeAlign:"left",borderControl:!0,pageStartBgColor:"",pageEndBgColor:"",pageGradientAngle:"to bottom",bgUrl:"",bgHeightScale:0,imgWidth:"",imgHeight:"",topStatusBar:{control:!0,isShow:!0,bgColor:"#ffffff",rollBgColor:"#ffffff",style:"style-1",styleName:"风格1",textColor:"#333333",rollTextColor:"#333333",textAlign:"center",inputPlaceholder:"请输入搜索关键词",imgUrl:"",link:{name:""}},bottomTabBar:{control:!0,isShow:!0},popWindow:{imgUrl:"",imgWidth:"",imgHeight:"",count:"once",show:0,link:{name:""}},template:{textColor:"#303133",pageStartBgColor:"",pageEndBgColor:"",pageGradientAngle:"to bottom",componentBgUrl:"",componentBgAlpha:2,componentStartBgColor:"",componentEndBgColor:"",componentGradientAngle:"to bottom",topRounded:0,bottomRounded:0,elementBgColor:"",topElementRounded:0,bottomElementRounded:0,margin:{top:0,bottom:0,both:0},isHidden:!1}},value:[]}),getters:{editComponent:e=>e.currentIndex==-99?e.global:e.value[e.currentIndex]},actions:{init(){this.global={title:"页面",completeLayout:"style-1",completeAlign:"left",borderControl:!0,pageStartBgColor:"",pageEndBgColor:"",pageGradientAngle:"to bottom",bgUrl:"",bgHeightScale:100,imgWidth:"",imgHeight:"",topStatusBar:{control:!0,isShow:!0,bgColor:"#ffffff",rollBgColor:"#ffffff",style:"style-1",styleName:"风格1",textColor:"#333333",rollTextColor:"#333333",textAlign:"center",inputPlaceholder:"请输入搜索关键词",imgUrl:"",link:{name:""}},bottomTabBar:{control:!0,isShow:!0},popWindow:{imgUrl:"",imgWidth:"",imgHeight:"",count:"once",show:0,link:{name:""}},template:{textColor:"#303133",pageStartBgColor:"",pageEndBgColor:"",pageGradientAngle:"to bottom",componentBgUrl:"",componentBgAlpha:2,componentStartBgColor:"",componentEndBgColor:"",componentGradientAngle:"to bottom",topRounded:0,bottomRounded:0,elementBgColor:"",topElementRounded:0,bottomElementRounded:0,margin:{top:0,bottom:0,both:0},isHidden:!1}},this.value=[]},addComponent(e,n){if(!this.load)return;let t=s(n);t.id=this.generateRandom(),t.componentName=e,t.componentTitle=t.title,t.ignore=[],Object.assign(t,t.value),delete t.title,delete t.value,delete t.icon,delete t.render;let p=s(this.global.template);if(Object.assign(t,p),t.template&&(Object.assign(t,t.template),delete t.template),!this.checkComponentIsAdd(t)){l({type:"warning",message:`${t.componentTitle}${o("componentCanOnlyAdd")}${t.uses}${o("piece")}`});return}if(t.position&&this.position.indexOf(t.position)!=-1)t.position=="top_fixed"?(this.currentIndex=0,this.value.splice(0,0,t)):t.position=="bottom_fixed"?(this.value.splice(this.value.length,0,t),this.currentIndex=this.value.length-1):(this.currentIndex=0,this.value.splice(0,0,t));else if(this.currentIndex===-99){let i=this.currentIndex;for(let r=this.value.length-1;r>=0;r--)if(this.value[r].position=="bottom_fixed"){i=r;break}i==-99?(this.value.push(t),this.currentIndex=this.value.length-1):(this.value.splice(i,0,t),this.currentIndex=i)}else{let i=-1;for(let r=this.value.length-1;r>=0;r--)if(this.value[r].position&&this.value[r].position=="bottom_fixed"){i=r;break}i!=-1&&(i==this.currentIndex||i-this.currentIndex==1)?i==-1?this.value.splice(++this.currentIndex,0,t):(this.value.splice(i,0,t),this.currentIndex=i):this.value.splice(++this.currentIndex,0,t)}this.currentComponent=t.path},generateRandom(e=5){return Number(Math.random().toString().substr(3,e)+Date.now()).toString(36)},postMessage(){const e=JSON.stringify({pageMode:this.pageMode,currentIndex:this.currentIndex,global:a(this.global),value:a(this.value)});window.previewIframe.contentWindow.postMessage(e,"*")},changeCurrentIndex(e,n=null){this.currentIndex=e,this.currentIndex==-99?this.currentComponent="edit-page":n&&(this.currentComponent=n.path)},delComponent(){this.currentIndex!=-99&&d.confirm(o("delComponentTips"),o("warning"),{confirmButtonText:o("confirm"),cancelButtonText:o("cancel"),type:"warning",autofocus:!1}).then(()=>{this.value.splice(this.currentIndex,1),this.value.length===0&&(this.currentIndex=-99),this.currentIndex===this.value.length&&this.currentIndex--;let e=s(this.value[this.currentIndex]);this.changeCurrentIndex(this.currentIndex,e)}).catch(()=>{})},moveUpComponent(){const e=s(this.value[this.currentIndex]);let n=this.currentIndex-1;const t=s(this.value[n]);if(!(this.currentIndex-1<0||t.position&&this.position.indexOf(t.position)!=-1)){if(e.id=this.generateRandom(),t.id=this.generateRandom(),e.position&&this.position.indexOf(e.position)!=-1){l({type:"warning",message:`${o("componentNotMoved")}`});return}this.value[this.currentIndex]=t,this.value[n]=e,this.changeCurrentIndex(n,e)}},moveDownComponent(){if(this.currentIndex<-1||this.currentIndex+1>=this.value.length)return;const e=this.currentIndex+1,n=s(this.value[this.currentIndex]);n.id=this.generateRandom();const t=s(this.value[e]);if(t.id=this.generateRandom(),!(t.position&&this.position.indexOf(t.position)!=-1)){if(n.position&&this.position.indexOf(n.position)!=-1){l({type:"warning",message:`${o("componentNotMoved")}`});return}this.value[this.currentIndex]=t,this.value[e]=n,this.changeCurrentIndex(e,n)}},copyComponent(){if(this.currentIndex<0)return;let e=s(this.value[this.currentIndex]);if(e.id=this.generateRandom(),!this.checkComponentIsAdd(e)){l({type:"warning",message:`${o("notCopy")}，${e.componentTitle}${o("componentCanOnlyAdd")}${e.uses}${o("piece")}`});return}if(e.position&&this.position.indexOf(e.position)!=-1){l({type:"warning",message:`${o("notCopy")}，${e.componentTitle}${o("componentCanOnlyAdd")}1${o("piece")}`});return}const n=this.currentIndex+1;this.value.splice(n,0,e),this.changeCurrentIndex(n,e)},checkComponentIsAdd(e){if(e.uses===0)return!0;let n=0;for(let t in this.value)this.value[t].componentName===e.componentName&&n++;return!(n>=e.uses)},resetComponent(){this.currentIndex<0||d.confirm(o("resetComponentTips"),o("warning"),{confirmButtonText:o("confirm"),cancelButtonText:o("cancel"),type:"warning",autofocus:!1}).then(()=>{for(let e=0;e<this.components.length;e++)if(this.components[e].componentName==this.editComponent.componentName){Object.assign(this.editComponent,this.components[e]);break}}).catch(()=>{})},verify(){if(this.pageTitle==="")return l({message:o("diyPageTitlePlaceholder"),type:"warning"}),this.changeCurrentIndex(-99),!1;if(this.global.popWindow.show&&!this.global.popWindow.imgUrl)return l({message:"请上传弹窗图片",type:"warning"}),!1;for(let e=0;e<this.value.length;e++)try{if(this.value[e].verify){const n=this.value[e].verify(e);if(!n.code)return this.changeCurrentIndex(e,this.value[e]),l({message:n.message,type:"warning"}),!1}}catch(n){console.log("verify Error:",n,e,this.value[e])}return!0}}}),g=h;export{g as u};
