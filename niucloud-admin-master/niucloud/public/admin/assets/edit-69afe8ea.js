import{d as Z,v as K,f as ee,r as w,l as te,X as le,k as a,h as u,c as b,e as r,w as d,u as o,ay as ae,J as re,m as F,a as s,t as f,F as x,T as V,i as R,B as D,K as oe,Y as z,az as ne,L as ie,D as de,G as se,a3 as pe,ah as ue,af as ce,ag as _e,aA as me,ap as fe,bk as ge,H as ve,E as be,M as he}from"./index-9f163f98.js";/* empty css                   *//* empty css                  *//* empty css                *//* empty css                          *//* empty css                    *//* empty css                  *//* empty css                       *//* empty css                 *//* empty css                 *//* empty css               *//* empty css                  *//* empty css                  *//* empty css                     *//* empty css                  */import"./el-form-item-4ed993c7.js";/* empty css                *//* empty css                       */import{g as xe,a as ke,b as ye,c as Ve,e as we,d as Pe}from"./printer-1b60d41f.js";const Ee={class:"main-container"},Ue={class:"panel-title !text-sm"},Ce={class:"text-[12px] text-[#b2b2b2]"},Te={class:"text-[12px] text-[#b2b2b2]"},Fe={class:"text-[12px] text-[#b2b2b2]"},Ne={class:"text-[12px] text-[#b2b2b2]"},Be={class:"panel-title !text-sm"},Me={class:"flex mb-[10px] py-[8px] bg-[#F5F7F9] text-[14px]"},qe={class:"px-[12px] w-[200px]"},Re={class:"px-[12px] w-[100px]"},$e={class:"px-[12px] w-[250px]"},De={class:"px-[12px] w-[200px]"},Le={class:"font-bold w-[200px] px-[12px]"},Oe={class:"w-[100px] px-[12px]"},je={class:"w-[250px] px-[12px]"},Se={key:0,class:"w-[300px] px-[12px] flex-1"},Ge={class:"w-[200px] px-[12px]"},He={class:"fixed-footer-wrap"},ze={class:"fixed-footer"},ct=Z({__name:"edit",setup(Ae){const L=K(),O=ee(),P=w(!1),N=w(!0),A=L.meta.title,I={printer_id:L.query.printer_id||0,brand:"",printer_name:"",printer_code:"",printer_key:"",open_id:"",apikey:"",template_type:[],trigger:[],value:{},print_width:"58mm",status:1},e=te({...I}),j=w(),J=le(()=>({printer_name:[{required:!0,message:a("printerNamePlaceholder"),trigger:"blur"}],brand:[{required:!0,message:a("brandPlaceholder"),trigger:"blur"}],printer_code:[{required:!0,message:a("printerCodePlaceholder"),trigger:"blur"}],printer_key:[{required:!0,message:a("printerKeyPlaceholder"),trigger:"blur"}],open_id:[{required:!0,message:a("openIdPlaceholder"),trigger:"blur"}],apikey:[{required:!0,message:a("apikeyPlaceholder"),trigger:"blur"}]})),k=w([]);(async()=>{await ye({}).then(v=>{if(v.data){k.value=v.data;for(let l=0;l<k.value.length;l++){let n=k.value[l];e.value[n.key]={};let i={};for(let _=0;_<n.condition.length;_++){let m=n.condition[_];if(i[m.key]=[],m.type=="checkbox"){i[m.key]=[];for(let p=0;p<m.list.length;p++)i[m.key].push(m.list[p].value)}}for(let _ in n.trigger)e.value[n.key]["trigger_"+_]={status:1,template_id:"",print_num:1},Object.assign(e.value[n.key]["trigger_"+_],oe(i))}}e.printer_id||(N.value=!1)}),e.printer_id&&Ve(e.printer_id).then(v=>{let l=v.data;l&&Object.keys(e).forEach(n=>{if(l[n]!=null)if(n=="value")for(let i in e[n])Object.assign(e[n][i],l[n][i]);else e[n]=l[n]}),N.value=!1})})();const S=w([]);xe({}).then(v=>{S.value=v.data});const B=w({});ke({}).then(v=>{if(v.data){let l=v.data;for(let n=0;n<l.length;n++){let i=l[n];B.value[i.template_type]==null&&(B.value[i.template_type]=[]),B.value[i.template_type].push({template_id:i.template_id,template_name:i.template_name})}}});const W=async v=>{if(N.value||!v)return;if(k.value.length==0){z({type:"warning",message:a("printTypeEmpty")});return}let l=e.printer_id?we:Pe;await v.validate(async n=>{if(n){let i=!1,_="";for(let p=0;p<k.value.length;p++){let c=k.value[p];for(let E=0;E<Object.keys(c.trigger).length;E++){let y=Object.keys(c.trigger)[E];if(e.value[c.key]["trigger_"+y].status==0)continue;if(!e.value[c.key]["trigger_"+y].template_id){i=!0,_=`请设置${c.title}[${c.trigger[y]}]的小票打印模板`;break}let U=!1;for(let C=0;C<c.condition.length;C++){let T=c.condition[C];if(T.type=="checkbox"&&e.value[c.key]["trigger_"+y][T.key].length==0){i=!0,_=`请设置${c.title}[${c.trigger[y]}]的${T.title}`,U=!0;break}}if(U)break}if(i)break}if(i){z({type:"warning",message:_});return}e.template_type=[],e.trigger=[];for(let p in e.value){for(let c in e.value[p])e.trigger.push(p+"_"+c);e.template_type.push(p)}if(P.value)return;P.value=!0,l(e).then(p=>{P.value=!1,e.printer_id||O.push("/printer/list")}).catch(p=>{P.value=!1})}})},G=()=>{O.push("/printer/list")};return(v,l)=>{const n=ne,i=ie,_=de,m=se,p=pe,c=ue,E=ce,y=_e,U=me,C=fe,T=ge,X=ve,H=be,Y=he;return u(),b("div",Ee,[r(i,{class:"card !border-none mb-[15px]",shadow:"never"},{default:d(()=>[r(n,{content:o(A),icon:o(ae),onBack:G},null,8,["content","icon"])]),_:1}),re((u(),F(X,{class:"page-form",model:e,rules:o(J),"label-width":"150px",ref_key:"formRef",ref:j},{default:d(()=>[r(i,{class:"box-card !border-none",shadow:"never"},{default:d(()=>[s("h3",Ue,f(o(a)("printerSet")),1),r(m,{label:o(a)("printerName"),prop:"printer_name"},{default:d(()=>[r(_,{modelValue:e.printer_name,"onUpdate:modelValue":l[0]||(l[0]=t=>e.printer_name=t),modelModifiers:{trim:!0},clearable:"",placeholder:o(a)("printerNamePlaceholder"),class:"input-width",maxlength:"20"},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),r(m,{label:o(a)("brand"),prop:"brand"},{default:d(()=>[r(c,{modelValue:e.brand,"onUpdate:modelValue":l[1]||(l[1]=t=>e.brand=t),placeholder:o(a)("brandPlaceholder"),clearable:""},{default:d(()=>[(u(!0),b(x,null,V(S.value,(t,$)=>(u(),F(p,{key:$,label:t,value:$},null,8,["label","value"]))),128))]),_:1},8,["modelValue","placeholder"])]),_:1},8,["label"]),r(m,{label:o(a)("printerCode"),prop:"printer_code"},{default:d(()=>[s("div",null,[r(_,{modelValue:e.printer_code,"onUpdate:modelValue":l[2]||(l[2]=t=>e.printer_code=t),modelModifiers:{trim:!0},clearable:"",placeholder:o(a)("printerCodePlaceholder"),class:"input-width",maxlength:"30"},null,8,["modelValue","placeholder"]),s("p",Ce,f(o(a)("printerCodeTips")),1)])]),_:1},8,["label"]),r(m,{label:o(a)("printerKey"),prop:"printer_key"},{default:d(()=>[s("div",null,[r(_,{modelValue:e.printer_key,"onUpdate:modelValue":l[3]||(l[3]=t=>e.printer_key=t),modelModifiers:{trim:!0},clearable:"",placeholder:o(a)("printerKeyPlaceholder"),class:"input-width",maxlength:"30"},null,8,["modelValue","placeholder"]),s("p",Te,f(o(a)("printerKeyTips")),1)])]),_:1},8,["label"]),r(m,{label:o(a)("openId"),prop:"open_id"},{default:d(()=>[s("div",null,[r(_,{modelValue:e.open_id,"onUpdate:modelValue":l[4]||(l[4]=t=>e.open_id=t),modelModifiers:{trim:!0},clearable:"",placeholder:o(a)("openIdPlaceholder"),class:"input-width",maxlength:"30"},null,8,["modelValue","placeholder"]),s("p",Fe,f(o(a)("openIdTips")),1)])]),_:1},8,["label"]),r(m,{label:o(a)("apikey"),prop:"apikey"},{default:d(()=>[s("div",null,[r(_,{modelValue:e.apikey,"onUpdate:modelValue":l[5]||(l[5]=t=>e.apikey=t),modelModifiers:{trim:!0},clearable:"",placeholder:o(a)("apikeyPlaceholder"),class:"input-width",maxlength:"60"},null,8,["modelValue","placeholder"]),s("p",Ne,f(o(a)("apikeyTips")),1)])]),_:1},8,["label"]),r(m,{label:o(a)("printWidth"),prop:"print_width"},{default:d(()=>[r(y,{modelValue:e.print_width,"onUpdate:modelValue":l[6]||(l[6]=t=>e.print_width=t)},{default:d(()=>[r(E,{label:"58mm"},{default:d(()=>[R("58mm")]),_:1})]),_:1},8,["modelValue"])]),_:1},8,["label"]),r(m,{label:o(a)("status")},{default:d(()=>[r(U,{modelValue:e.status,"onUpdate:modelValue":l[7]||(l[7]=t=>e.status=t),"active-value":1,"inactive-value":0},null,8,["modelValue"])]),_:1},8,["label"])]),_:1}),(u(!0),b(x,null,V(k.value,(t,$)=>(u(),F(i,{key:t.key,class:"box-card !border-none",shadow:"never"},{default:d(()=>[s("h3",Be,f(t.title),1),s("div",Me,[s("div",qe,f(o(a)("printTrigger")),1),s("div",Re,f(o(a)("status")),1),s("div",$e,f(o(a)("usePrintTemplate")),1),(u(!0),b(x,null,V(t.condition,M=>(u(),b("div",{class:"px-[12px] w-[300px] flex-1",key:M.key},f(M.title),1))),128)),s("div",De,f(o(a)("printNum")),1)]),t.trigger?(u(!0),b(x,{key:0},V(t.trigger,(M,h)=>(u(),b("div",{class:"flex bg-[#f8f8f9] mb-[10px] py-[20px]",key:h},[e.value[t.key]["trigger_"+h]?(u(),b(x,{key:0},[s("div",Le,f(M),1),s("div",Oe,[r(U,{modelValue:e.value[t.key]["trigger_"+h].status,"onUpdate:modelValue":g=>e.value[t.key]["trigger_"+h].status=g,"active-value":1,"inactive-value":0},null,8,["modelValue","onUpdate:modelValue"])]),s("div",je,[r(c,{modelValue:e.value[t.key]["trigger_"+h].template_id,"onUpdate:modelValue":g=>e.value[t.key]["trigger_"+h].template_id=g,placeholder:o(a)("请选择小票打印模板"),clearable:""},{default:d(()=>[(u(!0),b(x,null,V(B.value[t.key],g=>(u(),F(p,{key:g.template_id,label:g.template_name,value:g.template_id},null,8,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue","placeholder"])]),(u(!0),b(x,null,V(t.condition,g=>(u(),b(x,null,[g.type=="checkbox"?(u(),b("div",Se,[r(T,{modelValue:e.value[t.key]["trigger_"+h][g.key],"onUpdate:modelValue":q=>e.value[t.key]["trigger_"+h][g.key]=q},{default:d(()=>[(u(!0),b(x,null,V(g.list,(q,Q)=>(u(),F(C,{label:q.value,key:Q},{default:d(()=>[R(f(q.name),1)]),_:2},1032,["label"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue"])])):D("",!0)],64))),256)),s("div",Ge,[r(c,{modelValue:e.value[t.key]["trigger_"+h].print_num,"onUpdate:modelValue":g=>e.value[t.key]["trigger_"+h].print_num=g},{default:d(()=>[r(p,{label:"1联",value:1}),r(p,{label:"2联",value:2}),r(p,{label:"3联",value:3}),r(p,{label:"4联",value:4})]),_:2},1032,["modelValue","onUpdate:modelValue"])])],64)):D("",!0)]))),128)):D("",!0)]),_:2},1024))),128))]),_:1},8,["model","rules"])),[[Y,N.value]]),s("div",He,[s("div",ze,[r(H,{type:"primary",loading:P.value,onClick:l[8]||(l[8]=t=>W(j.value))},{default:d(()=>[R(f(o(a)("save")),1)]),_:1},8,["loading"]),r(H,{onClick:l[9]||(l[9]=t=>G())},{default:d(()=>[R(f(o(a)("cancel")),1)]),_:1})])])])}}});export{ct as default};
