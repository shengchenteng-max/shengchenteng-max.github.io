import{d as pe,v as me,f as ue,r as u,l as _e,as as fe,bf as he,bg as ve,N as D,h as _,c as A,e as t,w as a,a as c,t as d,u as o,k as e,i as f,F as ge,T as be,m as x,J as O,B as xe,a4 as R,Y as ye,z as ke,E as we,at as Ce,au as Ee,ac as Te,a3 as Fe,ah as Ve,G as De,D as Ne,H as Pe,L as Se,a5 as Be,a6 as Ae,a7 as Le,ad as $e,Q as je,aq as ze,a2 as Ge,S as Ue,M as Me}from"./index-9f163f98.js";/* empty css                   *//* empty css                  *//* empty css                   *//* empty css                     *//* empty css                *//* empty css                    *//* empty css                    *//* empty css                      *//* empty css                 *//* empty css               *//* empty css                  *//* empty css                  *//* empty css                  *//* empty css                 */import"./el-tooltip-4ed993c7.js";/* empty css                        *//* empty css                *//* empty css                */import"./el-form-item-4ed993c7.js";/* empty css                *//* empty css                  */import{t as Oe,g as Re,u as Ie,r as qe,s as He,v as Je}from"./tools-3c2d984d.js";import{_ as Ke}from"./add-table.vue_vue_type_script_setup_true_lang-03fda2e7.js";const Qe={class:"main-container"},Ye={class:"flex justify-between items-center"},We={class:"text-page-title"},Xe={class:"text-[14px] font-[700]"},Ze={class:"text-[#999]"},et={class:"mt-[20px] mb-[40px] h-[32px]"},tt={class:"text-[14px] font-[700]"},at={class:"text-[#999]"},lt=c("div",{class:"mt-[20px] mb-[40px] h-[32px]"},null,-1),ot={class:"text-[14px] font-[700]"},nt={class:"text-[#999]"},st=c("div",{class:"mt-[20px] mb-[40px] h-[32px]"},null,-1),it={class:"text-[14px] font-[700]"},dt={class:"text-[#999]"},ct=c("div",{class:"mt-[20px] mb-[40px] h-[32px]"},null,-1),rt={class:"text-[14px] font-[700]"},pt={class:"text-[#999]"},mt=c("div",{class:"mt-[20px] mb-[40px] h-[32px]"},null,-1),ut={class:"mt-[16px] flex justify-end"},_t={class:"flex h-[50vh]"},ft={class:"flex items-center"},ht={class:"pl-[5px]"},vt={class:"ml-[20px]",style:{width:"calc(100% - 285px)"}},It=pe({__name:"index",setup(gt){const I=me().meta.title,q=ue(),N=u("codeGeneration"),n=_e({page:1,limit:10,total:0,loading:!0,data:[],searchParam:{table_name:"",table_content:"",addon_name:""}}),L=u(),H=i=>{i&&(i.resetFields(),v())};fe(()=>{window.codeActiveName&&(N.value=window.codeActiveName+"",window.codeActiveName=null),v(he(n.searchParam).page)});const v=(i=1)=>{n.loading=!0,n.page=i,Oe({page:n.page,limit:n.limit,...n.searchParam}).then(l=>{n.loading=!1,n.data=l.data.data,n.total=l.data.total,ve(n.page,n.limit,n.searchParam)}).catch(()=>{n.loading=!1})},$=u([]),J=i=>{Re({search:i}).then(l=>{$.value=l.data})},P=u(null),K=()=>{P.value.setFormData(),P.value.showDialog=!0},Q=i=>{R.confirm(e("codeDeleteTips"),e("warning"),{confirmButtonText:e("confirm"),cancelButtonText:e("cancel"),type:"warning"}).then(()=>{Ie(i).then(()=>{v()}).catch(()=>{})})},Y=i=>{q.push("/tools/code/edit?id="+i.id)},W=i=>{qe({id:i}).then(l=>{n.loading=!1,R.confirm(l.msg!="2"?e("saveAndSyncText"):e("saveAndSyncText1"),e("warning"),{confirmButtonText:e("confirm"),cancelButtonText:e("cancel")}).then(()=>{j(i,3)}).catch(()=>{})}).catch(()=>{n.loading=!1})},j=(i,l)=>{n.loading=!0,He({id:i,generate_type:l}).then(r=>{ye({type:"success",message:"操作成功"}),l!=3?(n.loading=!1,window.open(ke(r.data.file),"_blank")):v()}).catch(()=>{n.loading=!1})},S=u([]),B=u(!1),w=u([]),C=u(!1),E=u(""),T=u(""),X=i=>{B.value=!0,C.value=!0,E.value="",w.value=[],T.value="",Je(i).then(l=>{S.value=l.data,w.value=ee(l.data.map(r=>r.file_dir+r.name)),E.value=S.value[0].content,C.value=!1}).catch(()=>{C.value=!1})},Z=i=>{S.value.forEach(l=>{i.path===l.file_dir+l.name&&(E.value=l.content)})},ee=i=>{const l=[];if(Array.isArray(i))for(let m=0;m<i.length;++m){const F=i[m].split("/");let g=l;for(let h=0;h<F.length;++h){const y=F[h];let p=null;for(var r=0;r<g.length;++r){const V=g[r];if(V.name===y){p=V;break}}p||(p={name:y,path:y.indexOf(".")<0?"":i[m],key:"k"+m+h+r},y.indexOf(".")<0&&(p.children=[]),p.path===i[0]&&(T.value=p.key),g.push(p)),p.children&&(g=p.children)}}return l};return(i,l)=>{const r=we,m=Ce,F=Ee,g=Te,h=Fe,y=Ve,p=De,V=Ne,te=Pe,z=Se,k=Be,ae=Ae,le=Le,oe=$e,ne=D("Folder"),se=D("FolderOpened"),G=je,ie=D("Document"),de=ze,U=Ge,ce=D("highlightjs"),re=Ue,M=Me;return _(),A("div",Qe,[t(z,{class:"box-card !border-none",shadow:"never"},{default:a(()=>[c("div",Ye,[c("span",We,d(o(I)),1)]),t(oe,{modelValue:N.value,"onUpdate:modelValue":l[7]||(l[7]=s=>N.value=s),class:"mt-[20px]"},{default:a(()=>[t(g,{label:o(e)("codeGeneration"),name:"codeGeneration"},{default:a(()=>[t(F,{active:5,direction:"vertical"},{default:a(()=>[t(m,null,{title:a(()=>[c("p",Xe,d(o(e)("step1")),1)]),description:a(()=>[c("span",Ze,d(o(e)("describe1")),1),c("div",et,[t(r,{type:"primary",class:"w-[100px]",onClick:K},{default:a(()=>[f(d(o(e)("btn1")),1)]),_:1})])]),_:1}),t(m,null,{title:a(()=>[c("p",tt,d(o(e)("step2")),1)]),description:a(()=>[c("span",at,d(o(e)("describe2")),1),lt]),_:1}),t(m,null,{title:a(()=>[c("p",ot,d(o(e)("step3")),1)]),description:a(()=>[c("span",nt,d(o(e)("describe3")),1),st]),_:1}),t(m,null,{title:a(()=>[c("p",it,d(o(e)("step4")),1)]),description:a(()=>[c("span",dt,d(o(e)("describe4")),1),ct]),_:1}),t(m,null,{title:a(()=>[c("p",rt,d(o(e)("step5")),1)]),description:a(()=>[c("span",pt,d(o(e)("describe5")),1),mt]),_:1})]),_:1})]),_:1},8,["label"]),t(g,{label:o(e)("codeList"),name:"codeList"},{default:a(()=>[t(z,{class:"box-card !border-none my-[10px] table-search-wrap",shadow:"never"},{default:a(()=>[t(te,{inline:!0,model:n.searchParam,ref_key:"searchFormRef",ref:L},{default:a(()=>[t(p,{label:o(e)("addonName"),prop:"addon_name"},{default:a(()=>[t(y,{modelValue:n.searchParam.addon_name,"onUpdate:modelValue":l[0]||(l[0]=s=>n.searchParam.addon_name=s),placeholder:"全部",filterable:"",remote:"",clearable:"","remote-method":J},{default:a(()=>[t(h,{label:"全部",value:""}),t(h,{label:"系统",value:"2"}),(_(!0),A(ge,null,be($.value,s=>(_(),x(h,{label:s.title,value:s.key,key:s.key},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1},8,["label"]),t(p,{label:o(e)("tableName"),prop:"table_name"},{default:a(()=>[t(V,{modelValue:n.searchParam.table_name,"onUpdate:modelValue":l[1]||(l[1]=s=>n.searchParam.table_name=s),modelModifiers:{trim:!0},placeholder:o(e)("tableNamePlaceholder")},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),t(p,null,{default:a(()=>[t(r,{type:"primary",onClick:l[2]||(l[2]=s=>v())},{default:a(()=>[f(d(o(e)("search")),1)]),_:1}),t(r,{onClick:l[3]||(l[3]=s=>H(L.value))},{default:a(()=>[f(d(o(e)("reset")),1)]),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),c("div",null,[O((_(),x(ae,{data:n.data,size:"large"},{empty:a(()=>[c("span",null,d(n.loading?"":o(e)("emptyData")),1)]),default:a(()=>[t(k,{prop:"table_name","show-overflow-tooltip":!0,label:o(e)("tableName"),"min-width":"120"},null,8,["label"]),t(k,{prop:"title","show-overflow-tooltip":!0,label:o(e)("addonName"),"min-width":"120"},null,8,["label"]),t(k,{prop:"table_content","show-overflow-tooltip":!0,label:o(e)("tableContent"),"min-width":"120"},null,8,["label"]),t(k,{prop:"edit_type",label:o(e)("editType"),"min-width":"150",align:"center"},{default:a(({row:s})=>[f(d(s.edit_type==1?o(e)("popup"):o(e)("page")),1)]),_:1},8,["label"]),t(k,{label:o(e)("createTime"),"min-width":"180",align:"center"},{default:a(({row:s})=>[f(d(s.create_time||""),1)]),_:1},8,["label"]),t(k,{label:o(e)("operation"),fixed:"right",align:"right",width:"330"},{default:a(({row:s})=>[t(r,{type:"primary",link:"",onClick:b=>Y(s)},{default:a(()=>[f(d(o(e)("edit")),1)]),_:2},1032,["onClick"]),t(r,{type:"primary",link:"",onClick:b=>X(s.id)},{default:a(()=>[f(d(o(e)("preview")),1)]),_:2},1032,["onClick"]),t(r,{type:"primary",link:"",onClick:b=>W(s.id)},{default:a(()=>[f(d(o(e)("saveAndSync")),1)]),_:2},1032,["onClick"]),t(r,{type:"primary",link:"",onClick:b=>j(s.id,2)},{default:a(()=>[f(d(o(e)("download")),1)]),_:2},1032,["onClick"]),t(r,{type:"primary",link:"",onClick:b=>Q(s.id)},{default:a(()=>[f(d(o(e)("delete")),1)]),_:2},1032,["onClick"])]),_:1},8,["label"])]),_:1},8,["data"])),[[M,n.loading]]),c("div",ut,[t(le,{"current-page":n.page,"onUpdate:current-page":l[4]||(l[4]=s=>n.page=s),"page-size":n.limit,"onUpdate:page-size":l[5]||(l[5]=s=>n.limit=s),layout:"total, sizes, prev, pager, next, jumper",total:n.total,onSizeChange:l[6]||(l[6]=s=>v()),onCurrentChange:v},null,8,["current-page","page-size","total"])])])]),_:1},8,["label"])]),_:1},8,["modelValue"]),t(Ke,{ref_key:"addCodeDialog",ref:P},null,512),t(re,{modelValue:B.value,"onUpdate:modelValue":l[8]||(l[8]=s=>B.value=s),class:"dialog-visible",width:"70%",title:"代码预览"},{default:a(()=>[O((_(),A("div",_t,[t(U,{class:"h-[100%] w-[270px]"},{default:a(()=>[w.value.length&&T.value!=""?(_(),x(de,{key:0,data:w.value,props:{label:"name",value:"key"},"node-key":"key","current-node-key":T.value,"expand-on-click-node":!1,"highlight-current":"","default-expand-all":"",ref:"treeRef",onNodeClick:Z},{default:a(({node:s,data:b})=>[c("div",ft,[b.children?(_(),x(G,{key:0},{default:a(()=>[s.expanded?(_(),x(se,{key:1})):(_(),x(ne,{key:0}))]),_:2},1024)):(_(),x(G,{key:1},{default:a(()=>[t(ie)]),_:1})),c("span",ht,d(b.name),1)])]),_:1},8,["data","current-node-key"])):xe("",!0)]),_:1}),c("div",vt,[t(U,{class:"h-[100%] w-[100%]"},{default:a(()=>[t(ce,{autodetect:"",class:"h-[100%]",code:E.value},null,8,["code"])]),_:1})])])),[[M,C.value]])]),_:1},8,["modelValue"])]),_:1})])}}});export{It as default};
