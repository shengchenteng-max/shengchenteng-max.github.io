import{d as de,l as _e,al as Y,r as b,as as fe,X as I,Y as S,h as d,c as h,a as p,e as l,w as t,u as n,k as s,F as R,T as U,m as g,i as c,t as i,J as q,B as D,a4 as ce,D as ve,G as be,a3 as ye,ah as ge,E as ke,H as he,a5 as xe,a6 as Ve,a7 as Ee,S as Ce,af as je,ag as Te,aE as De,ab as Pe,M as we}from"./index-9f163f98.js";/* empty css                   *//* empty css               *//* empty css                 *//* empty css                       *//* empty css                 *//* empty css                  *//* empty css                   *//* empty css                      *//* empty css                 *//* empty css                  *//* empty css                  *//* empty css                     *//* empty css                  *//* empty css                 *//* empty css                    */import"./el-tooltip-4ed993c7.js";/* empty css                        *//* empty css                *//* empty css                  */import"./el-form-item-4ed993c7.js";import{u as Re,v as Ue,w as $e,x as Be,y as Fe,z as Se}from"./notice-730edd18.js";/* empty css                       *//* empty css                   */const Le={class:"flex justify-between items-start my-[10px]"},Ne={key:0,class:"text-red-600"},Oe={class:"mt-[16px] flex justify-end"},Ie={class:"dialog-footer"},Me={class:"input-width"},ze=p("div",{class:"ml-[100px] mb-[10px] mt-[-10px] text-[12px] text-[#999] leading-[20px]"},[p("div",null,"验证码：仅支持验证码类型变量"),p("div",null,"行业通知：不支持验证码类型变量"),p("div",null,"营销推广：不支持变量")],-1),Ae={class:"flex flex-1 items-center"},Ge={class:"w-32 mr-1"},Je={class:"dialog-footer"},He={key:0,class:"h-[500px] overflow-y-auto"},We={class:"dialog-footer"},gt=de({__name:"sms_template",props:{username:{type:String,default:""},signature:{type:String,default:""}},setup(K){const E=K,r=_e({page:1,limit:10,total:0,loading:!1,data:[],allData:[],searchParam:{template_id:"",name:"",status:""}}),Q=()=>{const{template_id:o,name:a,status:y}=r.searchParam;return r.allData.filter(_=>{const x=!o||String(_.template_id||"").includes(o),C=!a||String(_.name||"").includes(a),v=!y||_.audit_info.audit_status==y;return x&&C&&v})};Y(()=>[r.limit,r.page],()=>{A()});const j=()=>{r.loading=!0,Re({sms_type:"niuyun",username:E.username}).then(o=>{r.allData=o.data,r.page=1,A()}).catch(()=>{r.loading=!1})},M=b(null),Z=o=>{o&&(r.searchParam={template_id:"",name:"",status:""},j())},z=b([]),A=()=>{const o=Q();r.total=o.length;const a=(r.page-1)*r.limit,y=a+r.limit;z.value=o.slice(a,y),r.loading=!1};fe(()=>{E.username&&j()});const P=b(!1),w=b({}),ee=()=>{Ue("niuyun",E.username).then(o=>{w.value=o.data.repeat_list,w.value&&Object.keys(w.value).length>0?P.value=!0:j()})},te=I(()=>Object.entries(w.value).map(([o,a])=>({name:o,platforms:a}))),u=b(null),$=b(!1),ae=o=>{$.value=!0,u.value=o},le=o=>{ce.confirm(s("确定要清除报备信息吗"),s("提示"),{confirmButtonText:s("确定"),cancelButtonText:s("取消"),type:"warning"}).then(()=>{$e(E.username,o.template_id).then(()=>{j()})}).catch(()=>{})},L=b({}),G=b({}),J=b({}),T=b(!1),f=b({template_type:1,template_key:"",params_json:{}});(()=>{Be().then(o=>{L.value=o.data.template_params_type_list,G.value=o.data.template_type_list,J.value=o.data.template_status_list})})();const ne=I(()=>f.value.template_type===1?L.value.filter(o=>o.type==="valid_code"):L.value),N=I(()=>f.value.template_type===3&&u.value.variable&&Object.keys(u.value.variable).length>0);Y(N,o=>{o&&S.error("营销推广类型不支持变量")});const B=b(!1),se=o=>{B.value=!0,E.signature?o.template_id?(T.value=!0,u.value=o,Fe("niuyun",E.username,{template_key:o.key}).then(y=>{var x;const _=((x=y.data)==null?void 0:x.param_json)??{};if(f.value.template_key=y.data.template_key,f.value.template_type=Number(y.data.template_type),f.value.params_json={},u.value.variable)for(const C in u.value.variable)f.value.params_json[C]=_[C]??"";B.value=!1})):(T.value=!0,B.value=!1,u.value=o,f.value.template_type=1,f.value.template_key=u.value.key,f.value.params_json={}):S.error("请先配置签名")},oe=()=>{if(!u.value.sms){S.error("请先配置模版内容");return}if(Object.entries(u.value.variable).some(([a])=>!f.value.params_json[a])){S.error("请为每个变量选择类型");return}u.value.template_id&&(f.value.template_id=Number(u.value.template_id)),Se(u.value.sms_type,E.username,f.value).then(a=>{T.value=!1,j()})};return(o,a)=>{const y=ve,_=be,x=ye,C=ge,v=ke,F=he,V=xe,H=Ve,re=Ee,O=Ce,ie=je,ue=Te,pe=De,me=Pe,W=we;return d(),h("div",null,[p("div",Le,[l(F,{inline:!0,model:r.searchParam,ref_key:"searchFormRef",ref:M},{default:t(()=>[l(_,{label:n(s)("模版ID"),prop:"template_id"},{default:t(()=>[l(y,{modelValue:r.searchParam.template_id,"onUpdate:modelValue":a[0]||(a[0]=e=>r.searchParam.template_id=e),modelModifiers:{trim:!0},placeholder:n(s)("请输入模版ID")},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),l(_,{label:n(s)("模版名称"),prop:"name"},{default:t(()=>[l(y,{modelValue:r.searchParam.name,"onUpdate:modelValue":a[1]||(a[1]=e=>r.searchParam.name=e),modelModifiers:{trim:!0},placeholder:n(s)("请输入模版名称")},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),l(_,{label:n(s)("状态"),prop:"status"},{default:t(()=>[l(C,{modelValue:r.searchParam.status,"onUpdate:modelValue":a[2]||(a[2]=e=>r.searchParam.status=e),placeholder:n(s)("请选择状态")},{default:t(()=>[l(x,{label:n(s)("全部"),value:""},null,8,["label"]),(d(!0),h(R,null,U(J.value,(e,m)=>(d(),g(x,{key:m,label:e,value:m},null,8,["label","value"]))),128))]),_:1},8,["modelValue","placeholder"])]),_:1},8,["label"]),l(_,null,{default:t(()=>[l(v,{type:"primary",onClick:a[3]||(a[3]=e=>j())},{default:t(()=>[c(i(n(s)("search")),1)]),_:1}),l(v,{onClick:a[4]||(a[4]=e=>Z(M.value))},{default:t(()=>[c(i(n(s)("reset")),1)]),_:1})]),_:1})]),_:1},8,["model"]),l(v,{type:"primary",onClick:a[5]||(a[5]=e=>ee())},{default:t(()=>[c(i(n(s)("同步模版状态")),1)]),_:1})]),q((d(),g(H,{data:z.value,size:"large",ref:"goodBankListTableRef"},{empty:t(()=>[p("span",null,i(r.loading?"":n(s)("emptyData")),1)]),default:t(()=>[l(V,{prop:"template_id",label:n(s)("模版ID"),"min-width":"100"},null,8,["label"]),l(V,{prop:"name",label:n(s)("模版名称"),"min-width":"130"},null,8,["label"]),l(V,{prop:"template_type_name",label:n(s)("模版类型"),"min-width":"130"},{default:t(({row:e})=>[p("div",null,i(e.template_type_name?e.template_type_name:"--"),1)]),_:1},8,["label"]),l(V,{prop:"sms",label:n(s)("模版内容"),"min-width":"200"},{default:t(({row:e})=>{var m;return[p("div",null,i((m=e.sms)==null?void 0:m.content),1)]}),_:1},8,["label"]),l(V,{prop:"audit_info",label:n(s)("审核状态"),"min-width":"130"},{default:t(({row:e})=>{var m,k,X;return[p("div",null,[c(i((m=e.audit_info)==null?void 0:m.audit_status_name)+" ",1),(k=e.audit_info)!=null&&k.error_status_name?(d(),h("span",Ne,"（"+i((X=e.audit_info)==null?void 0:X.error_status_name)+"）",1)):D("",!0)])]}),_:1},8,["label"]),l(V,{label:n(s)("operation"),fixed:"right",align:"right","min-width":"120"},{default:t(({row:e})=>[e.audit_info.audit_status!=2?(d(),g(v,{key:0,type:"primary",link:"",onClick:m=>se(e)},{default:t(()=>[c(i(e.audit_info.audit_status!=1&&e.audit_info.audit_status!=2?n(s)("报备"):n(s)("修改")),1)]),_:2},1032,["onClick"])):D("",!0),e.audit_info.audit_status==2?(d(),g(v,{key:1,type:"primary",link:"",onClick:m=>le(e)},{default:t(()=>[c(i(n(s)("清除报备信息")),1)]),_:2},1032,["onClick"])):D("",!0),l(v,{type:"primary",link:"",onClick:m=>ae(e)},{default:t(()=>[c(i(n(s)("详情")),1)]),_:2},1032,["onClick"])]),_:1},8,["label"])]),_:1},8,["data"])),[[W,r.loading]]),p("div",Oe,[l(re,{"current-page":r.page,"onUpdate:current-page":a[6]||(a[6]=e=>r.page=e),"page-size":r.limit,"onUpdate:page-size":a[7]||(a[7]=e=>r.limit=e),layout:"total, sizes, prev, pager, next, jumper",total:r.total},null,8,["current-page","page-size","total"])]),l(O,{modelValue:$.value,"onUpdate:modelValue":a[9]||(a[9]=e=>$.value=e),title:n(s)("模版详情"),width:"600px","destroy-on-close":""},{footer:t(()=>[p("span",Ie,[l(v,{type:"primary",onClick:a[8]||(a[8]=e=>$.value=!1)},{default:t(()=>[c(i(n(s)("confirm")),1)]),_:1})])]),default:t(()=>[l(F,{"label-width":"100px",ref:"formRef",class:"page-form"},{default:t(()=>[l(_,{label:n(s)("短信类型"),prop:"template_id"},{default:t(()=>[p("div",null,i(u.value.sms_type),1)]),_:1},8,["label"]),l(_,{label:n(s)("模版名称"),prop:"template_id"},{default:t(()=>[p("div",null,i(u.value.name),1)]),_:1},8,["label"]),l(_,{label:n(s)("模版类型"),prop:"title"},{default:t(()=>[p("div",null,i(u.value.title),1)]),_:1},8,["label"]),u.value.sms?(d(),g(_,{key:0,label:n(s)("短信内容"),prop:"title"},{default:t(()=>{var e;return[p("div",null,i((e=u.value.sms)==null?void 0:e.content),1)]}),_:1},8,["label"])):D("",!0),l(_,{label:n(s)("审核状态"),prop:"title"},{default:t(()=>[p("div",null,i(u.value.audit_info.audit_status_name),1)]),_:1},8,["label"])]),_:1},512)]),_:1},8,["modelValue","title"]),l(O,{modelValue:T.value,"onUpdate:modelValue":a[13]||(a[13]=e=>T.value=e),title:n(s)("模版报备"),width:"820px","destroy-on-close":""},{footer:t(()=>[p("span",Je,[l(v,{onClick:a[11]||(a[11]=e=>T.value=!1)},{default:t(()=>[c(i(n(s)("cancel")),1)]),_:1}),l(v,{type:"primary",onClick:a[12]||(a[12]=e=>oe()),disabled:n(N)},{default:t(()=>[c(i(n(s)("confirm")),1)]),_:1},8,["disabled"])])]),default:t(()=>[q((d(),g(F,{"label-width":"100px",ref:"formRef",class:"page-form"},{default:t(()=>[l(_,{label:n(s)("模版名称"),prop:"template_id"},{default:t(()=>[p("div",Me,i(u.value.name),1)]),_:1},8,["label"]),l(_,{label:n(s)("模版类型"),prop:"title"},{default:t(()=>[l(ue,{modelValue:f.value.template_type,"onUpdate:modelValue":a[10]||(a[10]=e=>f.value.template_type=e)},{default:t(()=>[(d(!0),h(R,null,U(Object.entries(G.value),([e,m])=>(d(),g(ie,{key:e,label:Number(e)},{default:t(()=>[c(i(m),1)]),_:2},1032,["label"]))),128))]),_:1},8,["modelValue"])]),_:1},8,["label"]),ze,u.value.variable&&Object.keys(u.value.variable).length>0?(d(),g(_,{key:0,label:n(s)("变量类型"),prop:"params_json"},{default:t(()=>[(d(!0),h(R,null,U(u.value.variable,(e,m)=>(d(),h("div",{key:m,class:"mb-2 flex items-center"},[p("div",Ae,[p("div",Ge,i(e),1),l(C,{modelValue:f.value.params_json[m],"onUpdate:modelValue":k=>f.value.params_json[m]=k,placeholder:"请选择类型",class:"flex-1",filterable:"",clearable:"",disabled:n(N)},{default:t(()=>[(d(!0),h(R,null,U(n(ne),k=>(d(),g(x,{key:k.type,label:k.name+"（"+k.desc+"）",value:k.type},null,8,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue","disabled"])])]))),128))]),_:1},8,["label"])):D("",!0)]),_:1})),[[W,B.value]])]),_:1},8,["modelValue","title"]),l(O,{modelValue:P.value,"onUpdate:modelValue":a[16]||(a[16]=e=>P.value=e),title:n(s)("同步模版状态"),width:"800px","destroy-on-close":""},{footer:t(()=>[p("span",We,[l(v,{onClick:a[14]||(a[14]=e=>P.value=!1)},{default:t(()=>[c(i(n(s)("cancel")),1)]),_:1}),l(v,{type:"primary",onClick:a[15]||(a[15]=e=>P.value=!1)},{default:t(()=>[c(i(n(s)("confirm")),1)]),_:1})])]),default:t(()=>[l(pe,{type:"warning",closable:!1,class:"!mb-[10px]"},{default:t(()=>[c(" 以下模版名称重复，请先调整模版名称后重新同步模版 ")]),_:1}),l(F,{"label-width":"100px",ref:"formRef",class:"page-form"},{default:t(()=>[Object.keys(w.value).length?(d(),h("div",He,[l(H,{data:n(te),border:"",style:{width:"100%"}},{default:t(()=>[l(V,{label:"模版名称",prop:"name"}),l(V,{label:"插件名称"},{default:t(({row:e})=>[(d(!0),h(R,null,U(e.platforms,m=>(d(),g(me,{key:m,class:"mr-1 mb-1"},{default:t(()=>[c(i(m),1)]),_:2},1024))),128))]),_:1})]),_:1},8,["data"])])):D("",!0)]),_:1},512)]),_:1},8,["modelValue","title"])])}}});export{gt as _};
