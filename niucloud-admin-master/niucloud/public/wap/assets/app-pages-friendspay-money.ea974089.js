import{d as e,K as a,al as t,r as l,av as r,a as s,i as n,j as o,o as i,c as p,w as u,x as d,b as c,y as f,z as x,e as _,t as m,ah as v,W as y,X as g,ab as b,Q as h,g as k,B as w,k as j,aw as F,G as T,J as S,M as I,as as C,at as P,T as B,U as R,n as O,L as z,E as A,F as E,A as L,P as M}from"./index-837da579.js";import{_ as U}from"./u-avatar.10036933.js";import{a as G,_ as H}from"./u--image.22e962dd.js";import{_ as J}from"./u-icon.963870f0.js";import{_ as V}from"./u-popup.80b537cf.js";import{p as $,g as D}from"./pay.e0795902.js";import{_ as K}from"./_plugin-vue_export-helper.1b428a4d.js";import{_ as N}from"./loading-page.vue_vue_type_script_setup_true_lang.765e9de6.js";import{t as Q}from"./topTabbar.ede9ed93.js";import{g as W,_ as X}from"./message.vue_vue_type_script_setup_true_lang.6f63058b.js";import"./u-transition.38ad69d8.js";import"./u-loading-icon.57b9bf82.js";const q=K(e({__name:"pay",props:{ignorePay:{type:Array,default:()=>[]},reformat:{type:String,default:""}},emits:["close","confirm"],setup(e,{expose:S,emit:I}){const C=e;a()&&t.init();const P=l(!1),B=l(!1),R=l(null),O=l(""),z=()=>{var e,l,r,n;if(!uni.$u.test.isEmpty(O.value))return"friendspay"==O.value?(s({url:"/app/pages/friendspay/share",param:{id:null==(e=R.value)?void 0:e.trade_id,type:null==(l=R.value)?void 0:l.trade_type},mode:"redirectTo"}),!1):void(B.value||(B.value=!0,$({trade_type:null==(r=R.value)?void 0:r.trade_type,trade_id:null==(n=R.value)?void 0:n.trade_id,type:O.value,openid:uni.getStorageSync("openid")||""}).then((e=>{var l,r,n,o,i,p;switch(O.value){case"wechatpay":a()?(e.data.timestamp=e.data.timeStamp,delete e.data.timeStamp,t.pay({...e.data,success:()=>{E()},cancel:()=>{B.value=!1}})):(uni.setStorageSync("paymenting",{trade_type:null==(l=R.value)?void 0:l.trade_type,trade_id:null==(r=R.value)?void 0:r.trade_id}),location.href=e.data.h5_url);break;case"alipay":a()?s({url:"/app/pages/pay/browser",param:{trade_type:null==(n=R.value)?void 0:n.trade_type,trade_id:null==(o=R.value)?void 0:o.trade_id,alipay:encodeURIComponent(e.data.url)},mode:"redirectTo"}):(uni.setStorageSync("paymenting",{trade_type:null==(i=R.value)?void 0:i.trade_type,trade_id:null==(p=R.value)?void 0:p.trade_id}),location.href=e.data.url);break;default:if(e.data.url)return void s({url:e.data.url,param:e.data.param||{},mode:"redirectTo"});E()}})).catch((()=>{B.value=!1}))));w({title:m("pay.notHavePayType"),icon:"none"})};r("checkIsReturnAfterPayment",(()=>{const e=uni.getStorageSync("paymenting");uni.getStorageSync("paymenting")&&s({url:"/app/pages/pay/result",param:{trade_type:e.trade_type,trade_id:e.trade_id},mode:"redirectTo",success(){uni.removeStorageSync("paymenting")}})}));const A=l(!1),E=()=>{var e,a;I("confirm"),C.reformat?s({url:C.reformat,mode:"redirectTo"}):s({url:"/app/pages/pay/result",param:{trade_type:null==(e=R.value)?void 0:e.trade_type,trade_id:null==(a=R.value)?void 0:a.trade_id},mode:"redirectTo"})},L=()=>{uni.removeStorageSync("paymenting"),P.value=!1,I("close")};return S({open:(e,a,t="",l="")=>{if(A.value)return;A.value=!0,uni.setStorageSync("payReturn",encodeURIComponent(t));const r={};l&&(r.scene=l),D(e,a,r).then((e=>{let{data:a}=e;uni.$u.test.isEmpty(a)?w({title:m("pay.notObtainedInfo"),icon:"none"}):0!=a.money?(R.value=a,C.ignorePay&&(a.pay_type_list=a.pay_type_list.filter((e=>!C.ignorePay.includes(e.key)))),O.value=a.pay_type_list[0]?a.pay_type_list[0].key:"",P.value=!0,A.value=!1):E()})).catch((()=>{A.value=!1}))},payInfo:R}),(e,a)=>{const t=j,l=n(o("u-image"),G),r=n(o("u-icon"),J),s=F,w=T,S=n(o("u-popup"),V);return i(),p(S,{show:P.value,round:10,onClose:L,closeable:!0,bgColor:"#fff",zIndex:"10081",closeOnClickOverlay:!1},{default:u((()=>[R.value?(i(),p(t,{key:0,class:"flex flex-col h-[65vh] popup-common",onTouchmove:a[0]||(a[0]=d((()=>{}),["prevent","stop"]))},{default:u((()=>[c(t,{class:"head"},{default:u((()=>[c(t,{class:"title"},{default:u((()=>[f(x(_(m)("pay.payTitle")),1)])),_:1}),c(t,{class:"flex items-end justify-center w-full text-xl font-bold py-[20rpx] price-font"},{default:u((()=>[c(t,{class:"text-base mr-[4rpx]"},{default:u((()=>[f(x(_(m)("currency")),1)])),_:1}),f(" "+x(_(v)(R.value.money)),1)])),_:1})])),_:1}),c(s,{"scroll-y":"true",class:"flex-1 pt-[20rpx]"},{default:u((()=>[c(t,{class:"flex text-[28rpx] px-[36rpx] py-[20rpx] mb-[10rpx]"},{default:u((()=>[c(t,{class:"text-[var(--text-color-light6)]"},{default:u((()=>[f(x(_(m)("pay.orderInfo")),1)])),_:1}),c(t,{class:"text-right flex-1 pl-[30rpx] truncate"},{default:u((()=>[f(x(R.value.body),1)])),_:1})])),_:1}),c(t,{class:"mx-[var(--popup-sidebar-m)] px-[30rpx] bg-white rounded-[20rpx] bg-[var(--temp-bg)]"},{default:u((()=>[R.value.pay_type_list.length?(i(!0),y(g,{key:0},b(R.value.pay_type_list,((e,a)=>(i(),p(t,{class:"pay-item py-[30rpx] flex items-center border-0 border-b border-solid border-[#eee]",key:a,onClick:a=>O.value=e.key},{default:u((()=>[c(l,{src:_(h)(e.icon),width:"50rpx",height:"50rpx"},null,8,["src"]),c(t,{class:"flex-1 px-[20rpx] text-[28rpx] font-500"},{default:u((()=>[f(x(e.name),1)])),_:2},1024),e.key==O.value?(i(),p(r,{key:0,name:"checkbox-mark",color:"var(--primary-color)"})):k("v-if",!0)])),_:2},1032,["onClick"])))),128)):(i(),p(t,{key:1,class:"py-[30rpx] text-center text-[24rpx] text-gray-subtitle"},{default:u((()=>[f(x(_(m)("pay.notHavePayType")),1)])),_:1}))])),_:1})])),_:1}),c(t,{class:"btn-wrap"},{default:u((()=>[c(w,{class:"primary-btn-bg btn","hover-class":"none",loading:B.value,onClick:z},{default:u((()=>[f(x(_(m)("pay.confirmPay")),1)])),_:1},8,["loading"])])),_:1})])),_:1})):k("v-if",!0)])),_:1},8,["show"])}}}),[["__scopeId","data-v-865d2559"]]),Y=K(e({__name:"money",setup(e){const a=Q();a.setTopTabbarParam({title:""});const t=l(!0),r=l(0),d=l(""),v=l({}),w=l(!1),F=l(!0),G=l(null);S((e=>{r.value=e.id||0,d.value=e.type||""})),I((()=>{r.value&&d.value&&J(d.value,r.value)})),C((()=>{G.value&&(clearTimeout(G.value),G.value=null)})),P((()=>{G.value&&(clearTimeout(G.value),G.value=null)}));const J=(e,l)=>{F.value&&(t.value=!0,F.value=!1),W(e,l).then((r=>{v.value=r.data,B({title:v.value.config.pay_page_name}),a.setTopTabbarParam({title:v.value.config.pay_page_name}),t.value=!1,2!=v.value.status&&1!=v.value.status&&-1!=v.value.status?G.value=setTimeout((()=>{J(e,l)}),3e3):(clearTimeout(G.value),G.value=null)})).catch((()=>{G.value&&(clearTimeout(G.value),G.value=null),t.value=!1;R({title:"未找到帮付订单信息",url:"/app/pages/index/index",mode:"reLaunch"})}))},V=l(null),$=()=>{V.value.open(v.value.config)},D=l(),K=()=>{var e;z()?null==(e=D.value)||e.open(v.value.trade_type,v.value.trade_id,"/app/pages/index/index","friendspay"):A().setLoginBack({url:"/app/pages/friendspay/money",param:{id:v.value.trade_id,type:v.value.trade_type}})};return(e,a)=>{const l=n(o("u-avatar"),U),r=E,d=j,F=T,S=M,I=n(o("u--image"),H),C=n(o("pay"),q),P=n(o("loading-page"),N);return i(),p(d,{style:O(e.themeColor())},{default:u((()=>[Object.keys(v.value).length&&!t.value?(i(),p(d,{key:0,class:"bg-[var(--page-bg-color)] min-h-screen overflow-hidden"},{default:u((()=>[c(d,{style:O({background:"url("+_(h)("static/resource/images/app/friendpay_money.png")+") left bottom / cover no-repeat"}),class:"pb-[194rpx] overflow-hidden"},{default:u((()=>[c(d,{class:"mt-[20rpx] flex flex-col items-center"},{default:u((()=>[c(l,{src:_(h)(v.value.member.headimg),size:"50",leftIcon:"none","default-url":_(h)("static/resource/images/default_headimg.png")},null,8,["src","default-url"]),c(d,{class:"flex items-center mt-[20rpx] text-[#fff] text-[26rpx] leading-[36rpx]"},{default:u((()=>[c(r,{class:"font-bold mr-[10rpx] max-w-[250rpx] truncate"},{default:u((()=>[f(x(v.value.member.nickname),1)])),_:1}),c(r,null,{default:u((()=>[f("请您帮忙付款~")])),_:1})])),_:1}),v.value.config.pay_leave_message?(i(),p(d,{key:0,class:"message bg-[#fe0708] relative max-w-[520rpx] px-[20rpx] py-[12rpx] rounded-[12rpx] border-solid border-[1rpx] border-color text-[24rpx] text-[#fff] leading-[30rpx] box-border text-center mt-[20rpx] mx-[114rpx]"},{default:u((()=>[f(x(v.value.config.pay_leave_message),1)])),_:1})):k("v-if",!0)])),_:1})])),_:1},8,["style"]),c(d,{class:"-mt-[154rpx] card-template sidebar-margin mb-[var(--top-m)]"},{default:u((()=>[c(d,{class:"text-[24rpx] text-center mb-[10rpx]"},{default:u((()=>[f(x(_(m)("payMoney")),1)])),_:1}),c(d,{class:"text-center mb-[50rpx]"},{default:u((()=>[c(r,{class:"text-[32rpx] font-500 price-font text-[#FF4142]"},{default:u((()=>[f("￥")])),_:1}),c(r,{class:"text-[56rpx] font-bold price-font text-[#FF4142]"},{default:u((()=>[f(x(parseFloat(v.value.money).toFixed(2).split(".")[0]),1)])),_:1}),c(r,{class:"text-[32rpx] font-500 price-font text-[#FF4142]"},{default:u((()=>[f("."+x(parseFloat(v.value.money).toFixed(2).split(".")[1]),1)])),_:1})])),_:1}),c(d,{class:"px-[20rpx] box-border"},{default:u((()=>[2==v.value.status?(i(),p(F,{key:0,class:"bg-[#FFB4B1] !text-[#fff] h-[80rpx] leading-[80rpx] rounded-[100rpx] text-[26rpx] font-500","hover-class":"none"},{default:u((()=>[f(x(_(m)("finish")),1)])),_:1})):-1==v.value.status?(i(),p(F,{key:1,class:"bg-[#FFB4B1] !text-[#fff] h-[80rpx] leading-[80rpx] rounded-[100rpx] text-[26rpx] font-500","hover-class":"none"},{default:u((()=>[f(x(_(m)("close")),1)])),_:1})):(i(),p(F,{key:2,class:"botton-color !text-[#fff] h-[80rpx] leading-[80rpx] rounded-[100rpx] text-[26rpx] font-500","hover-class":"none",loading:w.value,onClick:K},{default:u((()=>[f(x(v.value.config.pay_button_name?v.value.config.pay_button_name:_(m)("payGenerously")),1)])),_:1},8,["loading"]))])),_:1}),c(d,{class:"px-[10px] flex justify-between items-center text-[var(--text-color-light9)] mt-[20rpx]"},{default:u((()=>[c(d,{class:"flex items-baseline justify-between text-[var(--text-color-light9)]",onClick:a[0]||(a[0]=e=>_(s)({url:"/app/pages/index/index"}))},{default:u((()=>[c(r,{class:"text-[24rpx] mr-[6rpx]"},{default:u((()=>[f("返回首页")])),_:1})])),_:1}),v.value.config.pay_explain_switch?(i(),p(d,{key:0,class:"flex-shrink-0",onClick:$},{default:u((()=>[c(r,{class:"mr-[8rpx] text-[24rpx]"},{default:u((()=>[f(x(v.value.config.pay_explain_title),1)])),_:1}),c(r,{class:"nc-iconfont nc-icon-jichuxinxiV6xx text-[26rpx]"})])),_:1})):k("v-if",!0)])),_:1})])),_:1}),v.value.config.pay_info_switch?(i(),p(d,{key:0,class:"card-template sidebar-margin mb-[var(--top-m)]"},{default:u((()=>["[]"!==JSON.stringify(v.value.trade_info)&&v.value.trade_info.item_list.length?(i(),y(g,{key:0},[c(d,{class:"flex justify-between items-center mb-[30rpx]"},{default:u((()=>[c(d,{class:"text-[30rpx] text-[#333] font-500"},{default:u((()=>[f(x(_(m)("helpPayInfo")),1)])),_:1}),k(' <view class="flex-shrink-0" @click="handleMessage" v-if="friendsInfo.config.pay_explain_switch">\r\n                            <text class="mr-[8rpx] text-[24rpx]">{{ friendsInfo.config.pay_explain_title }}</text>\r\n                            <text class="nc-iconfont nc-icon-jichuxinxiV6xx text-[26rpx]"></text>\r\n                        </view> ')])),_:1}),c(d,{class:"border-0 border-solid border-b-[1rpx] border-[#f6f6f6] mb-[20rpx]"},{default:u((()=>[(i(!0),y(g,null,b(v.value.trade_info.item_list,((e,a)=>(i(),p(d,{class:L(["flex justify-between",{" mb-[34rpx]":a+1!=v.value.trade_info.length}])},{default:u((()=>[c(d,{class:"w-[170rpx] h-[170rpx] rounded-[var(--goods-rounded-big)] overflow-hidden flex-shrink-0"},{default:u((()=>[c(I,{class:"overflow-hidden",radius:"var(--goods-rounded-big)",width:"170rpx",height:"170rpx",src:_(h)(e.item_image?e.item_image:""),model:"aspectFill"},{error:u((()=>[c(S,{class:"w-[170rpx] h-[170rpx] rounded-[var(--goods-rounded-big)] overflow-hidden",src:_(h)("static/resource/images/diy/shop_default.jpg"),mode:"aspectFill"},null,8,["src"])])),_:2},1032,["src"])])),_:2},1024),c(d,{class:"ml-[20rpx] flex flex-1 flex-col justify-between"},{default:u((()=>[c(d,null,{default:u((()=>[c(d,{class:"text-[28rpx] using-hidden leading-[40rpx] text-[#333]"},{default:u((()=>[f(x(e.item_name),1)])),_:2},1024),e.item_sub_name?(i(),p(d,{key:0,class:"text-[24rpx] mt-[14rpx] text-[var(--text-color-light9)] using-hidden leading-[28rpx]"},{default:u((()=>[f(x(e.item_sub_name),1)])),_:2},1024)):k("v-if",!0)])),_:2},1024),c(d,{class:"flex justify-between items-baseline"},{default:u((()=>[c(d,{class:"price-font text-[#FF4142]"},{default:u((()=>[c(r,{class:"text-[24rpx]"},{default:u((()=>[f("￥")])),_:1}),c(r,{class:"text-[40rpx] font-500"},{default:u((()=>[f(x(parseFloat(e.item_price).toFixed(2).split(".")[0]),1)])),_:2},1024),c(r,{class:"text-[24rpx] font-500"},{default:u((()=>[f("."+x(parseFloat(e.item_price).toFixed(2).split(".")[1]),1)])),_:2},1024)])),_:2},1024),c(r,{class:"text-right text-[26rpx]"},{default:u((()=>[f("x"+x(e.item_num),1)])),_:2},1024)])),_:2},1024)])),_:2},1024)])),_:2},1032,["class"])))),256))])),_:1}),c(d,{class:"text-[26rpx] text-right"},{default:u((()=>[f(x(v.value.trade_info.item_total),1)])),_:1})],64)):(i(),p(d,{key:1,class:"text-[28rpx] leading-[40rpx] text-[#333]"},{default:u((()=>[f(x(v.value.body),1)])),_:1}))])),_:1})):k("v-if",!0)])),_:1})):k("v-if",!0),k(" 帮付说明 "),c(X,{ref_key:"messageRef",ref:V},null,512),k(" 支付 "),c(C,{ref_key:"payRef",ref:D},null,512),c(P,{loading:t.value},null,8,["loading"])])),_:1},8,["style"])}}}),[["__scopeId","data-v-7db1de48"]]);export{Y as default};
