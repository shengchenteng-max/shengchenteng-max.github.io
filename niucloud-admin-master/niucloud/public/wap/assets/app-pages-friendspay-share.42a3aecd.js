import{d as e,r as a,H as t,o as l,W as s,g as r,b as o,w as u,x as i,n,c as p,e as d,y as c,X as f,ao as m,ar as _,Q as v,P as x,k as g,F as y,G as h,i as b,j as w,u as k,l as F,m as j,J as P,M as T,as as O,at as S,T as U,au as C,U as I,z as $,ab as B,t as D,a as z}from"./index-837da579.js";import{_ as J}from"./u-avatar.10036933.js";import{_ as N}from"./u--image.22e962dd.js";import{_ as M}from"./loading-page.vue_vue_type_script_setup_true_lang.765e9de6.js";import{g as R,_ as V}from"./message.vue_vue_type_script_setup_true_lang.6f63058b.js";import{t as G}from"./topTabbar.ede9ed93.js";import{_ as H}from"./u-popup.80b537cf.js";import{_ as L}from"./_plugin-vue_export-helper.1b428a4d.js";import"./u-icon.963870f0.js";import"./u-transition.38ad69d8.js";import"./u-loading-icon.57b9bf82.js";const Q=L(e({__name:"share-poster",props:{posterId:{type:[String,Number],default:0},posterType:{type:String,default:""},posterParam:{type:Object,default:{}},copyUrl:{type:String,default:""},copyUrlParam:{type:String,default:""},isPreload:{type:Boolean,default:!0}},emits:["close"],setup(e,{expose:k,emit:F}){const j=e,P=a(!1),T=()=>{let e="";if(j.copyUrl){let a=location.pathname,t=["/app/","/addon/"];for(let e=0;e<t.length;e++)-1!=a.indexOf(t[e])&&(a=a.substr(0,a.indexOf(t[e])));e=location.origin+a+j.copyUrl+j.copyUrlParam}else e=location.origin+location.pathname+j.copyUrlParam;m(e,(()=>{P.value=!1}))},O=a(!1),S=a(!1),U=a(""),C=()=>{if(U.value&&j.isPreload)O.value=!1,S.value=!0;else{O.value=!0,S.value=!1;let e={id:j.posterId,type:j.posterType,param:j.posterParam},a=Date.parse(new Date);_(e).then((e=>{U.value=e.data&&v(e.data)||"";let t=Date.parse(new Date)-a;t<2200?setTimeout((()=>{O.value=!1,S.value=!0}),2200-t):(O.value=!1,S.value=!0)})).catch((()=>{D()}))}},I=a(!1),$=()=>{I.value=!1},B=a(0);t();const D=()=>{P.value=!1,O.value=!1,S.value=!1,F("close")};return k({openShare:()=>{P.value=!0,C()},loadPoster:C}),(e,a)=>{const t=x,m=g,_=y,k=h,F=b(w("u-popup"),H);return l(),s(f,null,[r(" 分享弹窗 "),o(m,{onTouchmove:a[2]||(a[2]=i((()=>{}),["prevent","stop"])),class:"share-popup"},{default:u((()=>[o(F,{show:P.value,onClose:D,overlayOpacity:"0.8"},{default:u((()=>[o(m,{onTouchmove:a[0]||(a[0]=i((()=>{}),["prevent","stop"]))},{default:u((()=>[o(m,{class:"poster-img-wrap",style:n({top:B.value})},{default:u((()=>[O.value?(l(),p(t,{key:0,class:"poster-animation",src:d(v)("addon/shop/poster_animation.gif"),mode:"aspectFit"},null,8,["src"])):r("v-if",!0),S.value?(l(),p(t,{key:1,class:"poster-img",src:d(v)(U.value),mode:"aspectFit","show-menu-by-longpress":!0},null,8,["src"])):r("v-if",!0)])),_:1},8,["style"]),o(m,{class:"share-content"},{default:u((()=>[o(m,{class:"share-box",onClick:T},{default:u((()=>[o(k,{class:"share-btn",plain:!0},{default:u((()=>[o(m,{class:"text-[#07c160] iconfont iconfuzhilianjie"}),o(_,null,{default:u((()=>[c("复制链接")])),_:1})])),_:1})])),_:1})])),_:1}),o(m,{class:"share-footer",onClick:D},{default:u((()=>[o(_,null,{default:u((()=>[c("取消分享")])),_:1})])),_:1})])),_:1})])),_:1},8,["show"]),o(F,{show:I.value,mode:"center",round:10,closeable:!0,onClose:a[1]||(a[1]=e=>I.value=!1),"safe-area-inset-bottom":!1},{default:u((()=>[o(m,{class:"dialog-popup"},{default:u((()=>[o(m,{class:"title"},{default:u((()=>[c("提示")])),_:1}),o(m,{class:"message"},{default:u((()=>[c("您拒绝了保存图片到相册的授权请求，无法保存图片到相册，如需正常使用，请授权之后再进行操作。")])),_:1}),o(m,{class:"action-wrap"},{default:u((()=>[o(m,{onClick:$},{default:u((()=>[c("取消")])),_:1}),o(m,null,{default:u((()=>[o(k,{type:"default",class:"authorization-btn","open-type":"openSetting",onOpensetting:$,"hover-class":"none"},{default:u((()=>[c("立即授权")])),_:1})])),_:1})])),_:1})])),_:1})])),_:1},8,["show"])])),_:1})],2112)}}}),[["__scopeId","data-v-cbccbfe1"]]),W=L(e({__name:"share",setup(e){const t=G();t.setTopTabbarParam({title:""});const i=a(!0),m=a(!1),_=a(0),H=a(""),L=a({}),W=a(!0),X=a(null),{setShare:q}=k(),A=F(),E=j((()=>A.info));P((e=>{_.value=e.id||0,H.value=e.type||""})),T((()=>{_.value&&H.value&&K(H.value,_.value)})),O((()=>{X.value&&(clearTimeout(X.value),X.value=null)})),S((()=>{X.value&&(clearTimeout(X.value),X.value=null)}));const K=(e,a)=>{W.value&&(i.value=!0,W.value=!1),R(e,a).then((l=>{L.value=l.data,i.value=!1,U({title:L.value.config.pay_page_name}),t.setTopTabbarParam({title:L.value.config.pay_page_name});let s="",r=location.pathname,o=["/app/","/addon/"];for(let e=0;e<o.length;e++)-1!=r.indexOf(o[e])&&(r=r.substr(0,r.indexOf(o[e])));s=location.origin+r+`/app/pages/friendspay/money?id=${L.value.trade_id}&type=${L.value.trade_type}`;let u={desc:L.value.config.pay_leave_message,path:`/app/pages/friendspay/money?id=${L.value.trade_id}&type=${L.value.trade_type}`,link:s};if(L.value.member){let e=L.value.member.nickname;e=e.length>15?e=e.substring(0,15)+"...":e,u.title=`${e}希望你帮他付${L.value.money}元`}"[]"!==JSON.stringify(L.value.trade_info)&&L.value.trade_info.item_list.length?u.url=L.value.trade_info.item_list[0].item_image?L.value.trade_info.item_list[0].item_image:L.value.config.pay_wechat_share_image:u.url=L.value.config.pay_wechat_share_image,q({wechat:{...u},weapp:{...u}}),se(),C((()=>{setTimeout((()=>{ee.value&&(le.id=L.value.trade_id,le.type=L.value.trade_type,E.value&&E.value.member_id&&(le.member_id=E.value.member_id),ee.value.loadPoster())}),400)})),2!=L.value.status&&1!=L.value.status&&-1!=L.value.status?X.value=setTimeout((()=>{K(e,a)}),3e3):(clearTimeout(X.value),X.value=null)})).catch((e=>{X.value&&(clearTimeout(X.value),X.value=null),i.value=!1;I({title:"未找到帮付订单信息",url:"/app/pages/index/index",mode:"reLaunch"})}))},Y=a(null),Z=()=>{Y.value.open(L.value.config)},ee=a(null),ae=a("/app/pages/friendspay/money"),te=a("");let le={};const se=()=>{te.value="?id="+L.value.trade_id,te.value+="&type="+L.value.trade_type},re=()=>{le.id=L.value.trade_id,le.type=L.value.trade_type,E.value&&E.value.member_id&&(le.member_id=E.value.member_id),ee.value.openShare()};return(e,a)=>{const t=b(w("u-avatar"),J),_=y,k=g,F=h,j=x,P=b(w("u--image"),N),T=b(w("loading-page"),M);return l(),p(k,{style:n(e.themeColor())},{default:u((()=>[Object.keys(L.value).length&&!i.value?(l(),p(k,{key:0,class:"bg-[var(--page-bg-color)] min-h-screen overflow-hidden"},{default:u((()=>[o(k,{style:n({background:"url("+d(v)("static/resource/images/app/friendpay_bg.png")+") left bottom /100% no-repeat"}),class:"pb-[168rpx] overflow-hidden"},{default:u((()=>[o(k,{class:"mt-[20rpx] flex flex-col items-center"},{default:u((()=>[o(t,{src:d(v)(L.value.member.headimg),size:"50",leftIcon:"none","default-url":d(v)("static/resource/images/default_headimg.png")},null,8,["src","default-url"]),o(k,{class:"flex items-center mt-[20rpx] text-[#fff] text-[26rpx] leading-[36rpx]"},{default:u((()=>[o(_,{class:"font-bold mr-[10rpx] max-w-[250rpx] truncate"},{default:u((()=>[c($(L.value.member.nickname),1)])),_:1}),o(_,null,{default:u((()=>[c("发起了订单帮付请求~")])),_:1})])),_:1})])),_:1})])),_:1},8,["style"]),o(k,{class:"mt-[-128rpx] card-template sidebar-margin mb-[var(--top-m)]"},{default:u((()=>[o(k,{class:"text-[24rpx] text-center text-[#333] mb-[10rpx]"},{default:u((()=>[c($(d(D)("payMoney")),1)])),_:1}),o(k,{class:"text-center mb-[50rpx]"},{default:u((()=>[o(_,{class:"text-[32rpx] font-500 price-font text-[#FF4142]"},{default:u((()=>[c("￥")])),_:1}),o(_,{class:"text-[56rpx] font-bold price-font text-[#FF4142]"},{default:u((()=>[c($(parseFloat(L.value.money).toFixed(2).split(".")[0]),1)])),_:1}),o(_,{class:"text-[32rpx] font-500 price-font text-[#FF4142]"},{default:u((()=>[c("."+$(parseFloat(L.value.money).toFixed(2).split(".")[1]),1)])),_:1})])),_:1}),o(k,{class:"px-[20rpx] box-border"},{default:u((()=>[2==L.value.status?(l(),p(F,{key:0,class:"bg-[#FFB4B1] !text-[#fff] h-[80rpx] leading-[80rpx] rounded-[100rpx] text-[26rpx] font-500","hover-class":"none"},{default:u((()=>[c($(d(D)("finish")),1)])),_:1})):-1==L.value.status?(l(),p(F,{key:1,class:"bg-[#FFB4B1] !text-[#fff] h-[80rpx] leading-[80rpx] rounded-[100rpx] text-[26rpx] font-500","hover-class":"none"},{default:u((()=>[c($(d(D)("close")),1)])),_:1})):(l(),p(F,{key:2,class:"button-color !text-[#fff] h-[80rpx] leading-[80rpx] rounded-[100rpx] text-[26rpx] font-500","hover-class":"none",loading:m.value,onClick:re},{default:u((()=>[c($(L.value.config.pay_type_name?L.value.config.pay_type_name:d(D)("friendPay")),1)])),_:1},8,["loading"]))])),_:1}),2==L.value.status&&"[]"!==JSON.stringify(L.value.trade_info)&&L.value.trade_info.detail_url?(l(),p(k,{key:0,class:"mt-[20rpx] flex items-baseline justify-center text-[var(--text-color-light9)]",onClick:a[0]||(a[0]=e=>d(z)({url:L.value.trade_info.detail_url}))},{default:u((()=>[o(_,{class:"text-[24rpx] mr-[6rpx]"},{default:u((()=>[c("查看订单")])),_:1}),o(_,{class:"nc-iconfont nc-icon-youV6xx text-[26rpx]"})])),_:1})):r("v-if",!0)])),_:1}),o(k,{class:"card-template sidebar-margin mb-[var(--top-m)]"},{default:u((()=>[o(k,{class:"flex justify-between items-center mb-[30rpx]"},{default:u((()=>[o(k,{class:"text-[30rpx] text-[#333] font-500"},{default:u((()=>[c($(d(D)("friendPayOrderInfo")),1)])),_:1}),L.value.config.pay_explain_switch?(l(),p(k,{key:0,class:"text-[#666] leading-[1]",onClick:Z},{default:u((()=>[o(_,{class:"mr-[8rpx] text-[24rpx]"},{default:u((()=>[c($(L.value.config.pay_explain_title),1)])),_:1}),o(_,{class:"nc-iconfont nc-icon-jichuxinxiV6xx text-[26rpx]"})])),_:1})):r("v-if",!0)])),_:1}),"[]"!==JSON.stringify(L.value.trade_info)?(l(),s(f,{key:0},[L.value.trade_info.item_list.length?(l(),s(f,{key:0},[o(k,{class:"border-0 border-solid border-b-[1rpx] border-[#f6f6f6] mb-[20rpx]"},{default:u((()=>[(l(!0),s(f,null,B(L.value.trade_info.item_list,((e,a)=>(l(),p(k,{class:"flex justify-between mb-[30rpx]"},{default:u((()=>[o(k,{class:"w-[170rpx] h-[170rpx] rounded-[var(--goods-rounded-big)] overflow-hidden flex-shrink-0"},{default:u((()=>[o(P,{class:"overflow-hidden",radius:"var(--goods-rounded-big)",width:"170rpx",height:"170rpx",src:d(v)(e.item_image?e.item_image:""),model:"aspectFill"},{error:u((()=>[o(j,{class:"w-[170rpx] h-[170rpx] rounded-[var(--goods-rounded-big)] overflow-hidden",src:d(v)("static/resource/images/diy/shop_default.jpg"),mode:"aspectFill"},null,8,["src"])])),_:2},1032,["src"])])),_:2},1024),o(k,{class:"ml-[20rpx] flex flex-1 flex-col justify-between"},{default:u((()=>[o(k,null,{default:u((()=>[o(k,{class:"text-[28rpx] using-hidden leading-[40rpx] text-[#333]"},{default:u((()=>[c($(e.item_name),1)])),_:2},1024),e.item_sub_name?(l(),p(k,{key:0,class:"text-[24rpx] mt-[14rpx] text-[var(--text-color-light9)] using-hidden leading-[28rpx]"},{default:u((()=>[c($(e.item_sub_name),1)])),_:2},1024)):r("v-if",!0)])),_:2},1024),o(k,{class:"flex justify-between items-baseline"},{default:u((()=>[o(k,{class:"price-font text-[#FF4142]"},{default:u((()=>[o(_,{class:"text-[24rpx]"},{default:u((()=>[c("￥")])),_:1}),o(_,{class:"text-[40rpx] font-500"},{default:u((()=>[c($(parseFloat(e.item_price).toFixed(2).split(".")[0]),1)])),_:2},1024),o(_,{class:"text-[24rpx] font-500"},{default:u((()=>[c("."+$(parseFloat(e.item_price).toFixed(2).split(".")[1]),1)])),_:2},1024)])),_:2},1024),o(_,{class:"text-right text-[26rpx]"},{default:u((()=>[c("x"+$(e.item_num),1)])),_:2},1024)])),_:2},1024)])),_:2},1024)])),_:2},1024)))),256))])),_:1}),o(k,{class:"text-[26rpx] text-right"},{default:u((()=>[c($(L.value.trade_info.item_total),1)])),_:1})],64)):r("v-if",!0)],64)):(l(),p(k,{key:1,class:"text-[28rpx] leading-[40rpx] text-[#333]"},{default:u((()=>[c($(L.value.body),1)])),_:1}))])),_:1}),o(Q,{ref_key:"sharePosterRef",ref:ee,posterType:"friendspay",posterId:L.value.poster_id,posterParam:d(le),copyUrl:ae.value,copyUrlParam:te.value},null,8,["posterId","posterParam","copyUrl","copyUrlParam"]),r(" 帮付说明 "),o(V,{ref_key:"messageRef",ref:Y},null,512)])),_:1})):r("v-if",!0),o(T,{loading:i.value},null,8,["loading"])])),_:1},8,["style"])}}}),[["__scopeId","data-v-cd326478"]]);export{W as default};
