import{d as e,r as t,J as a,M as l,L as s,B as r,Z as c,_ as i,a as u,o as n,c as x,w as p,W as o,b as d,e as f,y as m,X as v,ab as _,z as g,A as h,g as y,n as b,F as j,k as w,P as k,i as T,j as C,Q as F}from"./index-837da579.js";import{_ as z}from"./loading-page.vue_vue_type_script_setup_true_lang.765e9de6.js";import{g as I,a as L,v as A}from"./verify.7ebf087c.js";import{_ as B}from"./_plugin-vue_export-helper.1b428a4d.js";import"./u-loading-icon.57b9bf82.js";import"./u-transition.38ad69d8.js";const E=B(e({__name:"verify",setup(e){const B=t(!0),E=t("");a((e=>{if(e.code&&(E.value=e.code),e.scene){let t=decodeURIComponent(e.scene).split("&");t.length&&t.forEach((e=>{-1!=e.indexOf("code")&&(E.value=e.split("-")[1])}))}})),l((()=>{s()&&(J(),O())}));const J=()=>{I().then((e=>{e.data?B.value=!1:(r({title:"非核销员无此权限",icon:"none"}),setTimeout((()=>{c().length>1?i({delta:1}):u({url:"/app/pages/member/index",mode:"reLaunch"})}),1e3))}))},M=t({}),O=()=>{B.value=!0,L({code:E.value}).then((e=>{M.value=e.data,B.value=!1})).catch((()=>{setTimeout((()=>{B.value=!1,u({url:"/app/pages/verify/index",param:{},mode:"redirectTo"})}),1e3)}))};let P=!1;const Q=()=>{if(M.value.is_can_use){if(P)return!1;P=!0,A(E.value).then((e=>{r({title:"核销成功",icon:"none"}),setTimeout((()=>{P=!1,u({url:"/app/pages/verify/index",param:{},mode:"redirectTo"})}),1e3)})).catch((()=>{P=!1}))}};return(e,t)=>{const a=j,l=w,s=k,r=T(C("loading-page"),z);return n(),x(l,{style:b(e.themeColor()),class:"bg-[var(--page-bg-color)] min-h-[100vh] overflow-hidden"},{default:p((()=>[!B.value&&M.value&&M.value.value?(n(),o(v,{key:0},[d(l,{class:"p-[30rpx] bg-[#fff]"},{default:p((()=>[d(l,{class:"text-[var(--primary-color)] fixed top-[40rpx] right-[30rpx] flex items-center",onClick:t[0]||(t[0]=e=>f(u)({url:"/app/pages/verify/record"}))},{default:p((()=>[d(a,{class:"nc-iconfont nc-icon-lishijiluV6xx !text-[28rpx] -mb-[2rpx]"}),d(a,{class:"text-[26rpx] ml-[8rpx]"},{default:p((()=>[m("核销记录")])),_:1})])),_:1}),d(l,{class:"flex items-center mt-[60rpx] justify-center"},{default:p((()=>[d(l,{class:"flex justify-center items-center flex-col pr-[30rpx]"},{default:p((()=>[d(s,{class:"w-[100rpx] h-[100rpx]",src:f(F)("static/resource/images/verify/yanzhenghexiaoma.png")},null,8,["src"]),d(l,{class:"text-[26rpx] mt-[14rpx] h-[36rpx] leading-[36rpx] flex-shrink-0"},{default:p((()=>[m("验证核销码")])),_:1})])),_:1}),d(s,{class:"w-[74rpx] h-[12rpx] mb-[50rpx]",src:f(F)("static/resource/images/verify/youjiantou.png")},null,8,["src"]),d(l,{class:"flex justify-center items-center flex-col pl-[30rpx]"},{default:p((()=>[d(s,{class:"w-[100rpx] h-[100rpx]",src:f(F)("static/resource/images/verify/hexiao.png")},null,8,["src"]),d(l,{class:"text-[26rpx] mt-[14rpx] h-[36rpx] leading-[36rpx] flex-shrink-0"},{default:p((()=>[m("确定核销")])),_:1})])),_:1})])),_:1})])),_:1}),d(l,{class:"card-template mt-[var(--top-m)] sidebar-margin"},{default:p((()=>[(n(!0),o(v,null,_(M.value.value.list,((e,t)=>(n(),x(l,{class:h(["flex",{"mb-[var(--top-m)]":M.value.value.list.length-1!=t}]),key:t},{default:p((()=>[e.cover?(n(),x(s,{key:0,class:"w-[150rpx] h-[150rpx] rounded-[var(--goods-rounded-big)]",mode:"aspectFill",src:f(F)(e.cover)},null,8,["src"])):(n(),x(s,{key:1,class:"w-[150rpx] h-[150rpx] rounded-[var(--goods-rounded-big)]",mode:"aspectFill",src:f(F)("addon/tourism/tourism/member/hotel.png")},null,8,["src"])),d(l,{class:"flex flex-col flex-1 ml-[20rpx] py-[4rpx]"},{default:p((()=>[d(l,{class:"leading-[1]"},{default:p((()=>[d(l,{class:"leading-[40rpx] truncate max-w-[490rpx] text-[28rpx]"},{default:p((()=>[m(g(e.name),1)])),_:2},1024),e.sub_name?(n(),x(l,{key:0,class:"mt-[14rpx] truncate text-[24rpx] text-[var(--text-color-light9)] leading-[28rpx] max-w-[490rpx]"},{default:p((()=>[m(g(e.sub_name),1)])),_:2},1024)):y("v-if",!0)])),_:2},1024),d(l,{class:"flex items-center mt-[20rpx]"},{default:p((()=>[d(l,{class:"text-[var(--text-color-light6)] text-[28rpx]"},{default:p((()=>[m("x"+g(e.verify_num),1)])),_:2},1024),d(l,{class:"leading-[1] ml-3 text-[var(--price-text-color)] text-[28rpx]"},{default:p((()=>[m(g(e.un_use_msg),1)])),_:2},1024)])),_:2},1024)])),_:2},1024)])),_:2},1032,["class"])))),128))])),_:1}),d(l,{class:"card-template mt-[var(--top-m)] sidebar-margin"},{default:p((()=>[d(l,{class:"title"},{default:p((()=>[m("核销信息")])),_:1}),d(l,{class:"card-template-item justify-between"},{default:p((()=>[d(a,{class:"text-[28rpx] text-[#333]"},{default:p((()=>[m("核销类型")])),_:1}),d(l,{class:"text-[28rpx] text-[#333]"},{default:p((()=>[m(g(M.value.type_name),1)])),_:1})])),_:1}),(n(!0),o(v,null,_(M.value.value.content.fixed,((e,t)=>(n(),x(l,{class:"card-template-item justify-between"},{default:p((()=>[d(a,{class:"text-[28rpx] text-[#333]"},{default:p((()=>[m(g(e.title),1)])),_:2},1024),d(l,{class:"text-[28rpx] text-[#333]"},{default:p((()=>[m(g(e.value),1)])),_:2},1024)])),_:2},1024)))),256))])),_:1}),(n(!0),o(v,null,_(M.value.value.content.diy,((e,t)=>(n(),x(l,{key:t,class:"card-template mt-[var(--top-m)] sidebar-margin"},{default:p((()=>[d(l,{class:"title"},{default:p((()=>[m(g(e.title),1)])),_:2},1024),(n(!0),o(v,null,_(e.list,((e,t)=>(n(),x(l,{class:"card-template-item justify-between",key:t},{default:p((()=>[d(a,{class:"text-[28rpx] text-[#333]"},{default:p((()=>[m(g(e.title),1)])),_:2},1024),d(a,{class:"text-[28rpx] text-[#333]"},{default:p((()=>[m(g(e.value),1)])),_:2},1024)])),_:2},1024)))),128))])),_:2},1024)))),128)),d(l,{class:"common-tab-bar w-[100%]"}),d(l,{class:h(["verify-tab-bar fixed flex-center !text-[26rpx] rounded-[50rpx] h-[80rpx] left-[20rpx] right-[20rpx] text-[#fff] font-500",M.value.is_can_use?"primary-btn-bg":"bg-[#ccc]"]),onClick:Q},{default:p((()=>[m("确定")])),_:1},8,["class"])],64)):y("v-if",!0),d(r,{loading:B.value},null,8,["loading"])])),_:1},8,["style"])}}}),[["__scopeId","data-v-125cf12c"]]);export{E as default};
