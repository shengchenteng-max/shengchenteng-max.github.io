import{r as e,aY as a,q as o,m as l,Q as t,J as r,M as g,Z as n,ae as i,T as d,as as u,at as p,an as s}from"./index-837da579.js";import{c as m}from"./diy_form.d0b09502.js";function c(c={}){const v=e(!0),S=a(),b=e(c.form_id||0);e(c.name||""),e("");const y=e(""),f=o({});e(c.needLogin||!1);const h=o({pageMode:"diy",title:"",global:{},value:[],status:0}),B=l((()=>"decorate"==S.mode?S:h)),_=e(!1),x=(e=null)=>{let a=n();y.value=a[a.length-1]?a[a.length-1].route:"";let o=[];if(uni.getStorageSync("diyPageBlank")&&(o=uni.getStorageSync("diyPageBlank")),!o.length||o.length&&-1==o.indexOf(y.value)?S.topFixedStatus="home":o.length&&-1!=o.indexOf(y.value)&&(S.topFixedStatus="diy"),"decorate"==S.mode)S.init();else{if(!b.value)return;m({form_id:b.value}).then((a=>{if(Object.assign(f,a.data),h.status=a.data.status,f.value){h.pageMode=f.mode,h.title=f.title,h.type=f.type,S.id=f.form_id;let e=f.value,a=uni.getStorageSync("diyFormStorage_"+S.id);if(a){const o=new Date;let l=parseInt(o.getTime()/1e3);a.validTime>l?a.components&&a.components.forEach((a=>{for(let o=0;o<e.value.length;o++)if("diy_form"==e.value[o].componentType&&a.id==e.value[o].id){let l=i(a),t=i(l.field);delete l.field,delete t.required,delete t.unique,delete t.autofill,delete t.privacyProtection,Object.assign(e.value[o],l),Object.assign(e.value[o].field,t);break}})):uni.removeStorageSync("diyFormStorage_"+S.id)}S.value=e.value,h.global=e.global,h.value=e.value,h.value.forEach(((e,a)=>{e.componentIsShow=!0,e.isHidden?h.value.splice(a,1):(e.pageStyle="",("FormSubmit"!=e.componentName||"FormSubmit"==e.componentName&&"hover_screen_bottom"!=e.btnPosition)&&(e.pageStartBgColor&&(e.pageStartBgColor&&e.pageEndBgColor?e.pageStyle+=`background:linear-gradient(${e.pageGradientAngle},${e.pageStartBgColor},${e.pageEndBgColor});`:e.pageStyle+="background-color:"+e.pageStartBgColor+";"),e.margin&&(e.margin.top>0&&(e.pageStyle+="padding-top:"+2*e.margin.top+"rpx;"),e.pageStyle+="padding-bottom:"+2*e.margin.bottom+"rpx;",e.pageStyle+="padding-right:"+2*e.margin.both+"rpx;",e.pageStyle+="padding-left:"+2*e.margin.both+"rpx;")))})),_.value=h.value.some((e=>e&&e.position&&"top_fixed"==e.position)),d({title:h.title})}v.value=!1,e&&e(f)}))}};return{getLoading:()=>v.value,requestData:f,data:B.value,isShowTopTabbar:_,pageStyle:()=>{let e="";return B.value.global.pageStartBgColor&&(B.value.global.pageStartBgColor&&B.value.global.pageEndBgColor?e+=`background:linear-gradient(${B.value.global.pageGradientAngle},${B.value.global.pageStartBgColor},${B.value.global.pageEndBgColor});`:e+="background-color:"+B.value.global.pageStartBgColor+";"),B.value.global.bottomTabBar&&B.value.global.bottomTabBar.isShow?e+="min-height:calc(100vh - 50px);":e+="min-height:calc(100vh);",B.value.global.bgUrl&&(e+=`background-image:url('${t(B.value.global.bgUrl)}');`),B.value.global.bgHeightScale&&(e+=`background-size: 100% ${B.value.global.bgHeightScale}%;`),e},onLoad:(e=null)=>{r((a=>{S.mode=a.mode||"","decorate"==S.mode&&(f.status=1,f.error=[],v.value=!1),a.form_record_id&&(f.form_record_id=a.form_record_id),b.value=a.form_id||"",x(e)}))},onShow:(e=null)=>{g((()=>{e&&e(f)}))},onHide:(e=null)=>{u((()=>{let a=[];uni.getStorageSync("diyPageBlank")&&(a=uni.getStorageSync("diyPageBlank")),a.length&&(a=Array.from(new Set(a)),a.forEach(((e,a,o)=>{e==y.value&&o.splice(a,1)}))),"diy"==S.topFixedStatus&&a.push(y.value),uni.setStorageSync("diyPageBlank",a),e&&e()}))},onUnload:()=>{p((()=>{}))},onPageScroll:()=>{s((e=>{e.scrollTop>0&&(S.scrollTop=e.scrollTop)}))},getData:x}}export{c as u};
