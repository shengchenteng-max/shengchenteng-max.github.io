import{E as ce,__tla as de}from"./el-input.f84bdb48.js";import{E as me,_ as pe,a as _e,b as ge,d as ve,__tla as he}from"./index.vue.8384b162.js";import{_ as fe,__tla as ye}from"./nuxt-link.13472e92.js";import{f as be,R as xe,h as v,z as ke,Q as we,ah as Ce,C as I,a2 as Ve,o as p,i as _,u as t,j as r,F as De,k as Pe,m as s,w as c,L as F,M as z,I as x,t as g,l as k,ak as Te,at as je,am as Le,an as Ue,D as Re,aj as l,T as qe,U as Ae,ao as Ee,ap as Ie,aq as Fe,__tla as ze}from"./entry.ac74755d.js";import{t as Me}from"./test.b3688895.js";import{b as Oe}from"./browser.a1ac24ac.js";import{_ as Qe}from"./_plugin-vue_export-helper.c27b6911.js";import{__tla as Se}from"./index.95b7fbc8.js";import{__tla as Be}from"./vnode.290de06f.js";import{__tla as Ge}from"./debounce.30bd8664.js";let M,He=Promise.all([(()=>{try{return de}catch{}})(),(()=>{try{return he}catch{}})(),(()=>{try{return ye}catch{}})(),(()=>{try{return ze}catch{}})(),(()=>{try{return Se}catch{}})(),(()=>{try{return Be}catch{}})(),(()=>{try{return Ge}catch{}})()]).then(async()=>{const P=f=>(qe("data-v-d417344e"),f=f(),Ae(),f),O={class:"w-full h-full bg-page flex items-center justify-center"},Q={key:0,class:"bg-white"},S={key:0,class:"bg-white w-[380px] p-[30px] h-[424px]"},B={class:"flex items-end my-[30px]"},G=["onClick"],H={class:"flex justify-between leading-none"},J={key:0,class:"text-xs py-[50rpx] flex justify-center w-full"},K={class:"text-primary"},N={class:"text-primary"},W={key:1,class:"mt-[20px] flex justify-center"},X={key:1,class:"flex flex-col items-center w-[380px] py-[60px] h-[424px]"},Y=P(()=>r("div",{class:"title font-bold text-xl"},"\u6253\u5F00\u624B\u673A\u5FAE\u4FE1",-1)),Z=P(()=>r("div",{class:"tips text-sm mt-[5px]"},"\u70B9\u51FB\u53F3\u4E0A\u89D2\u6253\u5F00\u626B\u4E00\u626B",-1)),$={class:"qrcode p-[10px] mt-[30px] border h-[120px] leading-none box-content"},ee={class:"relative"},ae={key:0,class:"flex flex-col justify-center items-center absolute inset-0 bg-gray-50"},le={class:"text-xs text-gray-600"},te=be({__name:"login",setup(f){let w=xe(),y=v(!0),C=null;const T=()=>{y.value=!y.value,y.value?clearTimeout(C):L()};ke(()=>w.currentRoute.value.path,e=>{e!="/auth/login"&&clearTimeout(C)},{immediate:!0,deep:!0});const j=e=>{Ee({key:e}).then(a=>{let n=a.data;switch(n.status){case"wait":C=setTimeout(()=>{j(u.value.key)},1e3);break;case"success":n.login_data.token?(R.setToken(n.login_data.token),w.push({path:"/"})):(Ie("openId").value=n.login_data.openid,Fe("/auth/bind"));break;case"fail":u.value.pastDueContent=n.fail_reason,u.value.pastDue=!0;break}}).catch(a=>{u.value.pastDue=!0,u.value.pastDueContent=a.msg})},u=v({url:"",key:"",pastDue:!1,pastDueContent:"\u4E8C\u7EF4\u7801\u751F\u6210\u5931\u8D25"}),L=async()=>{let e=await(await Te()).data;u.value.key=e.key,Oe.toDataURL(e.url,{errorCorrectionLevel:"L",margin:0,width:100}).then(a=>{u.value.url=a}),u.value.pastDue=!1,setTimeout(()=>{j(u.value.key)},1e3)};let U=v(!1);je().then(e=>{U.value=e.data});const R=we(),b=Ce();b.getLoginConfig();const q=I(()=>{const e=[];return b.login.is_username&&e.push({type:"username",title:l("usernameLogin")}),b.login.is_mobile&&e.push({type:"mobile",title:l("mobileLogin")}),d.value=e[0]?e[0].type:"",e}),h=v(!1),d=v(""),i=Ve({username:"",password:"",mobile:"",mobile_code:"",mobile_key:""}),V=v(),se=I(()=>({username:{required:d.value=="username",message:l("usernamePlaceholder"),trigger:["blur","change"]},password:{required:d.value=="username",message:l("passwordPlaceholder"),trigger:["blur","change"]},mobile:[{required:d.value=="mobile",message:l("mobilePlaceholder"),trigger:["blur","change"]},{validator(e,a,n){return d.value!="mobile"?!0:Me.mobile(a)},message:l("mobileError"),trigger:["blur"]}],mobile_code:{required:d.value=="mobile",message:l("codePlaceholder"),trigger:["change"]}})),oe=async()=>{var e;await((e=V.value)==null?void 0:e.validate(async(a,n)=>{if(a){if(h.value)return;h.value=!0,(d.value=="username"?Le:Ue)(i).then(async m=>{await R.setToken(m.data.token),w.push({path:"/app/index"})}).catch(()=>{h.value=!1})}}))},A=v(null),re=async()=>{var e;await((e=V.value)==null?void 0:e.validateField("mobile",async(a,n)=>{var m;a&&((m=A.value)==null||m.send())}))};return(e,a)=>{const n=ce,m=me,ie=pe,E=_e,D=fe,ne=ge,ue=ve;return p(),_("div",O,[t(q).length?(p(),_("div",Q,[t(y)?(p(),_("div",S,[r("div",B,[(p(!0),_(De,null,Pe(t(q),o=>(p(),_("div",{class:Re(["mr-[20px] text-base cursor-pointer leading-none",{"font-bold":d.value==o.type}]),onClick:Je=>d.value=o.type},g(o.title),11,G))),256))]),s(ne,{model:i,ref_key:"formRef",ref:V,rules:t(se),"validate-on-rule-change":!1},{default:c(()=>[F(r("div",null,[s(m,{prop:"username"},{default:c(()=>[s(n,{modelValue:i.username,"onUpdate:modelValue":a[0]||(a[0]=o=>i.username=o),placeholder:("t"in e?e.t:t(l))("usernamePlaceholder"),clearable:"","inline-message":!0},null,8,["modelValue","placeholder"])]),_:1}),s(m,{prop:"password"},{default:c(()=>[s(n,{modelValue:i.password,"onUpdate:modelValue":a[1]||(a[1]=o=>i.password=o),placeholder:("t"in e?e.t:t(l))("passwordPlaceholder"),type:"password",clearable:"","show-password":!0},null,8,["modelValue","placeholder"])]),_:1})],512),[[z,d.value=="username"]]),F(r("div",null,[s(m,{prop:"mobile"},{default:c(()=>[s(n,{modelValue:i.mobile,"onUpdate:modelValue":a[2]||(a[2]=o=>i.mobile=o),placeholder:("t"in e?e.t:t(l))("mobilePlaceholder"),clearable:""},null,8,["modelValue","placeholder"])]),_:1}),s(m,{prop:"mobile_code"},{default:c(()=>[s(n,{modelValue:i.mobile_code,"onUpdate:modelValue":a[4]||(a[4]=o=>i.mobile_code=o),placeholder:("t"in e?e.t:t(l))("codePlaceholder")},{suffix:c(()=>[s(ie,{mobile:i.mobile,type:"login",modelValue:i.mobile_key,"onUpdate:modelValue":a[3]||(a[3]=o=>i.mobile_key=o),onClick:re,ref_key:"smsCodeRef",ref:A},null,8,["mobile","modelValue"])]),_:1},8,["modelValue","placeholder"])]),_:1})],512),[[z,d.value=="mobile"]]),r("div",H,[s(D,{to:"/auth/register"},{default:c(()=>[s(E,{type:"primary",link:""},{default:c(()=>[x(g(("t"in e?e.t:t(l))("noAccount"))+"\uFF0C"+g(("t"in e?e.t:t(l))("toRegister")),1)]),_:1})]),_:1})]),s(m,null,{default:c(()=>[s(E,{type:"primary",class:"mt-[20px] w-full",size:"large",onClick:oe,loading:h.value},{default:c(()=>[x(g(h.value?("t"in e?e.t:t(l))("logining"):("t"in e?e.t:t(l))("login")),1)]),_:1},8,["loading"])]),_:1}),t(b).login.agreement_show?(p(),_("div",J,[x(g(("t"in e?e.t:t(l))("agreeTips"))+" ",1),s(D,{to:"/auth/agreement?key=service"},{default:c(()=>[r("span",K,g(("t"in e?e.t:t(l))("userAgreement")),1)]),_:1}),x(" "+g(("t"in e?e.t:t(l))("and"))+" ",1),s(D,{to:"/auth/agreement?key=privacy"},{default:c(()=>[r("span",N,g(("t"in e?e.t:t(l))("privacyAgreement")),1)]),_:1})])):k("",!0),t(U)?(p(),_("div",W,[r("span",{class:"iconfont icon-weixin1 text-[#1AAD19] !text-[24px] cursor-pointer",onClick:T})])):k("",!0)]),_:1},8,["model","rules"])])):(p(),_("div",X,[Y,Z,r("div",$,[r("div",ee,[s(ue,{src:u.value.url,class:"w-[120px]"},null,8,["src"]),u.value.pastDue?(p(),_("div",ae,[r("span",le,g(u.value.pastDueContent),1),r("span",{onClick:a[5]||(a[5]=o=>L()),class:"text-xs cursor-pointer text-color mt-2"},"\u70B9\u51FB\u5237\u65B0")])):k("",!0)])]),r("div",{class:"mt-[60px] text-base cursor-pointer leading-none",onClick:T},"\u8D26\u53F7\u767B\u5F55")]))])):k("",!0)])}}});M=Qe(te,[["__scopeId","data-v-d417344e"]])});export{He as __tla,M as default};
