import{r as D,a as V,b as E,c as G}from"./index-057f98db.js";import{_ as X,aF as Y,r as n,l as m,as as Q,h as W,c as I,a as l,aH as A,J as U,ae as Z,F as $,T as ee,t as F,aK as te,am as ae}from"./index-9f163f98.js";const ie={name:"VerifyPoints",props:{mode:{type:String,default:"fixed"},captchaType:{type:String},vSpace:{type:Number,default:5},imgSize:{type:Object,default(){return{width:"310px",height:"155px"}}},barSize:{type:Object,default(){return{width:"310px",height:"40px"}}}},setup(N,f){const{mode:_,captchaType:e,vSpace:K,imgSize:L,barSize:c}=Y(N),{proxy:s}=te(),h=n(""),z=n(3),p=m([]),a=m([]),o=n(1),O=n(""),w=m([]),v=n(""),u=m({imgHeight:0,imgWidth:0,barHeight:0,barWidth:0}),y=m([]),d=n(""),b=n(void 0),x=n(void 0),j=n(!0),C=n(!0),J=()=>{p.splice(0,p.length),a.splice(0,a.length),o.value=1,H(),ae(()=>{const{imgHeight:i,imgWidth:t,barHeight:g,barWidth:r}=D(s);u.imgHeight=i,u.imgWidth=t,u.barHeight=g,u.barWidth=r,s.$parent.$emit("ready",s)})};Q(()=>{J(),s.$el.onselectstart=function(){return!1}});const S=n(null),R=i=>{if(a.push(k(S,i)),o.value==z.value){o.value=T(k(S,i));const t=M(a,u);a.length=0,a.push(...t),setTimeout(()=>{const g=h.value?V(v.value+"---"+JSON.stringify(a),h.value):v.value+"---"+JSON.stringify(a),r={captchaType:e.value,captcha_code:h.value?V(JSON.stringify(a),h.value):JSON.stringify(a),captcha_key:v.value};E(r).then(P=>{P.code==1?(b.value="#4cae4c",x.value="#5cb85c",d.value="验证成功",C.value=!1,_.value=="pop"&&setTimeout(()=>{s.$parent.clickShow=!1,B()},1500),s.$parent.$emit("success",{captchaVerification:g})):(s.$parent.$emit("error",s),b.value="#d9534f",x.value="#d9534f",d.value="验证失败",setTimeout(()=>{B()},700))})},400)}o.value<z.value&&(o.value=T(k(S,i)))},k=function(i,t){const g=t.offsetX,r=t.offsetY;return{x:g,y:r}},T=function(i){return y.push(Object.assign({},i)),o.value+1},B=function(){y.splice(0,y.length),b.value="#000",x.value="#ddd",C.value=!0,p.splice(0,p.length),a.splice(0,a.length),o.value=1,H(),d.value="验证失败",j.value=!0};function H(){const i={captchaType:e.value};G(i).then(t=>{t.code==1?(O.value=t.data.originalImageBase64,v.value=t.data.token,h.value=t.data.secretKey,w.value=t.data.wordList,d.value="请依次点击【"+w.value.join(",")+"】"):d.value=t.msg})}const M=function(i,t){return i.map(r=>{const P=Math.round(310*r.x/parseInt(t.imgWidth)),q=Math.round(155*r.y/parseInt(t.imgHeight));return{x:P,y:q}})};return{secretKey:h,checkNum:z,fontPos:p,checkPosArr:a,num:o,pointBackImgBase:O,pointTextList:w,backToken:v,setSize:u,tempPoints:y,text:d,barAreaColor:b,barAreaBorderColor:x,showRefresh:j,bindingClick:C,init:J,canvas:S,canvasClick:R,getMousePos:k,createPoint:T,refresh:B,getPictrue:H,pointTransfrom:M}}},se={style:{position:"relative"}},ne={class:"verify-img-out"},oe=l("i",{class:"iconfont icon-refresh"},null,-1),re=[oe],ce=["src"],le={class:"verify-msg"};function he(N,f,_,e,K,L){return W(),I("div",se,[l("div",ne,[l("div",{class:"verify-img-panel",style:A({width:e.setSize.imgWidth,height:e.setSize.imgHeight,"background-size":e.setSize.imgWidth+" "+e.setSize.imgHeight,"margin-bottom":_.vSpace+"px"})},[U(l("div",{class:"verify-refresh",style:{"z-index":"3"},onClick:f[0]||(f[0]=(...c)=>e.refresh&&e.refresh(...c))},re,512),[[Z,e.showRefresh]]),l("img",{src:"data:image/png;base64,"+e.pointBackImgBase,ref:"canvas",alt:"",style:{width:"100%",height:"100%",display:"block"},onClick:f[1]||(f[1]=c=>e.bindingClick?e.canvasClick(c):void 0)},null,8,ce),(W(!0),I($,null,ee(e.tempPoints,(c,s)=>(W(),I("div",{key:s,class:"point-area",style:A({"background-color":"#1abd6c",color:"#fff","z-index":9999,width:"20px",height:"20px","text-align":"center","line-height":"20px","border-radius":"50%",position:"absolute",top:parseInt(c.y-10)+"px",left:parseInt(c.x-10)+"px"})},F(s+1),5))),128))],4)]),l("div",{class:"verify-bar-area",style:A({width:e.setSize.imgWidth,color:this.barAreaColor,"border-color":this.barAreaBorderColor,"line-height":this.barSize.height})},[l("span",le,F(e.text),1)],4)])}const ge=X(ie,[["render",he]]);export{ge as default};
