import{d as ie,v as pe,f as ue,r as p,l as de,h as b,c as N,e as l,w as n,a as d,t as u,u as o,k as e,i as f,B as z,J as re,m as D,a4 as F,aB as H,ac as ce,ad as me,E as fe,a5 as _e,aC as ge,a6 as ve,a7 as he,L as be,D as we,G as Ve,H as Ce,S as xe,a2 as ye,M as Te}from"./index-9f163f98.js";/* empty css                   *//* empty css                     *//* empty css                  *//* empty css                   *//* empty css                */import{_ as ke}from"./index.vue_vue_type_style_index_0_lang-5eb33607.js";import"./el-form-item-4ed993c7.js";/* empty css                 *//* empty css                *//* empty css                      *//* empty css               *//* empty css                  *//* empty css                  *//* empty css                  *//* empty css                 *//* empty css                    */import"./el-tooltip-4ed993c7.js";/* empty css                        *//* empty css                  *//* empty css                    */import{s as Ee}from"./sys-135535fa.js";import{g as Be,a as Ue,b as Le,s as Re,c as Me}from"./weapp-b8f0d76c.js";import{g as ze}from"./module-29351851.js";/* empty css                  *//* empty css                    */const De={class:"main-container"},Fe={class:"flex justify-between items-center"},Se={class:"text-page-title"},We={key:0,class:"mt-[20px]"},$e={class:"mt-[16px] flex justify-end"},Ie={class:"dialog-footer"},Pe=["innerHTML"],Ne=["innerHTML"],He={class:"flex justify-end"},va=ie({__name:"code",setup(je){const j=pe(),y=ue(),A=j.meta.title,T=p(!1),w=p(!0),i=de({page:1,limit:10,total:0,loading:!1,data:[]}),r=p({desc:"",code:"",path:"",content:""}),V=p(null),g=p(!1),k=p("");Ee().then(({data:s})=>{V.value=s}).catch(),ze().then(s=>{s.data.data&&s.data.data.auth_code&&(k.value=s.data.data.auth_code,U()),w.value=!1}).catch(()=>{w.value=!1});const E=p({app_id:"",app_secret:"",is_authorization:0});Be().then(s=>{E.value=s.data});const B=p("/channel/weapp/code"),K=s=>{y.push({path:B.value})},S=p(null),_=(s=1)=>{i.loading=!0,i.page=s,Le({page:i.page,limit:i.limit}).then(a=>{i.loading=!1,i.data=a.data.data,i.total=a.data.total,s==1&&i.data.length&&i.data[0].status==0&&$(i.data[0].task_key)}).catch(()=>{i.loading=!1})};_();const G=()=>{S.value.clearValidate()},v=p(!1),W=()=>{if(!k.value){q();return}if(!E.value.app_id){O();return}v.value||(v.value=!0,C.value="",Re(r.value).then(s=>{_(),U(),v.value=!1}).catch(()=>{v.value=!1}))},J=()=>{F.alert(e("localInsertTips"),e("warning"),{confirmButtonText:e("confirm")})},C=p(""),U=()=>{k.value&&Ue().then(s=>{s.data&&(C.value=`<img src="${s.data}" class="w-[150px]">`)}).catch()},$=s=>{Me(s).then(a=>{const c=a.data.data??[];if(c[0]&&c[0].length){const h=c[0][c[0].length-1];if(h.code==0){_();return}if(h.code==1&&h.percent==100){_(),U(),!H.get("weappUploadTipsLock")&&(g.value=!0);return}setTimeout(()=>{$(s)},2e3)}})},q=()=>{F.confirm(`上传代码需先绑定授权码，如果已有授权请先进行绑定，没有授权可到${V.value.website_name}官网购买授权之后再进行操作`,e("warning"),{distinguishCancelAndClose:!0,confirmButtonText:e("toBind"),cancelButtonText:`去${V.value.website_name}官网`}).then(()=>{y.push({path:"/tools/authorize"})}).catch(s=>{s==="cancel"&&window.open(V.value.website_url)})},O=()=>{F.confirm(e("weappTips"),e("warning"),{confirmButtonText:e("toSetting"),cancelButtonText:e("cancel")}).then(()=>{y.push({path:"/channel/weapp/config"})}).catch(s=>{})},I=p(""),L=p(!1),Q=s=>{I.value=s.fail_reason,L.value=!0},X=()=>{H.set({key:"weappUploadTipsLock",data:!0}),g.value=!1};return(s,a)=>{const c=ce,h=me,m=fe,x=_e,Y=ge,Z=ve,ee=he,ae=be,P=we,R=Ve,te=ke,le=Ce,M=xe,oe=ye,ne=Te;return b(),N("div",De,[l(ae,{class:"card !border-none",shadow:"never"},{default:n(()=>[d("div",Fe,[d("span",Se,u(o(A)),1)]),l(h,{modelValue:B.value,"onUpdate:modelValue":a[0]||(a[0]=t=>B.value=t),class:"my-[20px]",onTabChange:K},{default:n(()=>[l(c,{label:o(e)("weappAccessFlow"),name:"/channel/weapp"},null,8,["label"]),l(c,{label:o(e)("subscribeMessage"),name:"/channel/weapp/message"},null,8,["label"]),l(c,{label:o(e)("weappRelease"),name:"/channel/weapp/code"},null,8,["label"])]),_:1},8,["modelValue"]),E.value.is_authorization?z("",!0):(b(),N("div",We,[l(m,{type:"primary",onClick:W,loading:v.value,disabled:w.value},{default:n(()=>[f(u(o(e)("cloudRelease")),1)]),_:1},8,["loading","disabled"]),l(m,{onClick:J,disabled:w.value},{default:n(()=>[f(u(o(e)("localRelease")),1)]),_:1},8,["disabled"])])),re((b(),D(Z,{class:"mt-[15px]",data:i.data,size:"default"},{empty:n(()=>[d("span",null,u(o(e)("emptyData")),1)]),default:n(()=>[l(x,{prop:"version",label:o(e)("code"),align:"left"},null,8,["label"]),l(x,{prop:"status_name",label:o(e)("status"),align:"left"},{default:n(({row:t})=>[d("div",null,u(t.status_name),1)]),_:1},8,["label"]),l(x,{prop:"create_time",label:o(e)("createTime"),align:"center"},null,8,["label"]),l(x,{label:o(e)("operation"),fixed:"right",align:"right","min-width":"120"},{default:n(({row:t,$index:se})=>[C.value&&se==0&&(t.status==1||t.status==2)&&i.page==1?(b(),D(Y,{key:0,content:C.value,"raw-content":"",effect:"light"},{default:n(()=>[l(m,{type:"primary",link:""},{default:n(()=>[f(u(o(e)("preview")),1)]),_:1})]),_:1},8,["content"])):z("",!0),t.status==-1||t.status==-2?(b(),D(m,{key:1,type:"primary",link:"",onClick:Ae=>Q(t)},{default:n(()=>[f(u(o(e)("failReason")),1)]),_:2},1032,["onClick"])):z("",!0)]),_:1},8,["label"])]),_:1},8,["data"])),[[ne,i.loading]]),d("div",$e,[l(ee,{"current-page":i.page,"onUpdate:current-page":a[1]||(a[1]=t=>i.page=t),"page-size":i.limit,"onUpdate:page-size":a[2]||(a[2]=t=>i.limit=t),layout:"total, sizes, prev, pager, next, jumper",total:i.total,onSizeChange:a[3]||(a[3]=t=>_()),onCurrentChange:_},null,8,["current-page","page-size","total"])])]),_:1}),l(M,{modelValue:T.value,"onUpdate:modelValue":a[8]||(a[8]=t=>T.value=t),title:o(e)("codeDownTwoDesc"),width:"30%","before-close":G},{footer:n(()=>[d("span",Ie,[l(m,{onClick:a[7]||(a[7]=t=>T.value=!1)},{default:n(()=>[f(u(o(e)("cancel")),1)]),_:1}),l(m,{type:"primary",onClick:W},{default:n(()=>[f(u(o(e)("confirm")),1)]),_:1})])]),default:n(()=>[l(le,{ref_key:"ruleFormRef",ref:S,model:r.value,"label-width":"120px"},{default:n(()=>[l(R,{prop:"code",label:o(e)("code")},{default:n(()=>[l(P,{modelValue:r.value.code,"onUpdate:modelValue":a[4]||(a[4]=t=>r.value.code=t),modelModifiers:{trim:!0},placeholder:o(e)("codePlaceholder"),onkeyup:"this.value = this.value.replace(/[^\\d\\.]/g,'');"},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),l(R,{prop:"path",label:o(e)("path")},{default:n(()=>[l(te,{modelValue:r.value.path,"onUpdate:modelValue":a[5]||(a[5]=t=>r.value.path=t),api:"weapp/upload",accept:".zip"},null,8,["modelValue","accept"])]),_:1},8,["label"]),l(R,{label:o(e)("content")},{default:n(()=>[l(P,{type:"textarea",modelValue:r.value.content,"onUpdate:modelValue":a[6]||(a[6]=t=>r.value.content=t),modelModifiers:{trim:!0},placeholder:o(e)("contentPlaceholder")},null,8,["modelValue","placeholder"])]),_:1},8,["label"])]),_:1},8,["model"])]),_:1},8,["modelValue","title"]),l(M,{modelValue:L.value,"onUpdate:modelValue":a[9]||(a[9]=t=>L.value=t),title:o(e)("failReason"),width:"60%"},{default:n(()=>[l(oe,{class:"h-[60vh] w-full whitespace-pre-wrap p-[20px]"},{default:n(()=>[d("div",{innerHTML:I.value},null,8,Pe)]),_:1})]),_:1},8,["modelValue","title"]),l(M,{modelValue:g.value,"onUpdate:modelValue":a[11]||(a[11]=t=>g.value=t),title:o(e)("warning"),width:"500px",draggable:""},{footer:n(()=>[d("div",He,[l(m,{onClick:X,type:"primary"},{default:n(()=>[f(u(o(e)("knownToKnow")),1)]),_:1}),l(m,{onClick:a[10]||(a[10]=t=>g.value=!1),type:"primary",plain:""},{default:n(()=>[f(u(o(e)("confirm")),1)]),_:1})])]),default:n(()=>[d("span",{innerHTML:o(e)("uploadSuccessTips")},null,8,Ne)]),_:1},8,["modelValue","title"])])}}});export{va as default};
