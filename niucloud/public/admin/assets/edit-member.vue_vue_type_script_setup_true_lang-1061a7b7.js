import{d as q,r as v,k as o,X as z,l as Q,h as i,m as s,w as m,a as $,e as c,i as L,t as w,u as r,J as W,aO as Z,B as f,c as x,F as C,T as F,K as A,G as ee,D as le,bj as ae,a3 as te,ah as oe,H as re,E as ue,S as ie,M as de}from"./index-9f163f98.js";/* empty css                   *//* empty css                  *//* empty css                   *//* empty css                  *//* empty css                *//* empty css                 *//* empty css               *//* empty css                  *//* empty css                  *//* empty css                     *//* empty css                  *//* empty css                       */import"./el-form-item-4ed993c7.js";import me from"./index-b01212c8.js";import{a as ne,g as se,E as ve,F as pe}from"./member-6dbdeb9b.js";const be={key:8},ce={class:"text-sm text-gray-400"},fe={class:"dialog-footer"},Te=q({__name:"edit-member",emits:["complete"],setup(_e,{expose:I,emit:P}){const a=v(""),D=v(""),B=v(""),h=v(!1),p=v(!1),_=v(!1),y=v(null),Y=v([{id:0,name:o("secrecySex")},{id:1,name:o("manSex")},{id:2,name:o("girlSex")}]),k=v(null);(async()=>{k.value=await(await se()).data})();const N=v([]);ne().then(({data:d})=>{N.value=d});const j=z(()=>({mobile:[{validator(d,e,n){if(!e)return n();/^1[3-9]\d{9}$/.test(e)?n():n(new Error("请输入正确的手机号"))},trigger:"blur"}],id_card:[{validator(d,e,n){if(!e)return n();/^[1-9]\d{5}[1-9]\d{3}((0\d)|(1[0-2]))(([0|1|2]\d)|3[0-1])\d{3}([0-9]|X)$/.test(e)?n():n(new Error("请输入正确的身份证号"))},trigger:"blur"}]})),l=Q({...{headimg:"",nickname:"",member_label:"",member_level:"",sex:"",birthday:""}}),R=async d=>{var e;await((e=y.value)==null?void 0:e.validate(n=>{if(n){if(p.value=!0,_.value)return;_.value=!0;let u=l[a.value];a.value=="member_label"&&(u=l[a.value]&&l[a.value].length?A(l[a.value]).join(",").split(","):"");const b=v({member_id:B.value,field:a.value,value:u});ve(b.value).then(E=>{p.value=!1,_.value=!1,h.value=!1,P("complete")}).catch(()=>{p.value=!1,_.value=!1})}}))},O=async(d=null)=>{p.value=!0,a.value=d.type,D.value=d.title,B.value=d.id,l[a.value]=d.data[a.value],a.value=="member_label"&&l[a.value]&&l[a.value].forEach((e,n)=>{let u=!1;for(let b=0;b<k.value.length;b++)if(k.value[b].label_id==e){u=!0;break}u?l[a.value][n]=Number.parseFloat(e):l[a.value].splice(n,1)}),p.value=!1},T=v(null),g=v({is_all:0,ids:[],where:{}}),X=d=>{p.value=!0,a.value=d.type,T.value=d.method,g.value.is_all=d.data.is_all,g.value.ids=d.data.ids,g.value.where=d.data.where,D.value=d.title,l[a.value]=null,p.value=!1},G=async d=>{var e;await((e=y.value)==null?void 0:e.validate(n=>{if(n){if(p.value=!0,_.value)return;_.value=!0;let u=l[a.value];a.value=="member_label"&&(u=l[a.value]&&l[a.value].length?A(l[a.value]).join(",").split(","):"");const b=v({is_all:g.value.is_all,member_ids:g.value.ids,where:g.value.where,field:a.value,value:u});console.log(b.value),pe(b.value).then(E=>{p.value=!1,_.value=!1,h.value=!1,P("complete")}).catch(()=>{p.value=!1,_.value=!1})}}))};return I({showDialog:h,setDialogType:O,batchSetDialogType:X}),(d,e)=>{const n=me,u=ee,b=le,E=ae,M=te,S=oe,H=re,U=ue,J=ie,K=de;return i(),s(J,{modelValue:h.value,"onUpdate:modelValue":e[13]||(e[13]=t=>h.value=t),title:D.value||r(o)("updateMember"),width:"500px","destroy-on-close":!0},{footer:m(()=>[$("span",fe,[c(U,{onClick:e[10]||(e[10]=t=>h.value=!1)},{default:m(()=>[L(w(r(o)("cancel")),1)]),_:1}),T.value=="batchSet"?(i(),s(U,{key:0,type:"primary",loading:p.value,onClick:e[11]||(e[11]=t=>G(y.value))},{default:m(()=>[L(w(r(o)("confirm")),1)]),_:1},8,["loading"])):(i(),s(U,{key:1,type:"primary",loading:p.value,onClick:e[12]||(e[12]=t=>R(y.value))},{default:m(()=>[L(w(r(o)("confirm")),1)]),_:1},8,["loading"]))])]),default:m(()=>[W((i(),s(H,{model:l,"label-width":"90px",rules:r(j),ref_key:"formRef",ref:y,class:"page-form",onSubmit:e[9]||(e[9]=Z(()=>{},["prevent"]))},{default:m(()=>[a.value=="headimg"?(i(),s(u,{key:0,label:r(o)("headimg")},{default:m(()=>[c(n,{modelValue:l.headimg,"onUpdate:modelValue":e[0]||(e[0]=t=>l.headimg=t)},null,8,["modelValue"])]),_:1},8,["label"])):f("",!0),a.value=="nickname"?(i(),s(u,{key:1,label:r(o)("nickname")},{default:m(()=>[c(b,{modelValue:l.nickname,"onUpdate:modelValue":e[1]||(e[1]=t=>l.nickname=t),modelModifiers:{trim:!0},clearable:"",placeholder:r(o)("nickNamePlaceholder"),class:"input-width"},null,8,["modelValue","placeholder"])]),_:1},8,["label"])):f("",!0),a.value=="mobile"?(i(),s(u,{key:2,label:r(o)("mobile"),prop:"mobile"},{default:m(()=>[c(b,{modelValue:l.mobile,"onUpdate:modelValue":e[2]||(e[2]=t=>l.mobile=t),modelModifiers:{trim:!0},clearable:"",placeholder:r(o)("mobilePlaceholder"),maxlength:"11",class:"input-width"},null,8,["modelValue","placeholder"])]),_:1},8,["label"])):f("",!0),a.value=="id_card"?(i(),s(u,{key:3,label:r(o)("idCard"),prop:"id_card"},{default:m(()=>[c(b,{modelValue:l.id_card,"onUpdate:modelValue":e[3]||(e[3]=t=>l.id_card=t),modelModifiers:{trim:!0},clearable:"",placeholder:r(o)("idCardPlaceholder"),maxlength:"18",class:"input-width"},null,8,["modelValue","placeholder"])]),_:1},8,["label"])):f("",!0),a.value=="remark"?(i(),s(u,{key:4,label:r(o)("remark"),prop:"remark"},{default:m(()=>[c(b,{modelValue:l.remark,"onUpdate:modelValue":e[4]||(e[4]=t=>l.remark=t),modelModifiers:{trim:!0},type:"textarea",clearable:"",placeholder:r(o)("remarkPlaceholder"),maxlength:"100",rows:5,class:"input-width"},null,8,["modelValue","placeholder"])]),_:1},8,["label"])):f("",!0),a.value=="birthday"?(i(),s(u,{key:5,label:r(o)("birthday")},{default:m(()=>[c(E,{modelValue:l.birthday,"onUpdate:modelValue":e[5]||(e[5]=t=>l.birthday=t),"value-format":"YYYY-MM-DD",type:"date",placeholder:r(o)("birthdayTip")},null,8,["modelValue","placeholder"])]),_:1},8,["label"])):f("",!0),a.value=="sex"?(i(),s(u,{key:6,label:r(o)("sex")},{default:m(()=>[c(S,{modelValue:l.sex,"onUpdate:modelValue":e[6]||(e[6]=t=>l.sex=t),clearable:"",placeholder:r(o)("sexPlaceholder"),class:"input-width"},{default:m(()=>[(i(!0),x(C,null,F(Y.value,(t,V)=>(i(),s(M,{label:t.name,value:t.id,key:V},null,8,["label","value"]))),128))]),_:1},8,["modelValue","placeholder"])]),_:1},8,["label"])):f("",!0),a.value=="member_label"?(i(),s(u,{key:7,label:r(o)("memberLabel")},{default:m(()=>[c(S,{modelValue:l.member_label,"onUpdate:modelValue":e[7]||(e[7]=t=>l.member_label=t),multiple:"","collapse-tags":"",placeholder:r(o)("memberLabelPlaceholder"),class:"input-width"},{default:m(()=>[(i(!0),x(C,null,F(k.value,(t,V)=>(i(),s(M,{label:t.label_name,value:t.label_id,key:V},null,8,["label","value"]))),128))]),_:1},8,["modelValue","placeholder"])]),_:1},8,["label"])):f("",!0),a.value=="member_level"?(i(),x("div",be,[c(u,{label:r(o)("memberLevelUpdate"),prop:"member_level"},{default:m(()=>[c(S,{modelValue:l.member_level,"onUpdate:modelValue":e[8]||(e[8]=t=>l.member_level=t),placeholder:r(o)("memberLevelPlaceholder"),clearable:"",class:"input-width"},{default:m(()=>[(i(!0),x(C,null,F(N.value,(t,V)=>(i(),s(M,{label:t.level_name,value:t.level_id,key:V},null,8,["label","value"]))),128))]),_:1},8,["modelValue","placeholder"]),$("div",ce,w(r(o)("memberLevelUpdateTips")),1)]),_:1},8,["label"])])):f("",!0)]),_:1},8,["model","rules"])),[[K,p.value]])]),_:1},8,["modelValue","title"])}}});export{Te as _};
