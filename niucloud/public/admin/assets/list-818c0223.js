import{d as Ie,v as Me,f as Ne,r as u,l as F,X as te,k as l,bf as Oe,h as c,c as B,e as t,w as o,a as f,t as m,u as r,i as p,F as le,T as ae,m as h,J as Le,B as S,n as je,z as qe,bg as Ye,a4 as O,Y as Ae,E as Je,D as We,G as Ge,a3 as He,ah as Xe,H as Ke,L as Qe,ap as Ze,a5 as et,ab as tt,aS as lt,aT as at,aU as ot,a6 as nt,a7 as rt,S as st,ac as it,ad as mt,M as pt,_ as ut}from"./index-9f163f98.js";/* empty css                   */import{_ as dt}from"./index.vue_vue_type_script_setup_true_lang-944210a3.js";import ct from"./index-b01212c8.js";/* empty css                    *//* empty css                  *//* empty css                   *//* empty css                      *//* empty css                 *//* empty css               *//* empty css                  *//* empty css                  *//* empty css                     *//* empty css                  *//* empty css                 *//* empty css                    */import"./el-tooltip-4ed993c7.js";/* empty css                  *//* empty css                         *//* empty css                        *//* empty css                *//* empty css                */import"./el-form-item-4ed993c7.js";import{l as ft,a as _t,m as vt,n as yt,o as oe,p as gt}from"./diy_form-8a6dfb58.js";import{_ as ht}from"./records.vue_vue_type_style_index_0_lang-6f50477b.js";import{f as bt}from"./form-submit-popup-c422458a.js";import{_ as kt}from"./form-write-popup.vue_vue_type_style_index_0_lang-0f467c15.js";import{_ as Ct}from"./index.vue_vue_type_script_setup_true_lang-e4d60ef6.js";import"./sys-135535fa.js";/* empty css                        */import"./index.vue_vue_type_style_index_0_lang-eb3f7737.js";import"./attachment-d1610ab5.js";import"./index.vue_vue_type_script_setup_true_lang-761ba1b4.js";/* empty css                 *//* empty css               *//* empty css                  *//* empty css                    */import"./index.vue_vue_type_script_setup_true_lang-e32ef5b5.js";/* empty css                   */import"./index.vue_vue_type_script_setup_true_lang-b29ac1a4.js";import"./sortable.esm-be94e56d.js";/* empty css                  *//* empty css                         *//* empty css                       */import"./member_head-d9fd7b2c.js";/* empty css                       *//* empty css                 */import"./browser-a1ac24ac.js";/* empty css                       */import"./member-6dbdeb9b.js";const wt={class:"main-container"},xt={class:"flex justify-between items-center"},Dt={class:"text-page-title"},Ft={class:"mb-[10px] flex items-center"},Tt={class:"flex items-center justify-end"},Vt={class:"mt-[16px] flex justify-end"},Et={class:"image-selection-container"},Pt=["onClick"],St=["src"],$t={class:"option-title"},Rt={class:"dialog-footer"},Bt={class:"dialog-footer"},Ut=Ie({__name:"list",setup(zt){const ne=Me(),L=Ne(),re=ne.meta.title,b=u(!1),w=F({}),C=F({title:"",type:""}),U=u(null),se=n=>{const e={form_id:n.form_id};U.value.setFormData(e),U.value.showDialog=!0},ie=te(()=>({title:[{required:!0,message:l("titlePlaceholder"),trigger:"blur"}],type:[{required:!0,message:l("formTypePlaceholder"),trigger:"blur"}]})),j=u(),T=u(!1),me=async n=>{n&&await n.validate(async e=>{if(e){const s={type:C.type},k=L.resolve({path:"/decorate/form/edit",query:s});window.open(k.href),T.value=!1,C.title="",C.type=""}})},q=n=>{const e=n.status===1?0:1,s={form_id:n.form_id,status:e};ft(s).then(k=>{n.status=e})};((n="")=>{_t().then(e=>{for(const s in w)delete w[s];for(const s in e.data)w[s]=e.data[s];C.type=Object.keys(w)[0]})})(),F({});const i=F({page:1,limit:10,total:0,loading:!0,data:[],searchParam:{title:"",type:"",mode:"",addon_name:""}}),Y=u(),_=(n=1)=>{i.loading=!0,i.page=n,vt({page:i.page,limit:i.limit,...i.searchParam}).then(e=>{i.loading=!1,i.data=e.data.data,i.total=e.data.total,Ye(i.page,i.limit,i.searchParam)}).catch(()=>{i.loading=!1})};_(Oe(i.searchParam).page);const pe=n=>{C.type=n.toString()},ue=n=>{n&&(n.resetFields(),_())},de=n=>{const e=L.resolve({path:"/decorate/form/edit",query:{form_id:n.form_id}});window.open(e.href)},ce=n=>{O.confirm(l("diyFormCopyTips"),l("warning"),{confirmButtonText:l("confirm"),cancelButtonText:l("cancel"),type:"warning"}).then(()=>{b.value||(b.value=!0,yt({form_id:n}).then(e=>{e.code==1&&_(),b.value=!1}).catch(()=>{b.value=!1}))})},fe=n=>{O.confirm(l("diyFormDeleteTips"),l("warning"),{confirmButtonText:l("confirm"),cancelButtonText:l("cancel"),type:"warning"}).then(()=>{oe({form_ids:[n]}).then(()=>{_()}).catch(()=>{})})},$=u(),R=u(!1),_e=n=>{R.value=!1,A.value.toggleAllSelection()},A=u(),x=u([]),ve=n=>{x.value=n,$.value=!1,x.value.length>0&&x.value.length<i.data.length?R.value=!0:R.value=!1,x.value.length==i.data.length&&($.value=!0)},ye=()=>{if(x.value.length==0){Ae({type:"warning",message:`${l("batchEmptySelectedFormsTips")}`});return}O.confirm(l("batchFormsDeleteTips"),l("warning"),{confirmButtonText:l("confirm"),cancelButtonText:l("cancel"),type:"warning"}).then(()=>{if(b.value)return;b.value=!0;const n=[];x.value.forEach(e=>{n.push(e.form_id)}),oe({form_ids:n}).then(()=>{_(),b.value=!1}).catch(()=>{b.value=!1})})},v=u("wechat"),J=u(""),W=u(0),y=F({wechat:{title:"",desc:"",url:""},weapp:{title:"",url:""}}),V=u(!1),ge=te(()=>({})),G=u(),he=async n=>{W.value=n.form_id,J.value=n.title;const e=n.share;y.wechat=e.wechat,y.weapp=e.weapp,V.value=!0},be=async n=>{n&&await n.validate(async e=>{e&&gt({form_id:W.value,share:JSON.stringify(y)}).then(()=>{_(),V.value=!1}).catch(()=>{})})},H=u(null),ke=n=>{var E;const e="/app/pages/index/diy_form",s=[{name:"form_id",value:n.form_id}],k="表单推广",g="diy_form";(E=H.value)==null||E.show(e,s,k,g)},z=u(null),Ce=n=>{z.value.setFormData(n),z.value.showDialog=!0},I=u(null),we=n=>{I.value.setFormData(n),I.value.showDialog=!0},xe=u(null),M=u(!1),De=n=>{M.value=n},X=F({form_id:0}),Fe=n=>{X.form_id=n.form_id,M.value=!0};return(n,e)=>{const s=Je,k=We,g=Ge,E=He,Te=Xe,N=Ke,K=Qe,Ve=Ze,D=et,Q=tt,P=lt,Ee=at,Pe=ot,Se=nt,$e=rt,Z=st,ee=it,Re=mt,Be=ct,Ue=dt,ze=pt;return c(),B("div",wt,[t(K,{class:"box-card !border-none",shadow:"never"},{default:o(()=>[f("div",xt,[f("span",Dt,m(r(re)),1),t(s,{type:"primary",class:"w-[100px]",onClick:e[0]||(e[0]=a=>T.value=!0)},{default:o(()=>[p(m(r(l)("addDiyForm")),1)]),_:1})]),t(K,{class:"box-card !border-none my-[10px] table-search-wrap",shadow:"never"},{default:o(()=>[t(N,{inline:!0,model:i.searchParam,ref_key:"searchFormDiyFormRef",ref:Y},{default:o(()=>[t(g,{label:r(l)("title"),prop:"title"},{default:o(()=>[t(k,{modelValue:i.searchParam.title,"onUpdate:modelValue":e[1]||(e[1]=a=>i.searchParam.title=a),modelModifiers:{trim:!0},placeholder:r(l)("titlePlaceholder")},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),t(g,{label:r(l)("typeName"),prop:"type"},{default:o(()=>[t(Te,{modelValue:i.searchParam.type,"onUpdate:modelValue":e[2]||(e[2]=a=>i.searchParam.type=a),placeholder:r(l)("formTypePlaceholder")},{default:o(()=>[t(E,{label:r(l)("all"),value:""},null,8,["label"]),(c(!0),B(le,null,ae(w,(a,d)=>(c(),h(E,{label:a.title,value:d,key:d},null,8,["label","value"]))),128))]),_:1},8,["modelValue","placeholder"])]),_:1},8,["label"]),t(g,null,{default:o(()=>[t(s,{type:"primary",onClick:e[3]||(e[3]=a=>_())},{default:o(()=>[p(m(r(l)("search")),1)]),_:1}),t(s,{onClick:e[4]||(e[4]=a=>ue(Y.value))},{default:o(()=>[p(m(r(l)("reset")),1)]),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),f("div",Ft,[t(Ve,{modelValue:$.value,"onUpdate:modelValue":e[5]||(e[5]=a=>$.value=a),size:"large",class:"px-[14px]",onChange:_e,indeterminate:R.value},null,8,["modelValue","indeterminate"]),t(s,{onClick:ye,size:"small"},{default:o(()=>[p(m(r(l)("batchDeletion")),1)]),_:1})]),Le((c(),h(Se,{data:i.data,size:"large",ref_key:"diyFormListTableRef",ref:A,onSelectionChange:ve},{empty:o(()=>[f("span",null,m(i.loading?"":r(l)("emptyData")),1)]),default:o(()=>[t(D,{type:"selection",width:"55"}),t(D,{prop:"page_title",label:r(l)("title"),"min-width":"120"},null,8,["label"]),t(D,{prop:"type_name",label:r(l)("typeName"),"min-width":"80"},null,8,["label"]),t(D,{label:r(l)("status"),"min-width":"80"},{default:o(({row:a})=>[a.status==1?(c(),h(Q,{key:0,type:"success",class:"cursor-pointer",onClick:d=>q(a)},{default:o(()=>[p(m(r(l)("statusOn")),1)]),_:2},1032,["onClick"])):(c(),h(Q,{key:1,type:"info",class:"cursor-pointer",onClick:d=>q(a)},{default:o(()=>[p(m(r(l)("statusOff")),1)]),_:2},1032,["onClick"]))]),_:1},8,["label"]),t(D,{prop:"update_time",label:r(l)("updateTime"),"min-width":"120"},null,8,["label"]),t(D,{label:r(l)("operation"),fixed:"right",align:"right","min-width":"130"},{default:o(({row:a})=>[f("div",Tt,[a.status==1&&a.type=="DIY_FORM"?(c(),h(s,{key:0,type:"primary",link:"",onClick:d=>ke(a)},{default:o(()=>[p(m(r(l)("promotion")),1)]),_:2},1032,["onClick"])):S("",!0),t(s,{type:"primary",link:"",onClick:d=>de(a)},{default:o(()=>[p(m(r(l)("edit")),1)]),_:2},1032,["onClick"]),a.status==0?(c(),h(s,{key:1,type:"primary",link:"",onClick:d=>fe(a.form_id)},{default:o(()=>[p(m(r(l)("delete")),1)]),_:2},1032,["onClick"])):S("",!0),t(s,{type:"primary",link:"",onClick:d=>se(a)},{default:o(()=>[p(m(r(l)("detail")),1)]),_:2},1032,["onClick"]),t(Pe,{placement:"bottom",trigger:"click",class:"ml-[12px]"},{dropdown:o(()=>[t(Ee,null,{default:o(()=>[a.type=="DIY_FORM"?(c(),h(P,{key:0},{default:o(()=>[t(s,{type:"primary",class:"w-full",link:"",onClick:d=>Ce(a)},{default:o(()=>[p(m(r(l)("submitSuccess")),1)]),_:2},1032,["onClick"])]),_:2},1024)):S("",!0),t(P,null,{default:o(()=>[t(s,{type:"primary",class:"w-full",link:"",onClick:d=>we(a)},{default:o(()=>[p(m(r(l)("writeSet")),1)]),_:2},1032,["onClick"])]),_:2},1024),a.type=="DIY_FORM"?(c(),h(P,{key:1},{default:o(()=>[t(s,{type:"primary",class:"w-full",link:"",onClick:d=>he(a)},{default:o(()=>[p(m(r(l)("shareSet")),1)]),_:2},1032,["onClick"])]),_:2},1024)):S("",!0),t(P,null,{default:o(()=>[t(s,{type:"primary",class:"w-full",link:"",onClick:d=>Fe(a)},{default:o(()=>[p(m(r(l)("export")),1)]),_:2},1032,["onClick"])]),_:2},1024),t(P,null,{default:o(()=>[t(s,{type:"primary",class:"w-full",link:"",onClick:d=>ce(a.form_id)},{default:o(()=>[p(m(r(l)("copy")),1)]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024)]),default:o(()=>[t(s,{type:"primary",link:""},{default:o(()=>[p(m(r(l)("more")),1)]),_:1})]),_:2},1024)])]),_:1},8,["label"])]),_:1},8,["data"])),[[ze,i.loading]]),f("div",Vt,[t($e,{"current-page":i.page,"onUpdate:current-page":e[6]||(e[6]=a=>i.page=a),"page-size":i.limit,"onUpdate:page-size":e[7]||(e[7]=a=>i.limit=a),layout:"total, sizes, prev, pager, next, jumper",total:i.total,onSizeChange:e[8]||(e[8]=a=>_()),onCurrentChange:_},null,8,["current-page","page-size","total"])])]),_:1}),t(Z,{modelValue:T.value,"onUpdate:modelValue":e[11]||(e[11]=a=>T.value=a),title:r(l)("addFormTips"),width:"980px"},{footer:o(()=>[f("span",Rt,[t(s,{onClick:e[9]||(e[9]=a=>T.value=!1)},{default:o(()=>[p(m(r(l)("cancel")),1)]),_:1}),t(s,{type:"primary",onClick:e[10]||(e[10]=a=>me(j.value))},{default:o(()=>[p(m(r(l)("confirm")),1)]),_:1})])]),default:o(()=>[t(N,{model:C,ref_key:"formRef",ref:j,rules:r(ie)},{default:o(()=>[t(g,{prop:"type"},{default:o(()=>[f("div",Et,[(c(!0),B(le,null,ae(w,(a,d)=>(c(),B("div",{key:d,class:je(["image-option",{selected:C.type===d}]),onClick:Mt=>pe(d)},[f("img",{src:r(qe)(a.preview),class:"option-image"},null,8,St),f("div",$t,m(a.title),1)],10,Pt))),128))])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue","title"]),t(Z,{modelValue:V.value,"onUpdate:modelValue":e[18]||(e[18]=a=>V.value=a),title:r(l)("shareSet"),width:"30%"},{footer:o(()=>[f("span",Bt,[t(s,{onClick:e[16]||(e[16]=a=>V.value=!1)},{default:o(()=>[p(m(r(l)("cancel")),1)]),_:1}),t(s,{type:"primary",onClick:e[17]||(e[17]=a=>be(G.value))},{default:o(()=>[p(m(r(l)("confirm")),1)]),_:1})])]),default:o(()=>[t(Re,{modelValue:v.value,"onUpdate:modelValue":e[12]||(e[12]=a=>v.value=a)},{default:o(()=>[t(ee,{label:r(l)("wechat"),name:"wechat"},null,8,["label"]),t(ee,{label:r(l)("weapp"),name:"weapp"},null,8,["label"])]),_:1},8,["modelValue"]),t(N,{model:y[v.value],"label-width":"90px",ref_key:"shareFormRef",ref:G,rules:r(ge)},{default:o(()=>[t(g,{label:r(l)("sharePage")},{default:o(()=>[f("span",null,m(J.value),1)]),_:1},8,["label"]),t(g,{label:r(l)("shareTitle"),prop:"title"},{default:o(()=>[t(k,{modelValue:y[v.value].title,"onUpdate:modelValue":e[13]||(e[13]=a=>y[v.value].title=a),modelModifiers:{trim:!0},placeholder:r(l)("shareTitlePlaceholder"),clearable:"",maxlength:"30","show-word-limit":""},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),v.value=="wechat"?(c(),h(g,{key:0,label:r(l)("shareDesc"),prop:"desc"},{default:o(()=>[t(k,{modelValue:y[v.value].desc,"onUpdate:modelValue":e[14]||(e[14]=a=>y[v.value].desc=a),modelModifiers:{trim:!0},placeholder:r(l)("shareDescPlaceholder"),type:"textarea",rows:"4",clearable:"",maxlength:"100","show-word-limit":""},null,8,["modelValue","placeholder"])]),_:1},8,["label"])):S("",!0),t(g,{label:r(l)("shareImageUrl"),prop:"url"},{default:o(()=>[t(Be,{modelValue:y[v.value].url,"onUpdate:modelValue":e[15]||(e[15]=a=>y[v.value].url=a),limit:1},null,8,["modelValue"])]),_:1},8,["label"])]),_:1},8,["model","rules"])]),_:1},8,["modelValue","title"]),t(Ct,{ref_key:"spreadPopupRef",ref:H},null,512),t(bt,{ref_key:"formSubmitPopupRef",ref:z,onComplete:_},null,512),t(kt,{ref_key:"formWritePopupRef",ref:I,onComplete:_},null,512),t(ht,{ref_key:"recordsDetailDialog",ref:U},null,512),t(Ue,{ref_key:"exportSureDialog",ref:xe,show:M.value,type:"diy_form_records",searchParam:X,onClose:De},null,8,["show","searchParam"])])}}});const Ul=ut(Ut,[["__scopeId","data-v-df28412f"]]);export{Ul as default};
