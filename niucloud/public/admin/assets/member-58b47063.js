import{d as ke,v as xe,l as Ce,r as m,X as J,N as Se,h as v,c as k,e,w as n,a as _,t as u,u as t,i as c,k as a,F as M,T,m as E,n as O,J as De,z as Pe,am as N,Y as Q,E as Le,D as Ee,G as Me,a3 as Te,ah as Ve,bj as $e,H as Fe,L as Re,Q as Ie,aS as Ne,aT as ze,aU as Ue,a5 as Ae,ab as Be,a6 as je,a7 as Ye,M as He}from"./index-9f163f98.js";/* empty css                   */import{_ as Ge}from"./index.vue_vue_type_script_setup_true_lang-944210a3.js";/* empty css                      *//* empty css                 *//* empty css               *//* empty css                  *//* empty css                  *//* empty css                     *//* empty css                  *//* empty css                 *//* empty css                    */import"./el-tooltip-4ed993c7.js";/* empty css                        *//* empty css                  *//* empty css                         *//* empty css                *//* empty css                *//* empty css                       */import"./el-form-item-4ed993c7.js";import{_ as Je}from"./member_head-d9fd7b2c.js";import{a as Oe,S as Qe,g as Xe,p as qe,T as Ke}from"./member-6dbdeb9b.js";import{_ as We}from"./add-member.vue_vue_type_script_setup_true_lang-192a5248.js";import{_ as Ze}from"./detail-member.vue_vue_type_script_setup_true_lang-aa4b65e6.js";import{_ as el}from"./edit-member.vue_vue_type_script_setup_true_lang-1061a7b7.js";/* empty css                   *//* empty css                  *//* empty css                   */import"./sys-135535fa.js";/* empty css                  *//* empty css                     */import"./member-point-edit.vue_vue_type_script_setup_true_lang-db8cbb0b.js";/* empty css                        *//* empty css                       *//* empty css                 */import"./member-balance-edit.vue_vue_type_script_setup_true_lang-b992b216.js";import"./index-b01212c8.js";/* empty css                        */import"./index.vue_vue_type_style_index_0_lang-eb3f7737.js";import"./attachment-d1610ab5.js";import"./index.vue_vue_type_script_setup_true_lang-761ba1b4.js";/* empty css                 *//* empty css               *//* empty css                  *//* empty css                    */import"./index.vue_vue_type_script_setup_true_lang-e32ef5b5.js";/* empty css                   */import"./index.vue_vue_type_script_setup_true_lang-b29ac1a4.js";import"./sortable.esm-be94e56d.js";const ll={class:"main-container"},al={class:"flex justify-between items-center"},tl={class:"text-page-title"},ol={class:"mt-[10px]"},rl={class:"mb-[10px] flex items-center"},nl={class:"el-dropdown-link"},sl={class:"text-center inline-block"},il={class:"flex items-center"},ml={class:"mr-[10px] rounded-full w-[50px] h-[50px] flex items-center justify-center"},ul=["src"],cl={key:1,class:"max-w-[50px] max-h-[50px]",src:Je,alt:""},dl={class:"flex flex-col"},pl={class:"flex flex-col items-center"},_l={class:"flex items-center"},bl={class:"mt-[16px] flex justify-end"},ba=ke({__name:"member",setup(vl){const X=xe().meta.title,r=Ce({page:1,limit:10,total:0,loading:!0,data:[],searchParam:{keyword:"",register_type:"",member_label:"",register_channel:"",create_time:[],member_level:""}}),z=m(),U=m([]);(async()=>{U.value=await(await Qe({})).data})();const A=m([]);(async()=>{A.value=await(await Xe()).data})();const B=m([]);Oe().then(({data:s})=>{B.value=s});const q=s=>{s&&(s.resetFields(),x.value=!0,y())},x=m(!1),y=(s=1)=>{r.loading=!0,r.page=s,qe({page:r.page,limit:r.limit,...r.searchParam}).then(o=>{r.loading=!1,r.data=o.data.data,r.total=o.data.total,x.value&&(b.value=!1,p.value=[],w.value=null,g.value=[]),b.value&&!x.value&&(S.value=!0,N(()=>{r.data.forEach(i=>{var P,d;p.value.includes(i.member_id)?(d=C.value)==null||d.toggleRowSelection(i,!1):(P=C.value)==null||P.toggleRowSelection(i,!0)}),S.value=!1})),x.value=!1}).catch(()=>{x.value=!1,r.loading=!1})};y();const p=m([]),b=m(!1),w=m(null),K=()=>{S.value=!0,w.value==="page"?(b.value=!1,w.value=null,p.value=[],g.value=[],C.value.clearSelection()):(b.value=!1,w.value="page",p.value=[],g.value=[],r.data.forEach(s=>{C.value.toggleRowSelection(s,!0)}),g.value=[...r.data]),N(()=>{S.value=!1})},W=()=>{S.value=!0,w.value==="all"?(b.value=!1,w.value=null,p.value=[],g.value=[],C.value.clearSelection()):(p.value=[],g.value=[],b.value=!0,w.value="all",r.data.forEach(s=>{C.value.toggleRowSelection(s,!0)})),N(()=>{S.value=!1})},Z=J(()=>b.value?r.data.filter(s=>!p.value.includes(s.member_id)):g.value),C=m(),g=m([]),S=m(!1),ee=s=>{if(!S.value)if(b.value){const o=r.data.map(d=>d.member_id),i=s.map(d=>d.member_id),P=o.filter(d=>!i.includes(d));p.value=Array.from(new Set([...p.value,...P])),p.value=p.value.filter(d=>!i.includes(d))}else g.value=s},le=J(()=>b.value?r.total-p.value.length:g.value.length),j=()=>b.value?{is_all:1,ids:p.value,where:{...r.searchParam}}:{is_all:0,ids:g.value.map(s=>s.member_id),where:{...r.searchParam}},ae=()=>{if(!b.value&&g.value.length===0||b.value&&p.value.length===r.total){Q({type:"warning",message:`${a("batchEmptySelectedTips")}`});return}const o=j(),i=m({method:"batchSet",type:"member_label",title:a("批量设置会员标签"),data:o});D.value.batchSetDialogType(i.value),D.value.showDialog=!0},te=()=>{if(!b.value&&g.value.length===0||b.value&&p.value.length===r.total){Q({type:"warning",message:`${a("batchEmptySelectedTips")}`});return}const o=j(),i=m({method:"batchSet",type:"member_level",title:a("批量设置会员等级"),data:o});D.value.batchSetDialogType(i.value),D.value.showDialog=!0},oe=()=>{x.value=!0,y()},V=m(null),D=m(null),$=m(null);function re(s){const o=m({type:"member_label",id:s.member_id,title:a("setLabel"),data:s});D.value.setDialogType(o.value),D.value.showDialog=!0}const ne=()=>{V.value.setFormData(),V.value.showDialog=!0},se=s=>{let o={id:s.member_id};$.value.setFormData(o),$.value.showDialog=!0},ie=m(null),F=m(!1),me=s=>{F.value=s},ue=()=>{F.value=!0},Y=(s,o)=>{Ke({status:o,member_ids:[s.member_id]}).then(i=>{i.code>=0&&(x.value=!0,y())})};return(s,o)=>{const i=Le,P=Ee,d=Me,L=Te,R=Ve,ce=$e,de=Fe,H=Re,pe=Se("arrow-down"),_e=Ie,G=Ne,be=ze,ve=Ue,f=Ae,I=Be,fe=je,ge=Ye,he=Ge,we=He;return v(),k("div",ll,[e(H,{class:"box-card !border-none",shadow:"never"},{default:n(()=>[_("div",al,[_("span",tl,u(t(X)),1),e(i,{type:"primary",onClick:ne},{default:n(()=>[c(u(t(a)("addMember")),1)]),_:1})]),e(H,{class:"box-card !border-none my-[20px] table-search-wrap",shadow:"never"},{default:n(()=>[e(de,{inline:!0,model:r.searchParam,ref_key:"searchFormRef",ref:z},{default:n(()=>[e(d,{label:t(a)("memberInfo"),prop:"keyword"},{default:n(()=>[e(P,{modelValue:r.searchParam.keyword,"onUpdate:modelValue":o[0]||(o[0]=l=>r.searchParam.keyword=l),modelModifiers:{trim:!0},class:"!w-[200px]",placeholder:t(a)("memberInfoPlaceholder")},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),e(d,{label:t(a)("registerChannel"),prop:"register_channel"},{default:n(()=>[e(R,{modelValue:r.searchParam.register_channel,"onUpdate:modelValue":o[1]||(o[1]=l=>r.searchParam.register_channel=l),clearable:"",placeholder:t(a)("channelPlaceholder"),class:"input-width"},{default:n(()=>[e(L,{label:t(a)("selectPlaceholder"),value:""},null,8,["label"]),(v(!0),k(M,null,T(U.value,(l,h)=>(v(),E(L,{label:l,value:h,key:h},null,8,["label","value"]))),128))]),_:1},8,["modelValue","placeholder"])]),_:1},8,["label"]),e(d,{label:t(a)("memberLabel"),prop:"member_label"},{default:n(()=>[e(R,{modelValue:r.searchParam.member_label,"onUpdate:modelValue":o[2]||(o[2]=l=>r.searchParam.member_label=l),"collapse-tags":"",clearable:"",placeholder:t(a)("memberLabelPlaceholder"),class:"input-width"},{default:n(()=>[e(L,{label:t(a)("selectPlaceholder"),value:""},null,8,["label"]),(v(!0),k(M,null,T(A.value,(l,h)=>(v(),E(L,{label:l.label_name,value:l.label_id,key:h},null,8,["label","value"]))),128))]),_:1},8,["modelValue","placeholder"])]),_:1},8,["label"]),e(d,{label:t(a)("memberLevel"),prop:"member_level"},{default:n(()=>[e(R,{modelValue:r.searchParam.member_level,"onUpdate:modelValue":o[3]||(o[3]=l=>r.searchParam.member_level=l),"collapse-tags":"",clearable:"",placeholder:t(a)("memberLevelPlaceholder"),class:"input-width"},{default:n(()=>[e(L,{label:t(a)("selectPlaceholder"),value:""},null,8,["label"]),(v(!0),k(M,null,T(B.value,(l,h)=>(v(),E(L,{label:l.level_name,value:l.level_id,key:h},null,8,["label","value"]))),128))]),_:1},8,["modelValue","placeholder"])]),_:1},8,["label"]),e(d,{label:t(a)("createTime"),prop:"create_time"},{default:n(()=>[e(ce,{modelValue:r.searchParam.create_time,"onUpdate:modelValue":o[4]||(o[4]=l=>r.searchParam.create_time=l),type:"datetimerange","value-format":"YYYY-MM-DD HH:mm:ss","start-placeholder":t(a)("startDate"),"end-placeholder":t(a)("endDate")},null,8,["modelValue","start-placeholder","end-placeholder"])]),_:1},8,["label"]),e(d,null,{default:n(()=>[e(i,{type:"primary",onClick:o[5]||(o[5]=l=>y())},{default:n(()=>[c(u(t(a)("search")),1)]),_:1}),e(i,{onClick:o[6]||(o[6]=l=>q(z.value))},{default:n(()=>[c(u(t(a)("reset")),1)]),_:1}),e(i,{type:"primary",onClick:ue},{default:n(()=>[c(u(t(a)("export")),1)]),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),_("div",ol,[_("div",rl,[e(ve,{class:"mr-[20px] !text-primary w-[125px]"},{dropdown:n(()=>[e(be,null,{default:n(()=>[e(G,{class:O(["select-wrap",{active:w.value==="all"}]),onClick:W},{default:n(()=>[c("全选所有页")]),_:1},8,["class"]),e(G,{class:O(["select-wrap",{active:w.value==="page"}]),onClick:K},{default:n(()=>[c("全选当前页")]),_:1},8,["class"])]),_:1})]),default:n(()=>[_("span",nl,[_("span",null,u(w.value==="all"?t(a)("全选所有页"):t(a)("全选当前页")),1),c("("),_("span",sl,u(t(le)),1),c(") "),e(_e,null,{default:n(()=>[e(pe)]),_:1})])]),_:1}),e(i,{onClick:ae,size:"small"},{default:n(()=>[c(u(t(a)("标签")),1)]),_:1}),e(i,{onClick:te,size:"small"},{default:n(()=>[c(u(t(a)("等级")),1)]),_:1})]),De((v(),E(fe,{data:r.data,size:"large",ref_key:"memberListTableRef",ref:C,"row-key":l=>l.member_id,"default-selection":t(Z),onSelectionChange:ee},{empty:n(()=>[_("span",null,u(r.loading?"":t(a)("emptyData")),1)]),default:n(()=>[e(f,{type:"selection",width:"55"}),e(f,{prop:"member_no",label:t(a)("memberNo"),"min-width":"120"},null,8,["label"]),e(f,{prop:"nickname","show-overflow-tooltip":!0,label:t(a)("memberInfo"),"min-width":"170"},{default:n(({row:l})=>[_("div",il,[_("div",ml,[l.headimg?(v(),k("img",{key:0,class:"max-w-[50px] max-h-[50px]",src:t(Pe)(l.headimg),alt:""},null,8,ul)):(v(),k("img",cl))]),_("div",dl,[_("span",null,u(l.nickname||""),1)])])]),_:1},8,["label"]),e(f,{prop:"member_level_name",label:t(a)("memberLevel"),"min-width":"130","show-overflow-tooltip":!0},null,8,["label"]),e(f,{prop:"mobile",label:t(a)("mobile"),"min-width":"120"},null,8,["label"]),e(f,{prop:"point",label:t(a)("point"),"min-width":"80",align:"right"},{default:n(({row:l})=>[c(u(Number.parseInt(l.point)),1)]),_:1},8,["label"]),e(f,{prop:"balance",label:t(a)("balance"),"min-width":"130",align:"right"},null,8,["label"]),e(f,{prop:"member_label",label:t(a)("memberLabelTag"),"min-width":"120",align:"center"},{default:n(({row:l})=>[_("div",pl,[(v(!0),k(M,null,T(l.member_label_array,(h,ye)=>(v(),k("div",{class:"my-[3px]",key:ye},[e(I,{type:"info"},{default:n(()=>[c(u(h.label_name),1)]),_:2},1024)]))),128))])]),_:1},8,["label"]),e(f,{prop:"register_channel_name",label:t(a)("registerChannel"),"min-width":"110",align:"center"},null,8,["label"]),e(f,{prop:"member_label",label:t(a)("status"),"min-width":"120",align:"center"},{default:n(({row:l})=>[l.status==1?(v(),E(I,{key:0,type:"success",onClick:h=>Y(l,0),class:"cursor-pointer"},{default:n(()=>[c(u(t(a)("normal")),1)]),_:2},1032,["onClick"])):(v(),E(I,{key:1,type:"error",onClick:h=>Y(l,1),class:"cursor-pointer"},{default:n(()=>[c(u(t(a)("lock")),1)]),_:2},1032,["onClick"]))]),_:1},8,["label"]),e(f,{label:t(a)("createTime"),"min-width":"150",align:"center"},{default:n(({row:l})=>[c(u(l.create_time||""),1)]),_:1},8,["label"]),e(f,{label:t(a)("lastVisitTime"),"min-width":"150",align:"center"},{default:n(({row:l})=>[c(u(l.last_visit_time||""),1)]),_:1},8,["label"]),e(f,{label:t(a)("operation"),align:"right",fixed:"right",width:"100"},{default:n(({row:l})=>[_("div",_l,[e(i,{type:"primary",link:"",onClick:h=>se(l)},{default:n(()=>[c(u(t(a)("detail")),1)]),_:2},1032,["onClick"]),e(i,{type:"primary",link:"",onClick:h=>re(l)},{default:n(()=>[c(u(t(a)("setLabel")),1)]),_:2},1032,["onClick"])])]),_:1},8,["label"])]),_:1},8,["data","row-key","default-selection"])),[[we,r.loading]]),_("div",bl,[e(ge,{"current-page":r.page,"onUpdate:current-page":o[7]||(o[7]=l=>r.page=l),"page-size":r.limit,"onUpdate:page-size":o[8]||(o[8]=l=>r.limit=l),layout:"total, sizes, prev, pager, next, jumper",total:r.total,onSizeChange:o[9]||(o[9]=l=>y()),onCurrentChange:y},null,8,["current-page","page-size","total"])])]),e(We,{ref_key:"addMemberDialog",ref:V,onComplete:o[10]||(o[10]=l=>y())},null,512),e(el,{ref_key:"editMemberDialog",ref:D,onComplete:o[11]||(o[11]=l=>oe())},null,512),e(he,{ref_key:"exportSureDialog",ref:ie,show:F.value,type:"member",searchParam:r.searchParam,onClose:me},null,8,["show","searchParam"]),e(Ze,{ref_key:"detailMemberDialog",ref:$,onLoad:o[12]||(o[12]=l=>y())},null,512)]),_:1})])}}});export{ba as default};
