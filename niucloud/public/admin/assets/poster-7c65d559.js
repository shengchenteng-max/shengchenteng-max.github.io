import{b7 as W,O as C,Y as T,k as p,a4 as w,z as H}from"./index-9f163f98.js";const Y=W("poster",{state:()=>({contentBoxWidth:720,contentBoxHeight:1280,id:0,name:"",type:"",typeName:"",channel:"",status:1,isDefault:0,addon:"",currentIndex:-99,currentComponent:"edit-page",predefineColors:["#F4391c","#ff4500","#ff8c00","#FFD009","#ffd700","#19C650","#90ee90","#00ced1","#1e90ff","#c71585","#FF407E","#CFAF70","#A253FF","rgba(255, 69, 0, 0.68)","rgb(255, 120, 0)","hsl(181, 100%, 37%)","hsla(209, 100%, 56%, 0.73)","#c7158577"],components:[],global:{width:720,height:1280,bgType:"url",bgColor:"#ffffff",bgUrl:""},template:{width:200,height:200,minWidth:60,minHeight:60,x:0,y:0,angle:0,zIndex:0},templateType:{text:{height:60,minWidth:120,minHeight:44,fontFamily:"static/font/PingFang-Medium.ttf",fontSize:40,weight:!1,lineHeight:10,fontColor:"#303133"},image:{shape:"normal"},qrcode:{},draw:{draw_type:"Polygon",points:[[0,1210],[720,1210],[720,1280],[0,1280]],bgColor:"#eeeeee"}},value:[]}),getters:{editComponent:e=>e.currentIndex==-99?e.global:e.value[e.currentIndex]},actions:{init(){this.global={width:720,height:1280,bgType:"url",bgColor:"#ffffff",bgUrl:""},this.value=[]},addComponent(e,l){let h=C(l);h.id=this.generateRandom(),h.componentName=e,h.componentTitle=h.title,delete h.title,delete h.icon;let r=C(this.template);Object.assign(h,r);let o=C(this.templateType);if(Object.assign(h,o[h.type]),h.template&&(Object.assign(h,h.template),delete h.template),!this.checkComponentIsAdd(h)){T({type:"warning",message:`${h.componentTitle}${p("componentCanOnlyAdd")}${h.uses}${p("piece")}`});return}h.zIndex=this.value.length+1,this.value.push(h),this.currentIndex=this.value.length-1,this.currentComponent="edit-"+h.path},generateRandom(e=5){return Number(Math.random().toString().substr(3,e)+Date.now()).toString(36)},changeCurrentIndex(e,l=null){this.currentIndex=e,this.currentIndex==-99?this.currentComponent="edit-page":l&&(this.currentComponent="edit-"+l.path)},delComponent(){this.currentIndex!=-99&&w.confirm(p("delComponentTips"),p("warning"),{confirmButtonText:p("confirm"),cancelButtonText:p("cancel"),type:"warning",autofocus:!1}).then(()=>{this.value.splice(this.currentIndex,1),this.value.length===0&&(this.currentIndex=-99),this.currentIndex===this.value.length&&this.currentIndex--;let e=C(this.value[this.currentIndex]);this.changeCurrentIndex(this.currentIndex,e)}).catch(()=>{})},moveUpComponent(){this.currentIndex<-1||(this.value[this.currentIndex].zIndex++,this.value[this.currentIndex].zIndex>=this.value.length&&(this.value[this.currentIndex].zIndex=this.value.length))},moveDownComponent(){this.currentIndex<-1||(this.value[this.currentIndex].zIndex--,this.value[this.currentIndex].zIndex<0&&(this.value[this.currentIndex].zIndex=0))},copyComponent(){if(this.currentIndex<0)return;let e=C(this.value[this.currentIndex]);if(e.id=this.generateRandom(),e.x=0,e.y=0,!this.checkComponentIsAdd(e)){T({type:"warning",message:`${p("notCopy")}ï¼Œ${e.componentTitle}${p("componentCanOnlyAdd")}${e.uses}${p("piece")}`});return}const l=this.currentIndex+1;this.value.splice(l,0,e),this.changeCurrentIndex(l,e)},checkComponentIsAdd(e){if(e.uses===0)return!0;let l=0;for(let h in this.value)this.value[h].componentName===e.componentName&&l++;return!(l>=e.uses)},resetComponent(){this.currentIndex<0||w.confirm(p("resetComponentTips"),p("warning"),{confirmButtonText:p("confirm"),cancelButtonText:p("cancel"),type:"warning",autofocus:!1}).then(()=>{for(let e=0;e<this.components.length;e++)if(this.components[e].componentName==this.editComponent.componentName){Object.assign(this.editComponent,this.components[e]);let l=C(this.templateType);Object.assign(this.editComponent,l[this.editComponent.type]),this.editComponent.angle=0;break}}).catch(()=>{})},verify(){if(this.name==="")return T({message:p("posterNamePlaceholder"),type:"warning"}),this.changeCurrentIndex(-99),!1;if(this.value.length==0)return T({message:p("diyPosterValueEmptyTips"),type:"warning"}),this.changeCurrentIndex(-99),!1;for(let e=0;e<this.value.length;e++)try{if(this.value[e].verify){const l=this.value[e].verify(e);if(!l.code)return this.changeCurrentIndex(e,this.value[e]),T({message:l.message,type:"warning"}),!1}}catch(l){console.log("verify Error:",l,e,this.value[e])}return!0},mouseDown(e,l,h){const r=document.getElementById(l),o=e.clientX*2-r.offsetLeft,b=e.clientY*2-r.offsetTop;document.onmousemove=y=>{let I=y.clientX*2,u=y.clientY*2;this.contentBoxWidth==r.offsetWidth?r.style.left=0:r.style.left=I-o+"px",r.style.top=u-b+"px",I-o<0&&(r.style.left=0),I-o>this.contentBoxWidth-r.offsetWidth&&(r.style.left=this.contentBoxWidth-r.offsetWidth+"px"),u-b<0&&(r.style.top=0),u-b>this.contentBoxHeight-r.offsetHeight&&(r.style.top=this.contentBoxHeight-r.offsetHeight+"px"),this.value[h].x=r.offsetLeft,this.value[h].y=r.offsetTop},document.onmouseup=y=>{document.onmousemove=null}},resizeMouseDown(e,l,h){const r=e;r.stopPropagation();const o=document.getElementById(l.id),b=e.target.className,y=o.offsetWidth,I=o.offsetHeight,u=r.clientX,v=r.clientY,d=o.offsetLeft,c=o.offsetTop;let i=100,s=100;l.type=="text"?(i=60,s=22):l.type=="image"||l.type=="qrcode"?(i=30,s=30):l.type=="draw"&&(i=20,s=20),document.onmousemove=B=>{const a=B;if(b=="box1"){let t=y-(a.clientX-u);const m=this.contentBoxWidth;let n=I-(a.clientY-v);const x=this.contentBoxHeight-c;let f=d+(a.clientX-u),g=c+(a.clientY-v);t<i&&(t=i),t>m&&(t=m),n<s&&(n=s),n>x&&(n=x),d==0&&c==0?t==i&&n==s?(f=i,g=s):t==i&&n>s?f=i:t>i&&n==s&&(g=s):d==0&&c>0?t==i&&n==s||t==i&&n>s?(f=i,g=o.offsetTop):t>i&&n==s&&(g=o.offsetTop):d>0&&c==0?t==i&&n==s?(f=o.offsetLeft,g=o.offsetTop):t==i&&n>s?(f=o.offsetLeft,g=0):t>i&&n==s&&(g=o.offsetTop):d>0&&c>0&&(t==i&&n==s||t==i&&n>s?(f=o.offsetLeft,g=o.offsetTop):t>i&&n==s&&(g=o.offsetTop)),f<0&&(f=0,t=y-(a.clientX-u)+(d+(a.clientX-u))),g<0&&(g=0,n=c+(a.clientY-v)+(I-(a.clientY-v))),o.children[0].style.width=t+"px",(l.type=="text"||l.type=="draw")&&(o.children[0].style.height=n+"px"),o.style.left=f+"px",o.style.top=g+"px"}else if(b=="box2"){let t=y+(a.clientX-u);const m=this.contentBoxWidth-d;let n=I-(a.clientY-v);const x=this.contentBoxHeight-c;let f=c+(a.clientY-v);t<i&&(t=i),t>m&&(t=m),n<s&&(n=s),n>x&&(n=x),d==0&&c==0?t==i&&n==s?f=s:t==i&&n>s||t>i&&n==s&&(f=s):d==0&&c>0?(t==i&&n==s||t==i&&n>s||t>i&&n==s)&&(f=o.offsetTop):d>0&&c==0?t==i&&n==s?f=o.offsetTop:t==i&&n>s?f=0:t>i&&n==s&&(f=o.offsetTop):d>0&&c>0&&(t==i&&n==s||t==i&&n>s||t>i&&n==s)&&(f=o.offsetTop),f<0&&(f=0,n=c+(a.clientY-v)+(I-(a.clientY-v))),o.children[0].style.width=t+"px",(l.type=="text"||l.type=="draw")&&(o.children[0].style.height=n+"px"),o.style.top=f+"px"}else if(b=="box3"){let t=y-(a.clientX-u);const m=this.contentBoxWidth;let n=I+(a.clientY-v);const x=this.contentBoxHeight-c;let f=d+(a.clientX-u);t<i&&(t=i),t>m&&(t=m),n<s&&(n=s),n>x&&(n=x),d==0&&c==0||d==0&&c>0?(t==i&&n==s||t==i&&n>s)&&(f=i):d>0&&c==0?(t==i&&n==s||t==i&&n>s)&&(f=o.offsetLeft):d>0&&c>0&&(t==i&&n==s||t==i&&n>s)&&(f=o.offsetLeft),f<0&&(f=0,t=y-(a.clientX-u)+(d+(a.clientX-u))),o.children[0].style.width=t+"px",(l.type=="text"||l.type=="draw")&&(o.children[0].style.height=n+"px"),o.style.left=f+"px"}else if(b=="box4"){let t=y+(a.clientX-u);const m=this.contentBoxWidth-d;let n=I+(a.clientY-v);const x=this.contentBoxHeight-c;t<i&&(t=i),t>m&&(t=m),n<s&&(n=s),n>x&&(n=x),o.children[0].style.width=t+"px",(l.type=="text"||l.type=="draw")&&(o.children[0].style.height=n+"px")}this.value[h].x=o.offsetLeft,this.value[h].y=o.offsetTop,this.value[h].width=parseInt(o.children[0].style.width.replace("px",""))},document.onmouseup=()=>{document.onmousemove=null,document.onmouseup=null}},getGlobalStyle(){let e="";return this.global.bgType=="color"?e+=`background-color:${this.global.bgColor};`:this.global.bgType=="url"&&this.global.bgUrl&&(e+=`background-image:url("${H(this.global.bgUrl)}")`),e},getMaxX(){const e=document.getElementById(this.editComponent.id);let l=this.contentBoxWidth;return e&&(l-=e.offsetWidth),l},getMaxY(){const e=document.getElementById(this.editComponent.id);let l=this.contentBoxHeight;return e&&(l-=e.offsetHeight),l},getMaxWidth(){let e=this.contentBoxWidth;return e-=this.editComponent.x,e}}}),L=Y;export{L as u};
