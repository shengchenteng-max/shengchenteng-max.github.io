import{d as ie,v as de,l as j,r as b,f as ue,X as me,k as t,h as _,c as C,e as l,w as o,a as c,t as u,u as s,i as f,F as E,T,m as v,J as I,B as D,a4 as F,Y as pe,E as ce,aE as _e,a3 as fe,ah as ye,G as ve,H as ge,L as ke,a5 as we,aS as be,aT as he,aU as xe,a6 as Ce,a7 as Ve,D as Ee,af as Te,ag as De,S as Be,M as Ue}from"./index-9f163f98.js";/* empty css                   *//* empty css                  *//* empty css                   *//* empty css                       *//* empty css                 *//* empty css                 *//* empty css                      *//* empty css               *//* empty css                  *//* empty css                  *//* empty css                     *//* empty css                  *//* empty css                 *//* empty css                    */import"./el-tooltip-4ed993c7.js";/* empty css                  *//* empty css                         *//* empty css                        *//* empty css                *//* empty css                */import"./el-form-item-4ed993c7.js";/* empty css                 */import{a7 as Fe,a8 as Le,a9 as Pe,Q as $e,aa as Re,ab as Me,ac as ze,ad as Oe,ae as Se}from"./sys-135535fa.js";import{_ as Ne}from"./cron-info.vue_vue_type_script_setup_true_lang-4b7d958c.js";/* empty css                   */const je={class:"main-container"},Ie={class:"flex justify-between items-center mb-[20px]"},qe={class:"text-page-title"},Ge={class:"flex items-center"},Ae={class:"mt-2"},He={class:"flex justify-between"},Je={class:"mt-[20px]"},Qe={class:"flex items-center"},We={class:"el-dropdown-link text-primary"},Xe={class:"mt-[16px] flex justify-end"},Ye={class:"flex"},Ke={class:"input-width flex items-center text-sm"},Ze={class:"dialog-footer"},Ut=ie({__name:"schedule",setup(et){const q=de().meta.title,i=j({page:1,limit:10,total:0,loading:!0,data:[],searchParam:{type:"",status:"all"}}),B=b([]),L=b([]),P=b([]),$=b(),G=r=>{r&&(r.resetFields(),k())};(async()=>{B.value=await(await Fe()).data,L.value=await(await Le()).data,P.value=await(await Pe()).data})();const k=(r=1)=>{i.loading=!0,i.page=r,$e({page:i.page,limit:i.limit,...i.searchParam}).then(a=>{i.loading=!1,i.data=a.data.data,i.total=a.data.total}).catch(()=>{i.loading=!1})};k();const A=ue(),h=b(!1),n=j({...{id:0,key:"",status:2,time:{type:"min",week:"",day:"",hour:"",min:""}}}),R=b(),H=()=>{n.id=0,n.key="",n.status=2,n.time.type="min",n.time.week="",n.time.day="",n.time.hour="",n.time.min="",h.value=!0},J=me(()=>({key:[{required:!0,message:t("titlePlaceholder"),trigger:"blur"}],timeDate:[{required:!0,validator:Q,trigger:"blur"}]})),Q=(r,a,m)=>{const p=n.time,d=w=>/^[1-9]\d*$/.test(w),y=()=>m(new Error(t("cronTimeTips")));switch(p.type){case"min":return d(p.min)?m():y();case"hour":return d(p.hour)&&d(p.min)?m():y();case"day":return d(p.day)&&d(p.hour)&&d(p.min)?m():y();case"week":return p.week!==""&&d(p.hour)&&d(p.min)?m():y();case"month":return d(p.day)&&d(p.hour)&&d(p.min)?m():y();default:return y()}},V=b(!1),W=async r=>{V.value||!r||await r.validate(async a=>{if(a){V.value=!0;const m=n;(n.id>0?Re:Me)(m).then(d=>{V.value=!1,h.value=!1,k()}).catch(()=>{V.value=!1})}})},X=r=>{n.id=r.id,n.key=r.key,n.status=r.status,n.time=r.time,h.value=!0},Y=r=>{F.confirm(t("cronDeleteTips"),t("warning"),{confirmButtonText:t("confirm"),cancelButtonText:t("cancel"),type:"warning"}).then(()=>{ze(r).then(()=>{k()}).catch(()=>{})})},K=r=>{F.confirm(t(`确认要立即执行一次"${r.name}"任务吗？`),t("warning"),{confirmButtonText:t("confirm"),cancelButtonText:t("cancel"),type:"warning"}).then(()=>{Oe({id:r.id}).then(a=>{}).catch(()=>{})})},Z=r=>{F.confirm(t("确认要重置计划任务吗？"),t("warning"),{confirmButtonText:t("confirm"),cancelButtonText:t("cancel"),type:"warning"}).then(()=>{Se().then(a=>{pe.success(a.msg)}).catch(()=>{})})},ee=b(null),te=r=>{A.push({path:"/tools/schedule_log",query:{id:r}})};return(r,a)=>{const m=ce,p=_e,d=fe,y=ye,w=ve,M=ge,z=ke,x=we,O=be,ae=he,le=xe,oe=Ce,ne=Ve,U=Ee,S=Te,se=De,re=Be,N=Ue;return _(),C("div",je,[l(z,{class:"box-card !border-none",shadow:"never"},{default:o(()=>[c("div",Ie,[c("span",qe,u(s(q)),1),c("div",null,[l(m,{type:"primary",onClick:H},{default:o(()=>[f(u(s(t)("addCron")),1)]),_:1}),l(m,{type:"primary",onClick:Z},{default:o(()=>[f(u(s(t)("重置计划任务")),1)]),_:1})])]),l(p,{type:"info"},{default:o(()=>[c("div",Ge,[c("div",null,[c("p",null,u(s(t)("cronTipsOne")),1),c("p",Ae,u(s(t)("cronTipsTwo")),1)])])]),_:1}),l(z,{class:"box-card !border-none mb-[10px] table-search-wrap",shadow:"never"},{default:o(()=>[c("div",He,[l(M,{inline:!0,model:i.searchParam,ref_key:"searchFormRef",ref:$},{default:o(()=>[l(w,{label:s(t)("title"),prop:"key"},{default:o(()=>[l(y,{modelValue:i.searchParam.key,"onUpdate:modelValue":a[0]||(a[0]=e=>i.searchParam.key=e),placeholder:"全部",filterable:"",remote:"",clearable:""},{default:o(()=>[l(d,{label:"全部",value:"all"}),(_(!0),C(E,null,T(B.value,e=>(_(),v(d,{key:e.key,label:e.name,value:e.key},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1},8,["label"]),l(w,{label:s(t)("status"),prop:"status"},{default:o(()=>[l(y,{modelValue:i.searchParam.status,"onUpdate:modelValue":a[1]||(a[1]=e=>i.searchParam.status=e),placeholder:"全部",clearable:""},{default:o(()=>[l(d,{label:"全部",value:"all"}),l(d,{label:"启用",value:"1"}),l(d,{label:"关闭",value:"0"})]),_:1},8,["modelValue"])]),_:1},8,["label"]),l(w,null,{default:o(()=>[l(m,{type:"primary",onClick:a[2]||(a[2]=e=>k())},{default:o(()=>[f(u(s(t)("search")),1)]),_:1}),l(m,{onClick:a[3]||(a[3]=e=>G($.value))},{default:o(()=>[f(u(s(t)("reset")),1)]),_:1})]),_:1})]),_:1},8,["model"])])]),_:1}),c("div",Je,[I((_(),v(oe,{data:i.data,size:"large"},{empty:o(()=>[c("span",null,u(i.loading?"":s(t)("emptyData")),1)]),default:o(()=>[l(x,{prop:"key",label:s(t)("key"),"min-width":"150"},null,8,["label"]),l(x,{prop:"name",label:s(t)("title"),"min-width":"150"},null,8,["label"]),l(x,{label:s(t)("crondType"),"min-width":"150"},{default:o(({row:e})=>[f(u(e.crontab_content),1)]),_:1},8,["label"]),l(x,{prop:"status_name",label:s(t)("openStatus"),"min-width":"100"},null,8,["label"]),l(x,{label:s(t)("operation"),align:"right",fixed:"right",width:"180"},{default:o(({row:e})=>[c("div",Qe,[l(m,{type:"primary",link:"",onClick:g=>X(e)},{default:o(()=>[f(u(s(t)("edit")),1)]),_:2},1032,["onClick"]),l(m,{type:"primary",link:"",onClick:g=>Y(e.id)},{default:o(()=>[f(u(s(t)("delete")),1)]),_:2},1032,["onClick"]),l(le,{class:"ml-[12px]"},{dropdown:o(()=>[l(ae,null,{default:o(()=>[l(O,{onClick:g=>K(e)},{default:o(()=>[f(u(s(t)("doOne")),1)]),_:2},1032,["onClick"]),l(O,{onClick:g=>te(e.id)},{default:o(()=>[f(u(s(t)("cronLog")),1)]),_:2},1032,["onClick"])]),_:2},1024)]),default:o(()=>[c("span",We,u(s(t)("more")),1)]),_:2},1024)])]),_:1},8,["label"])]),_:1},8,["data"])),[[N,i.loading]]),c("div",Xe,[l(ne,{"current-page":i.page,"onUpdate:current-page":a[4]||(a[4]=e=>i.page=e),"page-size":i.limit,"onUpdate:page-size":a[5]||(a[5]=e=>i.limit=e),layout:"total, sizes, prev, pager, next, jumper",total:i.total,onSizeChange:a[6]||(a[6]=e=>k()),onCurrentChange:k},null,8,["current-page","page-size","total"])])])]),_:1}),l(Ne,{ref_key:"cronDialog",ref:ee,onComplete:k},null,512),l(re,{modelValue:h.value,"onUpdate:modelValue":a[15]||(a[15]=e=>h.value=e),title:s(t)("editCron"),width:"750px","destroy-on-close":!0},{footer:o(()=>[c("span",Ze,[l(m,{type:"primary",onClick:a[14]||(a[14]=e=>W(R.value))},{default:o(()=>[f(u(s(t)("confirm")),1)]),_:1})])]),default:o(()=>[I((_(),v(M,{model:n,"label-width":"110px",ref_key:"formRef",ref:R,rules:s(J),class:"page-form"},{default:o(()=>[l(w,{label:s(t)("cronTemplate"),class:"items-center",prop:"key"},{default:o(()=>[l(y,{modelValue:n.key,"onUpdate:modelValue":a[7]||(a[7]=e=>n.key=e)},{default:o(()=>[(_(!0),C(E,null,T(B.value,e=>(_(),v(d,{key:e.key,label:e.name,value:e.key},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1},8,["label"]),l(w,{label:s(t)("cronTime"),prop:"timeDate"},{default:o(()=>[l(y,{modelValue:n.time.type,"onUpdate:modelValue":a[8]||(a[8]=e=>n.time.type=e),class:"w-[150px]"},{default:o(()=>[(_(!0),C(E,null,T(L.value,(e,g)=>(_(),v(d,{key:g,label:e,value:g},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),c("div",Ye,[n.time.type=="week"?(_(),v(y,{key:0,modelValue:n.time.week,"onUpdate:modelValue":a[9]||(a[9]=e=>n.time.week=e),class:"ml-2 w-[120px]"},{default:o(()=>[(_(!0),C(E,null,T(P.value,(e,g)=>(_(),v(d,{key:g,label:e,value:g},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])):D("",!0),["month","day"].indexOf(n.time.type)!=-1?(_(),v(U,{key:1,modelValue:n.time.day,"onUpdate:modelValue":a[10]||(a[10]=e=>n.time.day=e),modelModifiers:{trim:!0},class:"ml-2 w-[120px]"},{append:o(()=>[f(u(s(t)("day")),1)]),_:1},8,["modelValue"])):D("",!0),["month","day","hour","week"].indexOf(n.time.type)!=-1?(_(),v(U,{key:2,modelValue:n.time.hour,"onUpdate:modelValue":a[11]||(a[11]=e=>n.time.hour=e),modelModifiers:{trim:!0},class:"ml-2 w-[120px]"},{append:o(()=>[f(u(s(t)("hour")),1)]),_:1},8,["modelValue"])):D("",!0),["month","day","hour","week","min"].indexOf(n.time.type)!=-1?(_(),v(U,{key:3,modelValue:n.time.min,"onUpdate:modelValue":a[12]||(a[12]=e=>n.time.min=e),modelModifiers:{trim:!0},class:"ml-2 w-[120px]"},{append:o(()=>[f(u(s(t)("min")),1)]),_:1},8,["modelValue"])):D("",!0)])]),_:1},8,["label"]),l(w,{label:s(t)("isopen")},{default:o(()=>[c("div",Ke,[l(se,{modelValue:n.status,"onUpdate:modelValue":a[13]||(a[13]=e=>n.status=e)},{default:o(()=>[l(S,{label:1},{default:o(()=>[f(u(s(t)("yes")),1)]),_:1}),l(S,{label:2},{default:o(()=>[f(u(s(t)("no")),1)]),_:1})]),_:1},8,["modelValue"])])]),_:1},8,["label"])]),_:1},8,["model","rules"])),[[N,r.loading]])]),_:1},8,["modelValue","title"])])}}});export{Ut as default};
