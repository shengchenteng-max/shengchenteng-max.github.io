import{d as ee,v as te,f as ae,r as T,l as le,X as oe,k as c,h as s,c as v,e as u,w as d,u as b,ay as se,J as ne,m as x,a as _,t as h,F as U,T as F,i as B,B as V,aH as re,aI as ue,Y as z,az as de,L as pe,D as ie,G as me,af as ce,ag as ve,ap as _e,bk as fe,a3 as ye,ah as be,H as ke,E as ge,M as xe}from"./index-9f163f98.js";/* empty css                   *//* empty css                  *//* empty css                *//* empty css                 *//* empty css               *//* empty css                  *//* empty css                  *//* empty css                     *//* empty css                  *//* empty css                          *//* empty css                    *//* empty css                       *//* empty css                 */import"./el-form-item-4ed993c7.js";/* empty css                *//* empty css                       */import{b as he,i as Ve,j as we,k as Ee}from"./printer-1b60d41f.js";const Te={class:"main-container"},Ue={class:"flex"},Ce={class:"flex-1 mr-[20px] bg-[#fff]"},Ne={class:"panel-title !text-sm"},Pe={class:"panel-title !text-sm"},Fe={class:"panel-title !text-sm"},je={class:"flex"},Be={class:"leading-[30px] w-[50px] text-center text-[#707070] bg-[#d7d7d7] border-1 border-solid border-[#ededed]"},Oe={key:4,class:"flex mr-[30px]"},Se=_("div",{class:"leading-[30px] w-[50px] text-center text-[#707070] bg-[#d7d7d7] border-1 border-solid border-[#ededed]"},"字号",-1),ze={key:5,class:"flex mr-[30px]"},De=_("div",{class:"leading-[30px] w-[50px] text-center text-[#707070] bg-[#d7d7d7] border-1 border-solid border-[#ededed]"},"粗细",-1),Re={key:0,class:"text-[12px] text-[#b2b2b2] mt-[10px]"},Me={class:"panel-title !text-sm"},Le={class:"fixed-footer-wrap"},We={class:"fixed-footer"},ut=ee({__name:"template_edit",setup($e){const D=te(),H=ae(),J=D.meta.title,C=T(!1),N=T(!0),X={template_id:D.query.template_id||0,template_type:"",template_name:"",value:{}},e=le({...X}),R=T(),Y=oe(()=>({template_name:[{required:!0,message:c("templateNamePlaceholder"),trigger:"blur"}],template_type:[{required:!0,message:c("templateTypePlaceholder"),trigger:"blur"}]})),M=Object.assign({}),L=Object.assign({});L&&Object.assign(M,L);const W={};for(const[r,o]of Object.entries(M)){const n=r.split("/").pop().split(".")[0];W[n]=o.default}const $=T(""),f=T([]),w=T([]);(async()=>{await he({}).then(r=>{r.data&&r.data.length&&(f.value=r.data,q(f.value[0].key,Boolean(parseInt(e.template_id)))),e.template_id||(N.value=!1)}),e.template_id&&Ve(e.template_id).then(r=>{let o=r.data;o&&Object.keys(o).length?(Object.keys(e).forEach(l=>{if(l=="value")for(let n in e[l])Object.assign(e[l][n],o[l][n]);else e[l]=o[l]}),N.value=!1):(z({type:"warning",duration:1500,message:c("printTemplateEmpty")}),setTimeout(()=>{j(),N.value=!1},2e3))})})();const q=(r,o=!1)=>{for(let l=0;l<f.value.length;l++)if(f.value[l].key==r){e.template_type=f.value[l].key,$.value=f.value[l].path,w.value=f.value[l].template;break}for(let l in e.value)delete e.value[l];A()},A=()=>{for(let r=0;r<w.value.length;r++){let o=w.value[r];e.value[o.key]={};for(let l=0;l<o.list.length;l++){let n=o.list[l];e.value[o.key][n.key]={type:n.type,value:n.value,status:n.status,fontSize:n.fontSize,fontWeight:n.fontWeight}}}},K=async r=>{if(N.value||!r)return;if(f.value.length==0){z({type:"warning",message:c("printTypeEmpty")});return}let o=e.template_id?we:Ee;await r.validate(async l=>{if(l){let n=!1,E="";for(let y=0;y<w.value.length;y++){let m=w.value[y],k=!1;for(let g=0;g<m.list.length;g++){let i=m.list[g];if(e.value[m.key][i.key].status!=0){if(i.type=="input"){if(e.value[m.key][i.key].value==""){n=!0,E=`请输入${i.label}`,k=!0;break}}else if(i.type=="select"&&e.value[m.key][i.key].value==""){n=!0,E=`${i.label}未设置[${i.text}]`,k=!0;break}}}if(k)break}if(n){z({type:"warning",message:E});return}for(let y=0;y<w.value.length;y++){let m=w.value[y];for(let k=0;k<m.list.length;k++){let g=m.list[k];g.type=="checkbox"&&(e.value[m.key][g.key].value.length?e.value[m.key][g.key].status=1:e.value[m.key][g.key].status=0)}}if(C.value)return;C.value=!0,o(e).then(y=>{C.value=!1,e.template_id||j()}).catch(y=>{C.value=!1})}})},j=()=>{H.push("/printer/template/list")};return(r,o)=>{const l=de,n=pe,E=ie,O=me,y=ce,m=ve,k=_e,g=fe,i=ye,S=be,Q=ke,G=ge,Z=xe;return s(),v("div",Te,[u(n,{class:"card !border-none mb-[15px]",shadow:"never"},{default:d(()=>[u(l,{content:b(J),icon:b(se),onBack:j},null,8,["content","icon"])]),_:1}),ne((s(),x(Q,{class:"page-form",model:e,rules:b(Y),"label-width":"150px",ref_key:"formRef",ref:R},{default:d(()=>[_("div",Ue,[_("div",Ce,[u(n,{class:"box-card !border-none",shadow:"never"},{default:d(()=>[_("h3",Ne,h(b(c)("templateInfoLabel")),1),u(O,{label:b(c)("templateName"),prop:"template_name"},{default:d(()=>[u(E,{modelValue:e.template_name,"onUpdate:modelValue":o[0]||(o[0]=a=>e.template_name=a),modelModifiers:{trim:!0},clearable:"",placeholder:b(c)("templateNamePlaceholder"),class:"input-width",maxlength:"20"},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),f.value.length?(s(),x(O,{key:0,label:b(c)("templateType"),prop:"template_type"},{default:d(()=>[u(m,{modelValue:e.template_type,"onUpdate:modelValue":o[1]||(o[1]=a=>e.template_type=a)},{default:d(()=>[(s(!0),v(U,null,F(f.value,a=>(s(),x(y,{key:a.key,label:a.key,onChange:q},{default:d(()=>[B(h(a.title),1)]),_:2},1032,["label"]))),128))]),_:1},8,["modelValue"])]),_:1},8,["label"])):V("",!0)]),_:1}),f.value.length?(s(),x(n,{key:0,class:"box-card !border-none",shadow:"never"},{default:d(()=>[_("h3",Pe,h(b(c)("templateEditLabel")),1),(s(!0),v(U,null,F(w.value,a=>(s(),v("div",{key:a.key,class:"bg-[#f8f8f9] mb-[20px] py-[20px] px-[40px] text-[14px]"},[_("h4",Fe,h(a.title),1),(s(!0),v(U,null,F(a.list,(t,I)=>(s(),v("div",{key:t.key,class:"ml-[30px]",style:re({"margin-bottom":a.list.length==I+1?"0":"20px"})},[_("div",je,[t.label?(s(),x(k,{key:0,modelValue:e.value[a.key][t.key].status,"onUpdate:modelValue":p=>e.value[a.key][t.key].status=p,label:t.label,value:t.status,"true-value":1,"false-value":0,class:"w-[180px] mr-[10px]",disabled:t.disabled},null,8,["modelValue","onUpdate:modelValue","label","value","disabled"])):V("",!0),t.type=="input"?(s(),x(E,{key:1,modelValue:e.value[a.key][t.key].value,"onUpdate:modelValue":p=>e.value[a.key][t.key].value=p,modelModifiers:{trim:!0},clearable:"",placeholder:"请输入"+(t.placeholder?t.placeholder:t.label),class:"input-width mr-[30px]",maxlength:"32"},null,8,["modelValue","onUpdate:modelValue","placeholder"])):V("",!0),t.type=="checkbox"?(s(),x(g,{key:2,modelValue:e.value[a.key][t.key].value,"onUpdate:modelValue":p=>e.value[a.key][t.key].value=p,class:"mr-[30px]"},{default:d(()=>[(s(!0),v(U,null,F(t.list,(p,P)=>(s(),x(k,{label:P,key:P,disabled:t.disabled},{default:d(()=>[B(h(p),1)]),_:2},1032,["label","disabled"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue"])):V("",!0),t.type=="select"?(s(),v(U,{key:3},[_("div",Be,h(t.text),1),u(S,{modelValue:e.value[a.key][t.key].value,"onUpdate:modelValue":p=>e.value[a.key][t.key].value=p,class:"!w-[130px] mr-[30px]"},{default:d(()=>[(s(!0),v(U,null,F(t.list,(p,P)=>(s(),x(i,{key:P,label:p,value:P},null,8,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue"])],64)):V("",!0),t.fontSize?(s(),v("div",Oe,[Se,u(S,{modelValue:e.value[a.key][t.key].fontSize,"onUpdate:modelValue":p=>e.value[a.key][t.key].fontSize=p,class:"!w-[130px]"},{default:d(()=>[u(i,{label:"小",value:"normal"}),u(i,{label:"大",value:"big"})]),_:2},1032,["modelValue","onUpdate:modelValue"])])):V("",!0),t.fontWeight?(s(),v("div",ze,[De,u(S,{modelValue:e.value[a.key][t.key].fontWeight,"onUpdate:modelValue":p=>e.value[a.key][t.key].fontWeight=p,class:"!w-[130px]"},{default:d(()=>[u(i,{label:"正常",value:"normal"}),u(i,{label:"加粗",value:"bold"})]),_:2},1032,["modelValue","onUpdate:modelValue"])])):V("",!0)]),t.remark?(s(),v("div",Re,h(t.remark),1)):V("",!0)],4))),128))]))),128))]),_:1})):V("",!0)]),u(n,{class:"box-card !border-none w-[450px]",shadow:"never"},{default:d(()=>[_("h3",Me,h(b(c)("preview")),1),(s(),x(ue(W[$.value]),{value:e.value},null,8,["value"]))]),_:1})])]),_:1},8,["model","rules"])),[[Z,N.value]]),_("div",Le,[_("div",We,[u(G,{type:"primary",loading:C.value,onClick:o[2]||(o[2]=a=>K(R.value))},{default:d(()=>[B(h(b(c)("save")),1)]),_:1},8,["loading"]),u(G,{onClick:o[3]||(o[3]=a=>j())},{default:d(()=>[B(h(b(c)("cancel")),1)]),_:1})])])])}}});export{ut as default};
