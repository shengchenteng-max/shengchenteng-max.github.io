<template>
  <view class="red-packet-container" v-if="isVisible">
    <canvas
      class="red-packet-canvas"
      canvas-id="redPacketRain"
      id="redPacketRain"
    ></canvas>



    <!-- Á∫¢ÂåÖÂÖÉÁ¥†ÔºàÂõæÁâáÊ®°ÂºèÊàñÁªòÂà∂Ê®°ÂºèÔºâ -->
    <view
      v-for="packet in redPackets"
      :key="packet.id"
      class="red-packet-item"
      :style="{
        left: packet.x + 'px',
        top: packet.y + 'px',
        width: packet.width + 'px',
        height: packet.height + 'px',
        transform: `rotate(${packet.rotation}rad)`,
        opacity: packet.opacity
      }"
      @click="handlePacketClick(packet, $event)"
    >
      <!-- ÂõæÁâáÊ®°Âºè -->
      <image
        v-if="props.useImages && packet.image"
        :src="packet.image"
        class="red-packet-image"
        mode="aspectFit"
        @load="onRedPacketImageLoad"
        @error="onRedPacketImageError"
      />
      <!-- ÁªòÂà∂Ê®°Âºè -->
      <view
        v-else
        class="red-packet-drawn"
        :style="{
          width: '100%',
          height: '100%'
        }"
      >
        <view class="red-packet-body"></view>
        <view class="red-packet-text">Á¶è</view>
      </view>
    </view>

    <!-- È¢ÑÂä†ËΩΩÂõæÁâáÔºàÈöêËóèÔºâ -->
    <image
      v-for="(imagePath, index) in props.images"
      :key="'preload-' + index"
      :src="imagePath"
      class="preload-image"
      @load="onImageLoad"
      @error="onImageError"
    />

    <!-- ÈáëÈ¢ùÊèêÁ§∫ÂºπÁ™ó -->
    <view
      v-for="tip in amountTips"
      :key="tip.id"
      class="amount-tip"
      :style="{
        left: tip.x + 'px',
        top: tip.y + 'px',
        opacity: tip.opacity
      }"
    >
      <view class="tip-content">
        <text class="amount">+¬•{{ tip.amount }}</text>
        <text class="label">{{ tip.label }}</text>
      </view>
    </view>
  </view>
</template>

<script setup>
import { ref, getCurrentInstance, onUnmounted } from 'vue';

// ÂÆö‰πâprops
const props = defineProps({
  duration: {
    type: Number,
    default: 30000 // ÈªòËÆ§30Áßí
  },
  images: {
    type: Array,
    default: () => [
      // ÂèØ‰ª•ÊòØÁΩëÁªúÂõæÁâáÊàñÊú¨Âú∞ÂõæÁâáË∑ØÂæÑ
      // 'https://example.com/hongbao1.png',
      // '/static/images/hongbao.png',
      // Â¶ÇÊûú‰∏∫Á©∫Êï∞ÁªÑÔºåÂàô‰ΩøÁî®ÁªòÂà∂ÁöÑÁ∫¢ÂåÖ
    ]
  },
  // ÊòØÂê¶‰ΩøÁî®ÂõæÁâáÊ®°Âºè
  useImages: {
    type: Boolean,
    default: false // ÈªòËÆ§‰ΩøÁî®ÁªòÂà∂Ê®°Âºè
  },
  density: {
    type: Number,
    default: 3 // ÊØèÊ¨°ÁîüÊàêÁöÑÁ∫¢ÂåÖÊï∞Èáè
  },
  speed: {
    type: Number,
    default: 2 // ‰∏ãËêΩÈÄüÂ∫¶
  },
  // Á∫¢ÂåÖÂ§ßÂ∞èÈÖçÁΩÆ
  minSize: {
    type: Number,
    default: 60 // ÊúÄÂ∞èÁ∫¢ÂåÖÂ§ßÂ∞è
  },
  maxSize: {
    type: Number,
    default: 100 // ÊúÄÂ§ßÁ∫¢ÂåÖÂ§ßÂ∞è
  },
  // ÈáëÈ¢ùÈÖçÁΩÆ
  minAmount: {
    type: Number,
    default: 0.01 // ÊúÄÂ∞èÈáëÈ¢ù
  },
  maxAmount: {
    type: Number,
    default: 10.00 // ÊúÄÂ§ßÈáëÈ¢ù
  },
  // ÊòØÂê¶ÂêØÁî®ÁÇπÂáªÂäüËÉΩ
  clickable: {
    type: Boolean,
    default: true
  }
});

const app = getCurrentInstance();
let ctx = null;
let animationId = null;
let isRunning = false;
let canvasWidth = 375;
let canvasHeight = 667;
let autoStopTimer = null;
let createTimer = null;
let loadedImages = new Map(); // Â≠òÂÇ®Âä†ËΩΩÁöÑÂõæÁâá
let tipIdCounter = 0; // ÊèêÁ§∫IDËÆ°Êï∞Âô®

const isVisible = ref(false);
const amountTips = ref([]); // ÈáëÈ¢ùÊèêÁ§∫Êï∞ÁªÑ
const redPackets = ref([]); // Á∫¢ÂåÖÊï∞ÁªÑÔºàÂìçÂ∫îÂºèÔºâ

// Á∫¢ÂåÖÁ±ª
class RedPacket {
  constructor(x, y, image) {
    this.x = x;
    this.y = y;
    // ‰ΩøÁî®props‰∏≠ÁöÑÂ§ßÂ∞èËåÉÂõ¥
    this.width = props.minSize + Math.random() * (props.maxSize - props.minSize);
    this.height = this.width * 0.8; // ‰øùÊåÅÊØî‰æã
    this.speed = props.speed + Math.random() * 2; // ÈöèÊú∫ÈÄüÂ∫¶
    this.rotation = Math.random() * 0.2 - 0.1; // ËΩªÂæÆÊóãËΩ¨
    this.rotationSpeed = (Math.random() - 0.5) * 0.02;
    this.image = image;
    this.opacity = 0.9 + Math.random() * 0.1;
    // ÈöèÊú∫ÈáëÈ¢ù
    this.amount = (props.minAmount + Math.random() * (props.maxAmount - props.minAmount)).toFixed(2);
    this.clicked = false; // ÊòØÂê¶Â∑≤Ë¢´ÁÇπÂáª
    this.id = Date.now() + Math.random(); // ÂîØ‰∏ÄID
  }
  
  update() {
    this.y += this.speed;
    this.rotation += this.rotationSpeed;
    
    // ËΩªÂæÆÁöÑÂ∑¶Âè≥ÊëÜÂä®
    this.x += Math.sin(this.y * 0.01) * 0.5;
  }
  
  draw() {
    if (!ctx) return;

    ctx.save();
    ctx.globalAlpha = this.opacity;
    ctx.translate(this.x + this.width / 2, this.y + this.height / 2);
    ctx.rotate(this.rotation);

    // Ê†πÊçÆÊ®°ÂºèÈÄâÊã©ÁªòÂà∂ÊñπÂºè
    if (props.useImages && this.image) {
      console.log('üßß ‰ΩøÁî®ÂõæÁâáÊ®°ÂºèÁªòÂà∂Á∫¢ÂåÖ:', this.image);
      this.drawImage();
    } else {
      console.log('üßß ‰ΩøÁî®‰ª£Á†ÅÁªòÂà∂Á∫¢ÂåÖ');
      this.drawRedPacket();
    }

    ctx.restore();
  }

  // ÁªòÂà∂ÂõæÁâáÁ∫¢ÂåÖ
  drawImage() {
    const halfWidth = this.width / 2;
    const halfHeight = this.height / 2;

    try {
      if (this.image && typeof this.image === 'string') {
        console.log('üßß ÁªòÂà∂ÂõæÁâáÁ∫¢ÂåÖ:', this.image);

        // Âú®uni-app‰∏≠Ôºå‰ΩøÁî®ctx.drawImageÁªòÂà∂ÂõæÁâá
        // ÂèÇÊï∞ÔºöÂõæÁâáË∑ØÂæÑ, x, y, width, height
        ctx.drawImage(this.image, -halfWidth, -halfHeight, this.width, this.height);

        console.log('üßß ÂõæÁâáÁªòÂà∂ÂÆåÊàê');
      } else {
        console.log('üßß ÂõæÁâáÊó†ÊïàÔºå‰ΩøÁî®ÁªòÂà∂Ê®°Âºè');
        this.drawRedPacket();
      }
    } catch (error) {
      console.warn('üßß ÂõæÁâáÁªòÂà∂Â§±Ë¥•ÔºåÈôçÁ∫ßÂà∞ÁªòÂà∂Ê®°Âºè:', error);
      this.drawRedPacket();
    }
  }

  drawRedPacket() {
    const halfWidth = this.width / 2;
    const halfHeight = this.height / 2;

    // ÁªòÂà∂Á∫¢ÂåÖ‰∏ª‰ΩìÔºàÂúÜËßíÁü©ÂΩ¢Ôºâ
    ctx.setFillStyle('#ff4444');
    ctx.fillRect(-halfWidth, -halfHeight, this.width, this.height);

    // ÁªòÂà∂ÈáëËâ≤Ë£ÖÈ•∞ËæπÊ°Ü
    ctx.setStrokeStyle('#ffd700');
    ctx.setLineWidth(2);
    ctx.strokeRect(-halfWidth, -halfHeight, this.width, this.height);

    // ÁªòÂà∂‰∏≠Èó¥ÁöÑ"Á¶è"Â≠óÊàñË£ÖÈ•∞
    ctx.setFillStyle('#ffd700');
    try {
      ctx.setFontSize(this.width * 0.4);
      ctx.setTextAlign('center');
      ctx.fillText('Á¶è', 0, this.height * 0.1);
    } catch (error) {
      // Â¶ÇÊûúÊñáÊú¨ÁªòÂà∂Â§±Ë¥•ÔºåÁªòÂà∂‰∏Ä‰∏™ÂúÜÂΩ¢Ë£ÖÈ•∞
      ctx.beginPath();
      ctx.arc(0, 0, this.width * 0.15, 0, 2 * Math.PI);
      ctx.fill();
    }

    // ÁªòÂà∂È°∂ÈÉ®ÁöÑËù¥Ëù∂Áªì
    ctx.setFillStyle('#ffaa00');
    ctx.fillRect(-halfWidth * 0.6, -halfHeight, this.width * 0.6, this.height * 0.2);
  }
  
  isOffScreen() {
    return this.y > canvasHeight + this.height;
  }

  // Ê£ÄÊµãÁÇπÂáª
  isClicked(touchX, touchY) {
    if (this.clicked) return false;

    const centerX = this.x + this.width / 2;
    const centerY = this.y + this.height / 2;
    const distance = Math.sqrt(
      Math.pow(touchX - centerX, 2) + Math.pow(touchY - centerY, 2)
    );

    return distance <= Math.max(this.width, this.height) / 2;
  }

  // Ê†áËÆ∞‰∏∫Â∑≤ÁÇπÂáª
  markAsClicked() {
    this.clicked = true;
    // ÁÇπÂáªÂêéÂèò‰∏∫ÂçäÈÄèÊòé
    this.opacity = 0.3;
  }
}

// ÂõæÁâáÂä†ËΩΩÊàêÂäü‰∫ã‰ª∂
const onImageLoad = (event) => {
  console.log('üßß È¢ÑÂä†ËΩΩÂõæÁâáÊàêÂäü:', event.target.src);
};

// ÂõæÁâáÂä†ËΩΩÂ§±Ë¥•‰∫ã‰ª∂
const onImageError = (event) => {
  console.error('üßß È¢ÑÂä†ËΩΩÂõæÁâáÂ§±Ë¥•:', event.target.src);
};

// Á∫¢ÂåÖÂõæÁâáÂä†ËΩΩÊàêÂäü‰∫ã‰ª∂
const onRedPacketImageLoad = () => {
  // ÂõæÁâáÂä†ËΩΩÊàêÂäüÔºåÊó†ÈúÄÂ§ÑÁêÜ
};

// Á∫¢ÂåÖÂõæÁâáÂä†ËΩΩÂ§±Ë¥•‰∫ã‰ª∂
const onRedPacketImageError = () => {
  // ÂõæÁâáÂä†ËΩΩÂ§±Ë¥•ÔºåÂ∞Ü‰ΩøÁî®ÁªòÂà∂Ê®°Âºè
};

// Âä†ËΩΩÂõæÁâáÔºàÁÆÄÂåñÁâàÔºå‰æùËµñimageÊ†áÁ≠æÈ¢ÑÂä†ËΩΩÔºâ
const loadImages = async () => {
  if (!props.useImages || props.images.length === 0) {
    loadedImages.set('default', 'default');
    return Promise.resolve();
  }

  // Áõ¥Êé•Â∞ÜÂõæÁâáË∑ØÂæÑÊ∑ªÂä†Âà∞loadedImages‰∏≠
  // ÂÆûÈôÖÁöÑÈ¢ÑÂä†ËΩΩÁî±template‰∏≠ÁöÑimageÊ†áÁ≠æÂÆåÊàê
  for (const imagePath of props.images) {
    loadedImages.set(imagePath, imagePath);
  }

  return Promise.resolve();
};

// ÂàùÂßãÂåñCanvas
const initCanvas = () => {
  try {
    ctx = uni.createCanvasContext('redPacketRain', app.proxy);

    if (ctx) {
      // Ëé∑ÂèñÂ±èÂπïÂ∞∫ÂØ∏
      const systemInfo = uni.getSystemInfoSync();
      canvasWidth = systemInfo.windowWidth || 375;
      canvasHeight = systemInfo.windowHeight || 667;

      // ÂàùÂßãÂåñÈÄèÊòéËÉåÊôØ
      ctx.setFillStyle('rgba(0, 0, 0, 0)');
      ctx.fillRect(0, 0, canvasWidth, canvasHeight);
      ctx.draw();

      return true;
    } else {
      return false;
    }
  } catch (error) {
    return false;
  }
};

// ÂàõÂª∫Á∫¢ÂåÖ
const createRedPackets = () => {
  if (!isRunning) {
    return;
  }

  for (let i = 0; i < props.density; i++) {
    const x = Math.random() * (canvasWidth - 100);
    const y = -100 - Math.random() * 200; // ‰ªéÂ±èÂπï‰∏äÊñπÂºÄÂßã

    let image = null;

    if (props.useImages && loadedImages.size > 0) {
      // ÈöèÊú∫ÈÄâÊã©‰∏ÄÂº†ÂõæÁâá
      const allKeys = Array.from(loadedImages.keys());
      const imageKeys = allKeys.filter(key => key !== 'default');

      if (imageKeys.length > 0) {
        const randomImage = imageKeys[Math.floor(Math.random() * imageKeys.length)];
        image = loadedImages.get(randomImage);
      } else {
        // Â¶ÇÊûúÊ≤°ÊúâËøáÊª§Âá∫ÂõæÁâáÔºåÁõ¥Êé•‰ΩøÁî®Á¨¨‰∏Ä‰∏™
        if (allKeys.length > 0) {
          const firstKey = allKeys[0];
          image = loadedImages.get(firstKey);
        }
      }
    }

    const packet = new RedPacket(x, y, image);
    redPackets.value.push(packet);
  }

};

// Âä®ÁîªÂæ™ÁéØ
const animate = () => {
  if (!isRunning) return;

  try {
    // Êõ¥Êñ∞Á∫¢ÂåÖ‰ΩçÁΩÆÔºàHTMLÂÖÉÁ¥†‰ºöËá™Âä®ÈáçÊñ∞Ê∏≤ÊüìÔºâ
    redPackets.value = redPackets.value.filter(packet => {
      packet.update();
      return !packet.isOffScreen();
    });

    // ÁªßÁª≠Âä®Áîª
    if (isRunning) {
      setTimeout(animate, 16); // Á∫¶60fps
    }
  } catch (error) {
    if (isRunning) {
      setTimeout(animate, 50);
    }
  }
};

// ÂºÄÂßãÂä®Áîª
const startAnimation = () => {
  isRunning = true;
  animate();
};

// ÂÅúÊ≠¢Âä®Áîª
const stopAnimation = () => {
  isRunning = false;
  if (animationId) {
    clearTimeout(animationId);
    animationId = null;
  }
};

// ÂºÄÂßãÂàõÂª∫Á∫¢ÂåÖÁöÑÂÆöÊó∂Âô®
const startCreating = () => {
  if (createTimer) {
    clearInterval(createTimer);
  }
  
  // Á´ãÂç≥ÂàõÂª∫‰∏ÄÊâπÁ∫¢ÂåÖ
  createRedPackets();
  
  // ÊØèÈöî‰∏ÄÊÆµÊó∂Èó¥ÂàõÂª∫Êñ∞Á∫¢ÂåÖ
  createTimer = setInterval(() => {
    if (isRunning && createTimer) { // Á°Æ‰øùÂú®ÂÅúÊ≠¢ÂàõÂª∫Âêé‰∏çÂÜçÁîüÊàêÊñ∞Á∫¢ÂåÖ
      createRedPackets();
    }
  }, 1000); // ÊØèÁßíÂàõÂª∫Êñ∞Á∫¢ÂåÖ
};

// ÂÅúÊ≠¢ÂàõÂª∫Á∫¢ÂåÖ
const stopCreating = () => {
  if (createTimer) {
    clearInterval(createTimer);
    createTimer = null;
  }
};

// ÂêØÂä®Á∫¢ÂåÖÈõ®
const startRedPacketRain = async (customDuration) => {
  // ÊòæÁ§∫ÁªÑ‰ª∂
  isVisible.value = true;

  // Âä†ËΩΩÂõæÁâá
  await loadImages();

  // ÂàùÂßãÂåñCanvasÔºàÂèØÈÄâÔºå‰ªÖÁî®‰∫éËÉåÊôØÔºâ
  initCanvas();

  // ÂºÄÂßãÂä®ÁîªÂíåÂàõÂª∫Á∫¢ÂåÖ
  startAnimation();
  startCreating();

  // ËÆæÁΩÆËá™Âä®ÂÅúÊ≠¢ÂÆöÊó∂Âô®
  const duration = customDuration || props.duration;

  if (autoStopTimer) {
    clearTimeout(autoStopTimer);
  }

  autoStopTimer = setTimeout(() => {
    stopRedPacketRain();
  }, duration);
};

// ÂÅúÊ≠¢Á∫¢ÂåÖÈõ®
const stopRedPacketRain = () => {
  // ÂÅúÊ≠¢ÂàõÂª∫Êñ∞Á∫¢ÂåÖÔºå‰ΩÜÁªßÁª≠Âä®ÁîªËÆ©Áé∞ÊúâÁ∫¢ÂåÖËêΩÂÆå
  stopCreating();

  // Ê∏ÖÈô§Ëá™Âä®ÂÅúÊ≠¢ÂÆöÊó∂Âô®
  if (autoStopTimer) {
    clearTimeout(autoStopTimer);
    autoStopTimer = null;
  }

  // Á≠âÂæÖÁé∞ÊúâÁ∫¢ÂåÖÂÖ®ÈÉ®ËêΩ‰∏ãÂêéÂÜçÂÅúÊ≠¢Âä®ÁîªÂíåÈöêËóèÁªÑ‰ª∂
  const waitForPacketsToFall = () => {
    if (redPackets.value.length === 0) {
      // ÊâÄÊúâÁ∫¢ÂåÖÈÉΩËêΩ‰∏ã‰∫ÜÔºåÂÅúÊ≠¢Âä®Áîª
      stopAnimation();
      amountTips.value = [];

      // Âª∂ËøüÈöêËóèÁªÑ‰ª∂
      setTimeout(() => {
        isVisible.value = false;
      }, 1000);
    } else {
      // ËøòÊúâÁ∫¢ÂåÖÂú®È£òËêΩÔºåÁªßÁª≠Á≠âÂæÖ
      setTimeout(waitForPacketsToFall, 500);
    }
  };

  waitForPacketsToFall();
};



// Â§ÑÁêÜÁ∫¢ÂåÖÂõæÁâáÁÇπÂáª
const handlePacketClick = (packet, event) => {
  if (!props.clickable || packet.clicked) return;

  console.log('üßß ÁÇπÂáªÁ∫¢ÂåÖÂõæÁâáÔºåÈáëÈ¢ù:', packet.amount);

  // Ê†áËÆ∞Á∫¢ÂåÖ‰∏∫Â∑≤ÁÇπÂáª
  packet.markAsClicked();

  // Ëé∑ÂèñÁÇπÂáª‰ΩçÁΩÆ
  const touchX = event.currentTarget.offsetLeft + packet.width / 2;
  const touchY = event.currentTarget.offsetTop + packet.height / 2;

  // ÊòæÁ§∫ÈáëÈ¢ùÊèêÁ§∫
  showAmountTip(touchX, touchY, packet.amount);
};

// ÊòæÁ§∫ÈáëÈ¢ùÊèêÁ§∫
const showAmountTip = (x, y, amount) => {
  const tipId = ++tipIdCounter;
  const tip = {
    id: tipId,
    x: x - 50, // Â±Ö‰∏≠ÊòæÁ§∫
    y: y - 30,
    amount: amount,
    label: 'ÊÅ≠ÂñúËé∑Âæó',
    opacity: 1
  };

  amountTips.value.push(tip);

  // Âä®ÁîªÊïàÊûúÔºöÂêë‰∏äÁßªÂä®Âπ∂Ê∑°Âá∫
  let animationStep = 0;
  const animate = () => {
    animationStep++;
    const progress = animationStep / 60; // 60Â∏ßÂä®Áîª

    if (progress >= 1) {
      // Âä®ÁîªÁªìÊùüÔºåÁßªÈô§ÊèêÁ§∫
      const index = amountTips.value.findIndex(t => t.id === tipId);
      if (index !== -1) {
        amountTips.value.splice(index, 1);
      }
      return;
    }

    // Êõ¥Êñ∞ÊèêÁ§∫‰ΩçÁΩÆÂíåÈÄèÊòéÂ∫¶
    const tipIndex = amountTips.value.findIndex(t => t.id === tipId);
    if (tipIndex !== -1) {
      amountTips.value[tipIndex].y = y - 30 - progress * 50; // Âêë‰∏äÁßªÂä®50px
      amountTips.value[tipIndex].opacity = 1 - progress; // Ê∑°Âá∫
    }

    setTimeout(animate, 16); // Á∫¶60fps
  };

  animate();
};

// ÁªÑ‰ª∂Âç∏ËΩΩÊó∂Ê∏ÖÁêÜËµÑÊ∫ê
onUnmounted(() => {
  console.log('üßß Á∫¢ÂåÖÈõ®ÁªÑ‰ª∂Âç∏ËΩΩÔºåÊ∏ÖÁêÜËµÑÊ∫ê');
  stopRedPacketRain();
});

// Êö¥Èú≤ÊñπÊ≥ï
defineExpose({
  startRedPacketRain,
  stopRedPacketRain
});
</script>

<style lang="scss" scoped>
.red-packet-container {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  z-index: 998; /* ÊØîÁÉüËä±Á®ç‰ΩéÁöÑÂ±ÇÁ∫ß */
  pointer-events: none; /* ÂÆπÂô®Êú¨Ë∫´‰∏çÈòªÊå°ÁÇπÂáª‰∫ã‰ª∂ */

  .red-packet-canvas {
    width: 100%;
    height: 100%;
    pointer-events: none; /* Canvas ËÉåÊôØ‰∏çÈòªÊå°ÁÇπÂáª‰∫ã‰ª∂ */
  }



  .test-red-packet {
    border: 2px solid red;
  }

  .red-packet-image {
    position: absolute;
    pointer-events: auto; /* Á∫¢ÂåÖÂõæÁâáÂèØ‰ª•Ë¢´ÁÇπÂáª */
    z-index: 999;
    transition: opacity 0.3s ease;

    &:active {
      transform: scale(0.95);
    }
  }

  .red-packet-item {
    position: absolute;
    pointer-events: auto; /* Á∫¢ÂåÖÂÖÉÁ¥†ÂèØ‰ª•Ë¢´ÁÇπÂáª */
    z-index: 999;
    transition: opacity 0.3s ease;
  }

  .red-packet-image {
    width: 100%;
    height: 100%;
    object-fit: contain;
  }

  .red-packet-drawn {
    position: relative;
    background: linear-gradient(135deg, #ff4444, #cc0000);
    border: 2px solid #ffd700;
    border-radius: 8px;
    display: flex;
    align-items: center;
    justify-content: center;
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);

    &::before {
      content: '';
      position: absolute;
      top: -8px;
      left: 50%;
      transform: translateX(-50%);
      width: 60%;
      height: 12px;
      background: linear-gradient(135deg, #ffaa00, #ff8800);
      border-radius: 6px;
      border: 1px solid #ffd700;
    }
  }

  .red-packet-text {
    color: #ffd700;
    font-size: 24px;
    font-weight: bold;
    text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.5);
  }

  .preload-image {
    position: absolute;
    width: 1px;
    height: 1px;
    opacity: 0;
    pointer-events: none;
    z-index: -1;
  }

  .amount-tip {
    position: fixed;
    pointer-events: none; /* ÈáëÈ¢ùÊèêÁ§∫‰∏çÈòªÊå°ÁÇπÂáª‰∫ã‰ª∂ */
    z-index: 1000; /* Á°Æ‰øùÈáëÈ¢ùÊèêÁ§∫Âú®ÊúÄ‰∏äÂ±ÇÊòæÁ§∫ */
    transition: all 0.3s ease-out;

    .tip-content {
      background: linear-gradient(135deg, #ff6b6b, #ff8e8e);
      color: white;
      padding: 8px 16px;
      border-radius: 20px;
      box-shadow: 0 4px 12px rgba(255, 107, 107, 0.4);
      text-align: center;
      min-width: 100px;

      .amount {
        display: block;
        font-size: 18px;
        font-weight: bold;
        margin-bottom: 2px;
      }

      .label {
        display: block;
        font-size: 12px;
        opacity: 0.9;
      }
    }
  }
}
</style>
